const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-BKj46z97.js","assets/webworkerAll-Cks1qIEu.js","assets/Filter-CoIRD46Q.js","assets/WebGPURenderer-EjlDT_eo.js","assets/BufferResource-TNXe-d2N.js","assets/RenderTargetSystem-BGjteL16.js","assets/WebGLRenderer-CidRy07d.js","assets/CanvasRenderer-huKEzz5P.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const Ph="modulepreload",Rh=function(s){return"/sling-survivor/"+s},Rn={},ze=function(t,e,r){let i=Promise.resolve();if(e&&e.length>0){let l=function(h){return Promise.all(h.map(c=>Promise.resolve(c).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=l(e.map(h=>{if(h=Rh(h),h in Rn)return;Rn[h]=!0;const c=h.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Ph,c||(f.as="script"),f.crossOrigin="",f.href=h,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((d,p)=>{f.addEventListener("load",d),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})};var M=(s=>(s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s.BlendMode="blend-mode",s.TextureSource="texture-source",s.Environment="environment",s.ShapeBuilder="shape-builder",s.Batcher="batcher",s))(M||{});const Ti=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},zs=(s,t)=>Ti(s).priority??t,K={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Ti).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...s){return s.map(Ti).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,i=this._queue;r[e]?r[e]?.(t):(i[e]=i[e]||[],i[e]?.push(t))})}),this},handle(s,t,e){const r=this._addHandlers,i=this._removeHandlers;if(r[s]||i[s])throw new Error(`Extension type ${s} already has a handler`);r[s]=t,i[s]=e;const n=this._queue;return n[s]&&(n[s]?.forEach(o=>t(o)),delete n[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,r=>{t.findIndex(n=>n.name===r.name)>=0||(t.push({name:r.name,value:r.ref}),t.sort((n,o)=>zs(o.value,e)-zs(n.value,e)))},r=>{const i=t.findIndex(n=>n.name===r.name);i!==-1&&t.splice(i,1)})},handleByList(s,t,e=-1){return this.handle(s,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((i,n)=>zs(n,e)-zs(i,e)))},r=>{const i=t.indexOf(r.ref);i!==-1&&t.splice(i,1)})},mixin(s,...t){for(const e of t)Object.defineProperties(s.prototype,Object.getOwnPropertyDescriptors(e))}},Mh={extension:{type:M.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await ze(()=>import("./browserAll-BKj46z97.js"),__vite__mapDeps([0,1,2]))}},Ih={extension:{type:M.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await ze(()=>import("./webworkerAll-Cks1qIEu.js"),__vite__mapDeps([1,2]))}};class gt{constructor(t,e,r){this._x=e||0,this._y=r||0,this._observer=t}clone(t){return new gt(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}function ka(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ur={exports:{}},Mn;function Oh(){return Mn||(Mn=1,(function(s){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function i(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function n(l,h,c,u,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new i(c,u||l,f),p=e?e+h:h;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],d]:l._events[p].push(d):(l._events[p]=d,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new r:delete l._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],c,u;if(this._eventsCount===0)return h;for(u in c=this._events)t.call(c,u)&&h.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},a.prototype.listeners=function(h){var c=e?e+h:h,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var f=0,d=u.length,p=new Array(d);f<d;f++)p[f]=u[f].fn;return p},a.prototype.listenerCount=function(h){var c=e?e+h:h,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,c,u,f,d,p){var m=e?e+h:h;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,x,b;if(g.fn){switch(g.once&&this.removeListener(h,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,u),!0;case 4:return g.fn.call(g.context,c,u,f),!0;case 5:return g.fn.call(g.context,c,u,f,d),!0;case 6:return g.fn.call(g.context,c,u,f,d,p),!0}for(b=1,x=new Array(y-1);b<y;b++)x[b-1]=arguments[b];g.fn.apply(g.context,x)}else{var _=g.length,w;for(b=0;b<_;b++)switch(g[b].once&&this.removeListener(h,g[b].fn,void 0,!0),y){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,c);break;case 3:g[b].fn.call(g[b].context,c,u);break;case 4:g[b].fn.call(g[b].context,c,u,f);break;default:if(!x)for(w=1,x=new Array(y-1);w<y;w++)x[w-1]=arguments[w];g[b].fn.apply(g[b].context,x)}}return!0},a.prototype.on=function(h,c,u){return n(this,h,c,u,!1)},a.prototype.once=function(h,c,u){return n(this,h,c,u,!0)},a.prototype.removeListener=function(h,c,u,f){var d=e?e+h:h;if(!this._events[d])return this;if(!c)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===c&&(!f||p.once)&&(!u||p.context===u)&&o(this,d);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==c||f&&!p[m].once||u&&p[m].context!==u)&&g.push(p[m]);g.length?this._events[d]=g.length===1?g[0]:g:o(this,d)}return this},a.prototype.removeAllListeners=function(h){var c;return h?(c=e?e+h:h,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,s.exports=a})(Ur)),Ur.exports}var Lh=Oh();const Gt=ka(Lh),Bh=Math.PI*2,Dh=180/Math.PI,$h=Math.PI/180;class yt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new yt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Fr.x=0,Fr.y=0,Fr}}const Fr=new yt;class N{constructor(t=1,e=0,r=0,i=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,i,n,o){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new yt;const r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e}applyInverse(t,e){e=e||new yt;const r=this.a,i=this.b,n=this.c,o=this.d,a=this.tx,l=this.ty,h=1/(r*o+n*-i),c=t.x,u=t.y;return e.x=o*h*c+-n*h*u+(l*n-a*o)*h,e.y=r*h*u+-i*h*c+(-l*r+a*i)*h,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),i=this.a,n=this.c,o=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this}append(t){const e=this.a,r=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}appendFrom(t,e){const r=t.a,i=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,h=e.a,c=e.b,u=e.c,f=e.d;return this.a=r*h+i*u,this.b=r*c+i*f,this.c=n*h+o*u,this.d=n*c+o*f,this.tx=a*h+l*u+e.tx,this.ty=a*c+l*f+e.ty,this}setTransform(t,e,r,i,n,o,a,l,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,i=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,i=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-i,n),l=Math.atan2(r,e),h=Math.abs(a+l);return h<1e-5||Math.abs(Bh-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+n*n),t.position.x=this.tx+(o.x*e+o.y*i),t.position.y=this.ty+(o.x*r+o.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,o=t*i-e*r;return this.a=i/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-i*n)/o,this.ty=-(t*this.ty-e*n)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new N;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return Fh.identity()}static get shared(){return Uh.identity()}}const Uh=new N,Fh=new N,ge=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],me=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ye=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],_e=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],ki=[],Ca=[],Hs=Math.sign;function jh(){for(let s=0;s<16;s++){const t=[];ki.push(t);for(let e=0;e<16;e++){const r=Hs(ge[s]*ge[e]+ye[s]*me[e]),i=Hs(me[s]*ge[e]+_e[s]*me[e]),n=Hs(ge[s]*ye[e]+ye[s]*_e[e]),o=Hs(me[s]*ye[e]+_e[s]*_e[e]);for(let a=0;a<16;a++)if(ge[a]===r&&me[a]===i&&ye[a]===n&&_e[a]===o){t.push(a);break}}}for(let s=0;s<16;s++){const t=new N;t.set(ge[s],me[s],ye[s],_e[s],0,0),Ca.push(t)}}jh();const q={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>ge[s],uY:s=>me[s],vX:s=>ye[s],vY:s=>_e[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>ki[s][t],sub:(s,t)=>ki[s][q.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?q.S:q.N:Math.abs(t)*2<=Math.abs(s)?s>0?q.E:q.W:t>0?s>0?q.SE:q.SW:s>0?q.NE:q.NW,matrixAppendRotationInv:(s,t,e=0,r=0,i=0,n=0)=>{const o=Ca[q.inv(t)],a=o.a,l=o.b,h=o.c,c=o.d,u=e-Math.min(0,a*i,h*n,a*i+h*n),f=r-Math.min(0,l*i,c*n,l*i+c*n),d=s.a,p=s.b,m=s.c,g=s.d;s.a=a*d+l*m,s.b=a*p+l*g,s.c=h*d+c*m,s.d=h*p+c*g,s.tx=u*d+f*m+s.tx,s.ty=u*p+f*g+s.ty},transformRectCoords:(s,t,e,r)=>{const{x:i,y:n,width:o,height:a}=s,{x:l,y:h,width:c,height:u}=t;return e===q.E?(r.set(i+l,n+h,o,a),r):e===q.S?r.set(c-n-a+l,i+h,a,o):e===q.W?r.set(c-i-o+l,u-n-a+h,o,a):e===q.N?r.set(n+l,u-i-o+h,a,o):r.set(i+l,n+h,o,a)}},Vs=[new yt,new yt,new yt,new yt];class Q{constructor(t=0,e=0,r=0,i=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(i)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Q(0,0,0,0)}clone(){return new Q(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,r,i=.5){const{width:n,height:o}=this;if(n<=0||o<=0)return!1;const a=this.x,l=this.y,h=r*(1-i),c=r-h,u=a-h,f=a+n+h,d=l-h,p=l+o+h,m=a+c,g=a+n-c,y=l+c,x=l+o-c;return t>=u&&t<=f&&e>=d&&e<=p&&!(t>m&&t<g&&e>y&&e<x)}intersects(t,e){if(!e){const T=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=T)return!1;const k=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>k}const r=this.left,i=this.right,n=this.top,o=this.bottom;if(i<=r||o<=n)return!1;const a=Vs[0].set(t.left,t.top),l=Vs[1].set(t.left,t.bottom),h=Vs[2].set(t.right,t.top),c=Vs[3].set(t.right,t.bottom);if(h.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(l,l),e.apply(h,h),e.apply(c,c),Math.max(a.x,l.x,h.x,c.x)<=r||Math.min(a.x,l.x,h.x,c.x)>=i||Math.max(a.y,l.y,h.y,c.y)<=n||Math.min(a.y,l.y,h.y,c.y)>=o))return!1;const f=u*(l.y-a.y),d=u*(a.x-l.x),p=f*r+d*n,m=f*i+d*n,g=f*r+d*o,y=f*i+d*o;if(Math.max(p,m,g,y)<=f*a.x+d*a.y||Math.min(p,m,g,y)>=f*c.x+d*c.y)return!1;const x=u*(a.y-h.y),b=u*(h.x-a.x),_=x*r+b*n,w=x*i+b*n,v=x*r+b*o,S=x*i+b*o;return!(Math.max(_,w,v,S)<=x*a.x+b*a.y||Math.min(_,w,v,S)>=x*c.x+b*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(n-i,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=n-i,this}getBounds(t){return t||(t=new Q),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,r=t.y,i=t.x+t.width,n=t.y+t.height;return e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height&&i>=this.x&&i<this.x+this.width&&n>=this.y&&n<this.y+this.height}set(t,e,r,i){return this.x=t,this.y=e,this.width=r,this.height=i,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const jr={default:-1};function it(s="default"){return jr[s]===void 0&&(jr[s]=-1),++jr[s]}const In=new Set,rt="8.0.0",Nh="8.3.4",Ne={quiet:!1,noColor:!1},W=((s,t,e=3)=>{if(Ne.quiet||In.has(t))return;let r=new Error().stack;const i=`${t}
Deprecated since v${s}`,n=typeof console.groupCollapsed=="function"&&!Ne.noColor;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",i):(r=r.split(`
`).splice(e).join(`
`),n?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",i),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",i),console.warn(r))),In.add(t)});Object.defineProperties(W,{quiet:{get:()=>Ne.quiet,set:s=>{Ne.quiet=s},enumerable:!0,configurable:!1},noColor:{get:()=>Ne.noColor,set:s=>{Ne.noColor=s},enumerable:!0,configurable:!1}});const Ea=()=>{};function Xe(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function On(s){return!(s&s-1)&&!!s}function Pa(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const Ln=Object.create(null);function Gh(s){const t=Ln[s];return t===void 0&&(Ln[s]=it("resource")),t}const Ra=class Ma extends Gt{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...Ma.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){W(rt,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this._sharedResourceId=null,this.emit("change",this)}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Gh(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};Ra.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let Ke=Ra;const Ia=class Oa extends Gt{constructor(t={}){super(),this.options=t,this._gpuData=Object.create(null),this._gcLastUsed=-1,this.uid=it("textureSource"),this._resourceType="textureSource",this._resourceId=it("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.viewDimension="2d",this.arrayLayerCount=1,this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...Oa.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.viewDimension=t.viewDimension??t.dimensions,this.arrayLayerCount=t.arrayLayerCount,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new Ke(Pa(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){this.style!==t&&(this._style?.off("change",this._onStyleChange,this),this._style=t,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=it("resource"),this.emit("change",this),this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy?.();this._gpuData=Object.create(null)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,r){r||(r=this._resolution),t||(t=this.width),e||(e=this.height);const i=Math.round(t*r),n=Math.round(e*r);return this.width=i/r,this.height=n/r,this._resolution=r,this.pixelWidth===i&&this.pixelHeight===n?!1:(this._refreshPOT(),this.pixelWidth=i,this.pixelHeight=n,this.emit("resize",this),this._resourceId=it("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=On(this.pixelWidth)&&On(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Ia.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",viewDimension:"2d",arrayLayerCount:1,mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Dt=Ia;class on extends Dt{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let r=t.format;r||(e instanceof Float32Array?r="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?r="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?r="rgba16uint":(e instanceof Int8Array,r="bgra8unorm")),super({...t,resource:e,format:r}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}on.extension=M.TextureSource;const Bn=new N;class Wh{constructor(t,e){this.mapCoord=new N,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){this.texture!==t&&(this._texture?.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let i=0;i<t.length;i+=2){const n=t[i],o=t[i+1];e[i]=n*r.a+o*r.c+r.tx,e[i+1]=n*r.b+o*r.d+r.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const r=t.orig,i=t.trim;i&&(Bn.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Bn));const n=t.source,o=this.uClampFrame,a=this.clampMargin/n._resolution,l=this.clampOffset/n._resolution;return o[0]=(t.frame.x+a+l)/n.width,o[1]=(t.frame.y+a+l)/n.height,o[2]=(t.frame.x+t.frame.width-a+l)/n.width,o[3]=(t.frame.y+t.frame.height-a+l)/n.height,this.uClampOffset[0]=this.clampOffset/n.pixelWidth,this.uClampOffset[1]=this.clampOffset/n.pixelHeight,this.isSimple=t.frame.width===n.width&&t.frame.height===n.height&&t.rotate===0,!0}}class j extends Gt{constructor({source:t,label:e,frame:r,orig:i,trim:n,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:h}={}){if(super(),this.uid=it("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Q,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=t?.source??new Dt,this.noFrame=!r,r)this.frame.copyFrom(r);else{const{width:c,height:u}=this._source;this.frame.width=c,this.frame.height=u}this.orig=i||this.frame,this.trim=n,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=h||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Wh(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:r,height:i}=this._source,n=e.x/r,o=e.y/i,a=e.width/r,l=e.height/i;let h=this.rotate;if(h){const c=a/2,u=l/2,f=n+c,d=o+u;h=q.add(h,q.NW),t.x0=f+c*q.uX(h),t.y0=d+u*q.uY(h),h=q.add(h,2),t.x1=f+c*q.uX(h),t.y1=d+u*q.uY(h),h=q.add(h,2),t.x2=f+c*q.uX(h),t.y2=d+u*q.uY(h),h=q.add(h,2),t.x3=f+c*q.uX(h),t.y3=d+u*q.uY(h)}else t.x0=n,t.y0=o,t.x1=n+a,t.y1=o,t.x2=n+a,t.y2=o+l,t.x3=n,t.y3=o+l}destroy(t=!1){this._source&&(this._source.off("resize",this.update,this),t&&(this._source.destroy(),this._source=null)),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return W(rt,"Texture.baseTexture is now Texture.source"),this._source}}j.EMPTY=new j({label:"EMPTY",source:new Dt({label:"EMPTY"})});j.EMPTY.destroy=Ea;j.WHITE=new j({source:new on({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});j.WHITE.destroy=Ea;function La(s,t,e){const{width:r,height:i}=e.orig,n=e.trim;if(n){const o=n.width,a=n.height;s.minX=n.x-t._x*r,s.maxX=s.minX+o,s.minY=n.y-t._y*i,s.maxY=s.minY+a}else s.minX=-t._x*r,s.maxX=s.minX+r,s.minY=-t._y*i,s.maxY=s.minY+i}const Dn=new N;class Ct{constructor(t=1/0,e=1/0,r=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Dn,this.minX=t,this.minY=e,this.maxX=r,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Q);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Dn,this}set(t,e,r,i){this.minX=t,this.minY=e,this.maxX=r,this.maxY=i}addFrame(t,e,r,i,n){n||(n=this.matrix);const o=n.a,a=n.b,l=n.c,h=n.d,c=n.tx,u=n.ty;let f=this.minX,d=this.minY,p=this.maxX,m=this.maxY,g=o*t+l*e+c,y=a*t+h*e+u;g<f&&(f=g),y<d&&(d=y),g>p&&(p=g),y>m&&(m=y),g=o*r+l*e+c,y=a*r+h*e+u,g<f&&(f=g),y<d&&(d=y),g>p&&(p=g),y>m&&(m=y),g=o*t+l*i+c,y=a*t+h*i+u,g<f&&(f=g),y<d&&(d=y),g>p&&(p=g),y>m&&(m=y),g=o*r+l*i+c,y=a*r+h*i+u,g<f&&(f=g),y<d&&(d=y),g>p&&(p=g),y>m&&(m=y),this.minX=f,this.minY=d,this.maxX=p,this.maxY=m}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,r=this.minY,i=this.maxX,n=this.maxY,{a:o,b:a,c:l,d:h,tx:c,ty:u}=t;let f=o*e+l*r+c,d=a*e+h*r+u;this.minX=f,this.minY=d,this.maxX=f,this.maxY=d,f=o*i+l*r+c,d=a*i+h*r+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*e+l*n+c,d=a*e+h*n+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*i+l*n+c,d=a*i+h*n+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,r,i){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<r&&(this.minY=r),this.maxY>i&&(this.maxY=i),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new Ct(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,r,i){let n=this.minX,o=this.minY,a=this.maxX,l=this.maxY;i||(i=this.matrix);const h=i.a,c=i.b,u=i.c,f=i.d,d=i.tx,p=i.ty;for(let m=e;m<r;m+=2){const g=t[m],y=t[m+1],x=h*g+u*y+d,b=c*g+f*y+p;n=x<n?x:n,o=b<o?b:o,a=x>a?x:a,l=b>l?b:l}this.minX=n,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var zh={grad:.9,turn:360,rad:360/(2*Math.PI)},Wt=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},ut=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},kt=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},Ba=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},$n=function(s){return{r:kt(s.r,0,255),g:kt(s.g,0,255),b:kt(s.b,0,255),a:kt(s.a)}},Nr=function(s){return{r:ut(s.r),g:ut(s.g),b:ut(s.b),a:ut(s.a,3)}},Hh=/^#([0-9a-f]{3,8})$/i,qs=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},Da=function(s){var t=s.r,e=s.g,r=s.b,i=s.a,n=Math.max(t,e,r),o=n-Math.min(t,e,r),a=o?n===t?(e-r)/o:n===e?2+(r-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:i}},$a=function(s){var t=s.h,e=s.s,r=s.v,i=s.a;t=t/360*6,e/=100,r/=100;var n=Math.floor(t),o=r*(1-e),a=r*(1-(t-n)*e),l=r*(1-(1-t+n)*e),h=n%6;return{r:255*[r,a,o,o,l,r][h],g:255*[l,r,r,a,o,o][h],b:255*[o,o,l,r,r,a][h],a:i}},Un=function(s){return{h:Ba(s.h),s:kt(s.s,0,100),l:kt(s.l,0,100),a:kt(s.a)}},Fn=function(s){return{h:ut(s.h),s:ut(s.s),l:ut(s.l),a:ut(s.a,3)}},jn=function(s){return $a((e=(t=s).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},bs=function(s){return{h:(t=Da(s)).h,s:(i=(200-(e=t.s))*(r=t.v)/100)>0&&i<200?e*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:t.a};var t,e,r,i},Vh=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,qh=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Yh=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Xh=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ci={string:[[function(s){var t=Hh.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?ut(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?ut(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=Yh.exec(s)||Xh.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:$n({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=Vh.exec(s)||qh.exec(s);if(!t)return null;var e,r,i=Un({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(zh[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return jn(i)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,r=s.b,i=s.a,n=i===void 0?1:i;return Wt(t)&&Wt(e)&&Wt(r)?$n({r:Number(t),g:Number(e),b:Number(r),a:Number(n)}):null},"rgb"],[function(s){var t=s.h,e=s.s,r=s.l,i=s.a,n=i===void 0?1:i;if(!Wt(t)||!Wt(e)||!Wt(r))return null;var o=Un({h:Number(t),s:Number(e),l:Number(r),a:Number(n)});return jn(o)},"hsl"],[function(s){var t=s.h,e=s.s,r=s.v,i=s.a,n=i===void 0?1:i;if(!Wt(t)||!Wt(e)||!Wt(r))return null;var o=(function(a){return{h:Ba(a.h),s:kt(a.s,0,100),v:kt(a.v,0,100),a:kt(a.a)}})({h:Number(t),s:Number(e),v:Number(r),a:Number(n)});return $a(o)},"hsv"]]},Nn=function(s,t){for(var e=0;e<t.length;e++){var r=t[e][0](s);if(r)return[r,t[e][1]]}return[null,void 0]},Kh=function(s){return typeof s=="string"?Nn(s.trim(),Ci.string):typeof s=="object"&&s!==null?Nn(s,Ci.object):[null,void 0]},Gr=function(s,t){var e=bs(s);return{h:e.h,s:kt(e.s+100*t,0,100),l:e.l,a:e.a}},Wr=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Gn=function(s,t){var e=bs(s);return{h:e.h,s:e.s,l:kt(e.l+100*t,0,100),a:e.a}},Ei=(function(){function s(t){this.parsed=Kh(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return ut(Wr(this.rgba),2)},s.prototype.isDark=function(){return Wr(this.rgba)<.5},s.prototype.isLight=function(){return Wr(this.rgba)>=.5},s.prototype.toHex=function(){return t=Nr(this.rgba),e=t.r,r=t.g,i=t.b,o=(n=t.a)<1?qs(ut(255*n)):"","#"+qs(e)+qs(r)+qs(i)+o;var t,e,r,i,n,o},s.prototype.toRgb=function(){return Nr(this.rgba)},s.prototype.toRgbString=function(){return t=Nr(this.rgba),e=t.r,r=t.g,i=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+i+", "+n+")":"rgb("+e+", "+r+", "+i+")";var t,e,r,i,n},s.prototype.toHsl=function(){return Fn(bs(this.rgba))},s.prototype.toHslString=function(){return t=Fn(bs(this.rgba)),e=t.h,r=t.s,i=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+i+"%, "+n+")":"hsl("+e+", "+r+"%, "+i+"%)";var t,e,r,i,n},s.prototype.toHsv=function(){return t=Da(this.rgba),{h:ut(t.h),s:ut(t.s),v:ut(t.v),a:ut(t.a,3)};var t},s.prototype.invert=function(){return Ut({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),Ut(Gr(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),Ut(Gr(this.rgba,-t))},s.prototype.grayscale=function(){return Ut(Gr(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),Ut(Gn(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),Ut(Gn(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?Ut({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ut(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=bs(this.rgba);return typeof t=="number"?Ut({h:t,s:e.s,l:e.l,a:e.a}):ut(e.h)},s.prototype.isEqual=function(t){return this.toHex()===Ut(t).toHex()},s})(),Ut=function(s){return s instanceof Ei?s:new Ei(s)},Wn=[],Jh=function(s){s.forEach(function(t){Wn.indexOf(t)<0&&(t(Ei,Ci),Wn.push(t))})};function Zh(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in e)r[e[i]]=i;var n={};s.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,h=r[this.toHex()];if(h)return h;if(o?.closest){var c=this.toRgb(),u=1/0,f="black";if(!n.length)for(var d in e)n[d]=new s(e[d]).toRgb();for(var p in e){var m=(a=c,l=n[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));m<u&&(u=m,f=p)}return f}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":e[a];return l?new s(l).toRgb():null},"name"])}Jh([Zh]);const Je=class gs{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof gs)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,o)=>n===e[o]);if(t!==null&&e!==null){const n=Object.keys(t),o=Object.keys(e);return n.length!==o.length?!1:n.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,r,i]=this._components;return{r:t,g:e,b:r,a:i}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,i]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(i*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,r,i,n]=this._components;return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,r,i]=this._components;return t[0]=e,t[1]=r,t[2]=i,t}toNumber(){return this._int}toBgrNumber(){const[t,e,r]=this.toUint8RgbArray();return(r<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,i,n]=gs._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=i,this._components[3]*=n,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,n=this._int&255;return e&&(r=r*t+.5|0,i=i*t+.5|0,n=n*t+.5|0),(t*255<<24)+(r<<16)+(i<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,r,i,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,r=(o>>8&255)/255,i=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,i,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,i,n=255]=t,e/=255,r/=255,i/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=gs.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=Ut(t);o.isValid()&&({r:e,g:r,b:i,a:n}=o.rgba,e/=255,r/=255,i/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=i,this._components[3]=n,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((i,n)=>{t[n]=Math.min(Math.max(i,e),r)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof gs||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};Je.shared=new Je;Je._temp=new Je;Je.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let ht=Je;const Qh={cullArea:null,cullable:!1,cullableChildren:!0};let zr=0;const zn=500;function Z(...s){zr!==zn&&(zr++,zr===zn?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...s))}const Fs={_registeredResources:new Set,register(s){this._registeredResources.add(s)},unregister(s){this._registeredResources.delete(s)},release(){this._registeredResources.forEach(s=>s.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(s){return this._registeredResources.has(s)},reset(){this._registeredResources.clear()}};class tc{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){let e;return this._index>0?e=this._pool[--this._index]:(e=new this._classType,this._count++),e.init?.(t),e}return(t){t.reset?.(),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class ec{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new tc(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const r=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[r]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const xt=new ec;Fs.register(xt);const sc={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){W("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}};function rc(s,t,e){const r=s.length;let i;if(t>=r||e===0)return;e=t+e>r?r-t:e;const n=r-e;for(i=t;i<n;++i)s[i]=s[i+e];s.length=n}const ic={allowChildren:!0,removeChildren(s=0,t){const e=t??this.children.length,r=e-s,i=[];if(r>0&&r<=e){for(let o=e-1;o>=s;o--){const a=this.children[o];a&&(i.push(a),a.parent=null)}rc(this.children,s,e);const n=this.renderGroup||this.parentRenderGroup;n&&n.removeChildren(i);for(let o=0;o<i.length;++o){const a=i[o];a.parentRenderLayer?.detach(a),this.emit("childRemoved",a,this,o),i[o].emit("removed",this)}return i.length>0&&this._didViewChangeTick++,i}else if(r===0&&this.children.length===0)return i;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||W(rt,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const i=s.parent.children.indexOf(s);if(s.parent===this&&i===t)return s;i!==-1&&s.parent.children.splice(i,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const r=this.renderGroup||this.parentRenderGroup;return r&&r.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),r=this.getChildIndex(t);this.children[e]=t,this.children[r]=s;const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const r=this.worldTransform.clone();return r.invert(),e.prepend(r),s.setFromMatrix(e),s},replaceChild(s,t){s.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(s)),t.setFromMatrix(s.localTransform),t.updateLocalTransform(),this.removeChild(s)}},nc={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const r=this.children,i=r.length;for(let n=0;n<i;n++)r[n].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:r}=t;for(let i=0;i<this.effects.length;i++){const n=this.effects[i];r[n.pipe].push(n,this,s)}this.collectRenderablesSimple(s,t,e);for(let i=this.effects.length-1;i>=0;i--){const n=this.effects[i];r[n.pipe].pop(n,this,s)}}};class Hn{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class oc{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const r=this._tests[e];if(r.test(t))return xt.get(r.maskClass,t)}return t}returnMaskEffect(t){xt.return(t)}}const Pi=new oc;K.handleByList(M.MaskEffect,Pi._effectClasses);const ac={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,r)=>e.priority-r.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;t?.mask!==s&&(t&&(this.removeEffect(t),Pi.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=Pi.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new Hn);s=s;const e=s?.length>0,r=t.filters?.length>0,i=e!==r;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),i&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){return this._filterEffect?.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new Hn),this._filterEffect.filterArea=s},get filterArea(){return this._filterEffect?.filterArea}},lc={label:null,get name(){return W(rt,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){W(rt,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let r=0;r<e.length;r++){const i=e[r];if(i.label===s||s instanceof RegExp&&s.test(i.label))return i}if(t)for(let r=0;r<e.length;r++){const n=e[r].getChildByLabel(s,!0);if(n)return n}return null},getChildrenByLabel(s,t=!1,e=[]){const r=this.children;for(let i=0;i<r.length;i++){const n=r[i];(n.label===s||s instanceof RegExp&&s.test(n.label))&&e.push(n)}if(t)for(let i=0;i<r.length;i++)r[i].getChildrenByLabel(s,!0,e);return e}},_t=xt.getPool(N),Yt=xt.getPool(Ct),hc=new N,cc={getFastGlobalBounds(s,t){t||(t=new Ct),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let r=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const i=!!this.effects.length;if((this.renderGroup||i)&&(r=Yt.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;r.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const n=this.children;for(let o=0;o<n.length;o++)n[o]._getGlobalBoundsRecursive(s,r,e)}if(i){let n=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(n||(n=!0,r.applyMatrix(o.worldTransform)),this.effects[a].addBounds(r,!0));n&&r.applyMatrix(o.worldTransform.copyTo(hc).invert()),t.addBounds(r),Yt.return(r)}else this.renderGroup&&(t.addBounds(r,this.relativeGroupTransform),Yt.return(r))}};function Ua(s,t,e){e.clear();let r,i;return s.parent?t?r=s.parent.worldTransform:(i=_t.get().identity(),r=an(s,i)):r=N.IDENTITY,Fa(s,e,r,t),i&&_t.return(i),e.isValid||e.set(0,0,0,0),e}function Fa(s,t,e,r){if(!s.visible||!s.measurable)return;let i;r?i=s.worldTransform:(s.updateLocalTransform(),i=_t.get(),i.appendFrom(s.localTransform,e));const n=t,o=!!s.effects.length;if(o&&(t=Yt.get().clear()),s.boundsArea)t.addRect(s.boundsArea,i);else{const a=s.bounds;a&&!a.isEmpty()&&(t.matrix=i,t.addBounds(a));for(let l=0;l<s.children.length;l++)Fa(s.children[l],t,i,r)}if(o){for(let a=0;a<s.effects.length;a++)s.effects[a].addBounds?.(t);n.addBounds(t,N.IDENTITY),Yt.return(t)}r||_t.return(i)}function an(s,t){const e=s.parent;return e&&(an(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function ja(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,r=s>>8&255,i=s&255,n=t>>16&255,o=t>>8&255,a=t&255,l=e*n/255|0,h=r*o/255|0,c=i*a/255|0;return(l<<16)+(h<<8)+c}const Vn=16777215;function qn(s,t){return s===Vn?t:t===Vn?s:ja(s,t)}function mr(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const uc={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s=new N,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=an(this,_t.get().identity());return s.appendFrom(this.localTransform,e),_t.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?mr(this.renderGroup.worldColor):this.parentRenderGroup?mr(qn(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=qn(t,e.localColor),e=e.parent;return mr(t)}};function Na(s,t,e){return t.clear(),e||(e=N.IDENTITY),Ga(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function Ga(s,t,e,r,i){let n;if(i)n=_t.get(),n=e.copyTo(n);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const l=s.localTransform;n=_t.get(),n.appendFrom(l,e)}const o=t,a=!!s.effects.length;if(a&&(t=Yt.get().clear()),s.boundsArea)t.addRect(s.boundsArea,n);else{s.renderPipeId&&(t.matrix=n,t.addBounds(s.bounds));const l=s.children;for(let h=0;h<l.length;h++)Ga(l[h],t,n,r,!1)}if(a){for(let l=0;l<s.effects.length;l++)s.effects[l].addLocalBounds?.(t,r);o.addBounds(t,N.IDENTITY),Yt.return(t)}_t.return(n)}function Wa(s,t){const e=s.children;for(let r=0;r<e.length;r++){const i=e[r],n=i.uid,o=(i._didViewChangeTick&65535)<<16|i._didContainerChangeTick&65535,a=t.index;(t.data[a]!==n||t.data[a+1]!==o)&&(t.data[t.index]=n,t.data[t.index+1]=o,t.didChange=!0),t.index=a+2,i.children.length&&Wa(i,t)}return t.didChange}const dc=new N,fc={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new Ct});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),Wa(this,s),s.didChange&&Na(this,s.localBounds,dc),s.localBounds},getBounds(s,t){return Ua(this,s,t||new Ct)}},pc={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&t?.removeOnRender(this),this._onRender=null;return}this._onRender||t?.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},gc={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(mc))}};function mc(s,t){return s._zIndex-t._zIndex}const yc={getGlobalPosition(s=new yt,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const r=this.getGlobalTransform(_t.get(),e);return t=r.apply(s,t),_t.return(r),t},toLocal(s,t,e,r){t&&(s=t.toGlobal(s,e,r));const i=this.getGlobalTransform(_t.get(),r);return e=i.applyInverse(s,e),_t.return(i),e}};class ln{constructor(){this.uid=it("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let _c=0;class bc{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new Ke(this.textureOptions)}createTexture(t,e,r){const i=new Dt({...this.textureOptions,width:t,height:e,resolution:1,antialias:r,autoGarbageCollect:!1});return new j({source:i,label:`texturePool_${_c++}`})}getOptimalTexture(t,e,r=1,i){let n=Math.ceil(t*r-1e-6),o=Math.ceil(e*r-1e-6);n=Xe(n),o=Xe(o);const a=(n<<17)+(o<<1)+(i?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(n,o,i)),l.source._resolution=r,l.source.width=n/r,l.source.height=o/r,l.source.pixelWidth=n,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=t,l.frame.height=e,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(t,e=!1){const r=t.source;return this.getOptimalTexture(t.width,t.height,r._resolution,e)}returnTexture(t,e=!1){const r=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[r].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const r=this._texturePool[e];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0)}this._texturePool={}}}const Cr=new bc;Fs.register(Cr);class xc{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new N,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new ln,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let r=0;r<e.length;r++){const i=e[r];i._updateFlags=15,this.addChild(i)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(Cr.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let r=0;r<e.length;r++)this.addChild(e[r])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let r=0;r<e.length;r++)this.removeChild(e[r])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let r=0;r<e.length;r++)this._getChildren(e[r],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const r=t.children;for(let i=0;i<r.length;i++)this._getChildren(r[i],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new N),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new N),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new N),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function wc(s,t,e={}){for(const r in t)!e[r]&&t[r]!==void 0&&(s[r]=t[r])}const Hr=new gt(null),Ys=new gt(null),Vr=new gt(null,1,1),Xs=new gt(null),Yn=1,vc=2,qr=4;class H extends Gt{constructor(t={}){super(),this.uid=it("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new N,this.relativeGroupTransform=new N,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new gt(this,0,0),this._scale=Vr,this._pivot=Ys,this._origin=Xs,this._skew=Hr,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],wc(this,t,{children:!0,parent:!0,effects:!0}),t.children?.forEach(e=>this.addChild(e)),t.parent?.addChild(this)}static mixin(t){W("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),K.mixin(H,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||W(rt,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let i=0;i<t.length;i++)this.addChild(t[i]);return t[0]}const e=t[0],r=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),r&&(r.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,r&&r.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let i=0;i<t.length;i++)this.removeChild(t[i]);return t[0]}const e=t[0],r=this.children.indexOf(e);return r>-1&&(this._didViewChangeTick++,this.children.splice(r,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,r),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),this.renderGroup=xt.get(xc,this),this.groupTransform=N.IDENTITY,t?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),xt.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new N),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*Dh}set angle(t){this.rotation=t*$h}get pivot(){return this._pivot===Ys&&(this._pivot=new gt(this,0,0)),this._pivot}set pivot(t){this._pivot===Ys&&(this._pivot=new gt(this,0,0),this._origin!==Xs&&Z("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Hr&&(this._skew=new gt(this,0,0)),this._skew}set skew(t){this._skew===Hr&&(this._skew=new gt(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===Vr&&(this._scale=new gt(this,1,1)),this._scale}set scale(t){this._scale===Vr&&(this._scale=new gt(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===Xs&&(this._origin=new gt(this,0,0)),this._origin}set origin(t){this._origin===Xs&&(this._origin=new gt(this,0,0),this._pivot!==Ys&&Z("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const r=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,r.width),e!==void 0&&this._setHeight(e,r.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,r=this._scale,i=this._pivot,n=this._origin,o=this._position,a=r._x,l=r._y,h=i._x,c=i._y,u=-n._x,f=-n._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*l,e.d=this._sy*l,e.tx=o._x-(h*e.a+c*e.c)+(u*e.a+f*e.c)-u,e.ty=o._y-(h*e.b+c*e.d)+(u*e.b+f*e.d)-f}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=Yn,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const r=ht.shared.setValue(t??16777215).toBgrNumber();r!==this.localColor&&(this.localColor=r,this._updateFlags|=Yn,this._onUpdate())}get tint(){return mr(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=vc,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=qr,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=qr,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=qr,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t?.children)&&e)for(let i=0;i<e.length;++i)e[i].destroy(t);this.renderGroup?.destroy(),this.renderGroup=null}}K.mixin(H,ic,cc,yc,pc,fc,ac,lc,gc,Qh,sc,uc,nc);class hn extends H{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this._bounds=new Ct(0,1,0,0),this._boundsDirty=!0,this.autoGarbageCollect=t.autoGarbageCollect??!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:r,y:i}=t;return r>=e.minX&&r<=e.maxX&&i>=e.minY&&i<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null),this.onViewUpdate()}destroy(t){this.unload(),super.destroy(t),this._bounds=null}collectRenderablesSimple(t,e,r){const{renderPipes:i}=e;i.blendMode.pushBlendMode(this,this.groupBlendMode,t);const o=i[this.renderPipeId];o?.addRenderable&&o.addRenderable(this,t),this.didViewUpdate=!1;const a=this.children,l=a.length;for(let h=0;h<l;h++)a[h].collectRenderables(t,e,r);i.blendMode.popBlendMode(t)}}class Nt extends hn{constructor(t=j.EMPTY){t instanceof j&&(t={texture:t});const{texture:e=j.EMPTY,anchor:r,roundPixels:i,width:n,height:o,...a}=t;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new gt({_onUpdate:()=>{this.onViewUpdate()}}),r?this.anchor=r:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=i??!1,n!==void 0&&(this.width=n),o!==void 0&&(this.height=o)}static from(t,e=!1){return t instanceof j?new Nt(t):new Nt(j.from(t,e))}set texture(t){t||(t=j.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return La(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return W("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,r=this._bounds,{width:i,height:n}=e.orig;r.minX=-t._x*i,r.maxX=r.minX+i,r.minY=-t._y*n,r.maxY=r.minY+n}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(r)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const Sc=new Ct;function za(s,t,e){const r=Sc;s.measurable=!0,Ua(s,e,r),t.addBoundsMask(r),s.measurable=!1}function Ha(s,t,e){const r=Yt.get();s.measurable=!0;const i=_t.get().identity(),n=Va(s,e,i);Na(s,r,n),s.measurable=!1,t.addBoundsMask(r),_t.return(i),Yt.return(r)}function Va(s,t,e){return s?(s!==t&&(Va(s.parent,t,e),s.updateLocalTransform(),e.append(s.localTransform)),e):(Z("Mask bounds, renderable is not inside the root container"),e)}class qa{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Nt),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(t,e){this.inverse||za(this.mask,t,e)}addLocalBounds(t,e){Ha(this.mask,t,e)}containsPoint(t,e){const r=this.mask;return e(r,t)}destroy(){this.reset()}static test(t){return t instanceof Nt}}qa.extension=M.MaskEffect;class Ya{constructor(t){this.priority=0,this.pipe="colorMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}Ya.extension=M.MaskEffect;class Xa{constructor(t){this.priority=0,this.pipe="stencilMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(t,e){za(this.mask,t,e)}addLocalBounds(t,e){Ha(this.mask,t,e)}containsPoint(t,e){const r=this.mask;return e(r,t)}destroy(){this.reset()}static test(t){return t instanceof H}}Xa.extension=M.MaskEffect;const Ac={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")};let Xn=Ac;const J={get(){return Xn},set(s){Xn=s}};class Ka extends Dt{constructor(t){t.resource||(t.resource=J.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,r=this._resolution){const i=super.resize(t,e,r);return i&&this.resizeCanvas(),i}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Ka.extension=M.TextureSource;class Ze extends Dt{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Ze.extension=M.TextureSource;var ks=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(ks||{});class Yr{constructor(t,e=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=r,this._once=i}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Ja=class wt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Yr(null,null,1/0),this.deltaMS=1/wt.targetFPMS,this.elapsedMS=1/wt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=ks.NORMAL){return this._addListener(new Yr(t,e,r))}addOnce(t,e,r=ks.NORMAL){return this._addListener(new Yr(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*wt.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,wt.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!wt._shared){const t=wt._shared=new wt;t.autoStart=!0,t._protected=!0}return wt._shared}static get system(){if(!wt._system){const t=wt._system=new wt;t.autoStart=!0,t._protected=!0}return wt._system}};Ja.targetFPMS=.06;let jt=Ja,Xr;async function Za(){return Xr??(Xr=(async()=>{const t=J.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!e)return"premultiply-alpha-on-upload";const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const n=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,n),t.deleteFramebuffer(i),t.deleteTexture(r),t.getExtension("WEBGL_lose_context")?.loseContext(),n[0]<=n[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Xr}const Er=class Qa extends Dt{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...Qa.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=jt.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await Za(),this._load=new Promise((r,i)=>{this.isValid?r(this):(this._resolve=r,this._reject=i,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(jt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(jt.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(jt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Er.extension=M.TextureSource;Er.defaultOptions={...Dt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Er.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let xs=Er;const Ot=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(r=>typeof r=="string"||e?t(r):r):s);class Tc{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||Z(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=Ot(t);let i;for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];if(h.test(e)){i=h.getCacheableAssets(r,e);break}}const n=new Map(Object.entries(i||{}));i||r.forEach(l=>{n.set(l,e)});const o=[...n.keys()],a={cacheKeys:o,keys:r};r.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{const h=i?i[l]:e;this._cache.has(l)&&this._cache.get(l)!==h&&Z("[Cache] already has key:",l),this._cache.set(l,n.get(l))})}remove(t){if(!this._cacheMap.has(t)){Z(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const dt=new Tc,Ri=[];K.handleByList(M.TextureSource,Ri);function tl(s={}){const t=s&&s.resource,e=t?s.resource:s,r=t?s:{resource:s};for(let i=0;i<Ri.length;i++){const n=Ri[i];if(n.test(e))return new n(r)}throw new Error(`Could not find a source type for resource: ${r.resource}`)}function kc(s={},t=!1){const e=s&&s.resource,r=e?s.resource:s,i=e?s:{resource:s};if(!t&&dt.has(r))return dt.get(r);const n=new j({source:tl(i)});return n.on("destroy",()=>{dt.has(r)&&dt.remove(r)}),t||dt.set(r,n),n}function Cc(s,t=!1){return typeof s=="string"?dt.get(s):s instanceof Dt?new j({source:s}):kc(s,t)}j.from=Cc;Dt.from=tl;K.add(qa,Ya,Xa,xs,Ze,Ka,on);var ne=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(ne||{});function Et(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function os(s){return s.split("?")[0].split("#")[0]}function Ec(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Pc(s,t,e){return s.replace(new RegExp(Ec(t),"g"),e)}function Rc(s,t){let e="",r=0,i=-1,n=0,o=-1;for(let a=0;a<=s.length;++a){if(a<s.length)o=s.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||n===1))if(i!==a-1&&n===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",r=0):(e=e.slice(0,l),r=e.length-1-e.lastIndexOf("/")),i=a,n=0;continue}}else if(e.length===2||e.length===1){e="",r=0,i=a,n=0;continue}}}else e.length>0?e+=`/${s.slice(i+1,a)}`:e=s.slice(i+1,a),r=a-i-1;i=a,n=0}else o===46&&n!==-1?++n:n=-1}return e}const At={toPosix(s){return Pc(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Et(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(Et(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const r=os(this.toPosix(t??J.get().getBaseUrl())),i=os(this.toPosix(e??this.rootname(r)));return s=this.toPosix(s),s.startsWith("/")?At.join(i,s.slice(1)):this.isAbsolute(s)?s:this.join(r,s)},normalize(s){if(Et(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const r=s.endsWith("/");return s=Rc(s),s.length>0&&r&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return Et(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const r=s[e];if(Et(r),r.length>0)if(t===void 0)t=r;else{const i=s[e-1]??"";this.joinExtensions.includes(this.extname(i).toLowerCase())?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(Et(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let r=-1,i=!0;const n=this.getProtocol(s),o=s;s=s.slice(n.length);for(let a=s.length-1;a>=1;--a)if(t=s.charCodeAt(a),t===47){if(!i){r=a;break}}else i=!1;return r===-1?e?"/":this.isUrl(o)?n+s:n:e&&r===1?"//":n+s.slice(0,r)},rootname(s){Et(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){Et(s),t&&Et(t),s=os(this.toPosix(s));let e=0,r=-1,i=!0,n;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let o=t.length-1,a=-1;for(n=s.length-1;n>=0;--n){const l=s.charCodeAt(n);if(l===47){if(!i){e=n+1;break}}else a===-1&&(i=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return e===r?r=a:r===-1&&(r=s.length),s.slice(e,r)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!i){e=n+1;break}}else r===-1&&(i=!1,r=n+1);return r===-1?"":s.slice(e,r)},extname(s){Et(s),s=os(this.toPosix(s));let t=-1,e=0,r=-1,i=!0,n=0;for(let o=s.length-1;o>=0;--o){const a=s.charCodeAt(o);if(a===47){if(!i){e=o+1;break}continue}r===-1&&(i=!1,r=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||r===-1||n===0||n===1&&t===r-1&&t===e+1?"":s.slice(t,r)},parse(s){Et(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=os(this.toPosix(s));let e=s.charCodeAt(0);const r=this.isAbsolute(s);let i;t.root=this.rootname(s),r||this.hasProtocol(s)?i=1:i=0;let n=-1,o=0,a=-1,l=!0,h=s.length-1,c=0;for(;h>=i;--h){if(e=s.charCodeAt(h),e===47){if(!l){o=h+1;break}continue}a===-1&&(l=!1,a=h+1),e===46?n===-1?n=h:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||a===-1||c===0||c===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&r?t.base=t.name=s.slice(1,a):t.base=t.name=s.slice(o,a)):(o===0&&r?(t.name=s.slice(1,n),t.base=s.slice(1,a)):(t.name=s.slice(o,n),t.base=s.slice(o,a)),t.ext=s.slice(n,a)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function el(s,t,e,r,i){const n=t[e];for(let o=0;o<n.length;o++){const a=n[o];e<t.length-1?el(s.replace(r[e],a),t,e+1,r,i):i.push(s.replace(r[e],a))}}function Mc(s){const t=/\{(.*?)\}/g,e=s.match(t),r=[];if(e){const i=[];e.forEach(n=>{const o=n.substring(1,n.length-1).split(",");i.push(o)}),el(s,i,0,e,r)}else r.push(s);return r}const xr=s=>!Array.isArray(s);class es{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){const{alias:e,src:r}=t;return Ot(e||r,n=>typeof n=="string"?n:Array.isArray(n)?n.map(o=>o?.src??o):n?.src?n.src:n,!0)}addManifest(t){this._manifest&&Z("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];let i=e;Array.isArray(e)||(i=Object.entries(e).map(([n,o])=>typeof o=="string"||Array.isArray(o)?{alias:n,src:o}:{alias:n,...o})),i.forEach(n=>{const o=n.src,a=n.alias;let l;if(typeof a=="string"){const h=this._createBundleAssetId(t,a);r.push(h),l=[a,h]}else{const h=a.map(c=>this._createBundleAssetId(t,c));r.push(...h),l=[...a,...h]}this.add({...n,alias:l,src:o})}),this._bundles[t]=r}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let r;r=n=>{this.hasKey(n)&&Z(`[Resolver] already has key: ${n} overwriting`)},Ot(e).forEach(n=>{const{src:o}=n;let{data:a,format:l,loadParser:h,parser:c}=n;const u=Ot(o).map(m=>typeof m=="string"?Mc(m):Array.isArray(m)?m:[m]),f=this.getAlias(n);Array.isArray(f)?f.forEach(r):r(f);const d=[],p=m=>{const g=this._parsers.find(y=>y.test(m));return{src:m,...g?.parse(m)}};u.forEach(m=>{m.forEach(g=>{let y={};if(typeof g!="object"?y=p(g):(a=g.data??a,l=g.format??l,(g.loadParser||g.parser)&&(h=g.loadParser??h,c=g.parser??c),y={...p(g.src),...g}),!f)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this._buildResolvedAsset(y,{aliases:f,data:a,format:l,loadParser:h,parser:c,progressSize:n.progressSize}),d.push(y)})}),f.forEach(m=>{this._assetMap[m]=d})})}resolveBundle(t){const e=xr(t);t=Ot(t);const r={};return t.forEach(i=>{const n=this._bundles[i];if(n){const o=this.resolve(n),a={};for(const l in o){const h=o[l];a[this._extractAssetIdFromBundle(i,l)]=h}r[i]=a}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const i in e)r[i]=e[i].src;return r}return e.src}resolve(t){const e=xr(t);t=Ot(t);const r={};return t.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let n=this._assetMap[i];const o=this._getPreferredOrder(n);o?.priority.forEach(a=>{o.params[a].forEach(l=>{const h=n.filter(c=>c[a]?c[a]===l:!1);h.length&&(n=h)})}),this._resolverHash[i]=n[0]}else this._resolverHash[i]=this._buildResolvedAsset({alias:[i],src:i},{});r[i]=this._resolverHash[i]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[e],i=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:r,data:i,loadParser:n,parser:o,format:a,progressSize:l}=e;return(this._basePath||this._rootPath)&&(t.src=At.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...i||{},...t.data},t.loadParser=n??t.loadParser,t.parser=o??t.parser,t.format=a??t.format??Ic(t.src),l!==void 0&&(t.progressSize=l),t}}es.RETINA_PREFIX=/@([0-9\.]+)x/;function Ic(s){return s.split(".").pop().split("?").shift().split("#").shift()}const Mi=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},sl=class ms{constructor(t,e){this.linkedSheets=[];let r=t;t?.source instanceof Dt&&(r={texture:t,data:e});const{texture:i,data:n,cachePrefix:o=""}=r;this.cachePrefix=o,this._texture=i instanceof j?i:null,this.textureSource=i.source,this.textures={},this.animations={},this.data=n;const a=parseFloat(n.meta.scale);a?(this.resolution=a,i.source.resolution=this.resolution):this.resolution=i.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=ms.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}parseSync(){return this._processFrames(0,!0),this._processAnimations(),this.textures}_processFrames(t,e=!1){let r=t;const i=e?1/0:ms.BATCH_SIZE;for(;r-t<i&&r<this._frameKeys.length;){const n=this._frameKeys[r],o=this._frames[n],a=o.frame;if(a){let l=null,h=null;const c=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,u=new Q(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);o.rotated?l=new Q(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):l=new Q(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(h=new Q(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[n]=new j({source:this.textureSource,frame:l,orig:u,trim:h,rotate:o.rotated?2:0,defaultAnchor:o.anchor,defaultBorders:o.borders,label:n.toString()})}r++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const i=t[e][r];this.animations[e].push(this.textures[i])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*ms.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*ms.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};sl.BATCH_SIZE=1e3;let Kn=sl;const Oc=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function rl(s,t,e){const r={};if(s.forEach(i=>{r[i]=t}),Object.keys(t.textures).forEach(i=>{r[`${t.cachePrefix}${i}`]=t.textures[i]}),!e){const i=At.dirname(s[0]);t.linkedSheets.forEach((n,o)=>{const a=rl([`${i}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(r,a)})}return r}const Lc={extension:M.Asset,cache:{test:s=>s instanceof Kn,getCacheableAssets:(s,t)=>rl(s,t,!1)},resolver:{extension:{type:M.ResolveParser,name:"resolveSpritesheet"},test:s=>{const e=s.split("?")[0].split("."),r=e.pop(),i=e.pop();return r==="json"&&Oc.includes(i)},parse:s=>{const t=s.split(".");return{resolution:parseFloat(es.RETINA_PREFIX.exec(s)?.[1]??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:M.LoadParser,priority:ne.Normal,name:"spritesheetLoader"},async testParse(s,t){return At.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){const{texture:r,imageFilename:i,textureOptions:n,cachePrefix:o}=t?.data??{};let a=At.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let l;if(r instanceof j)l=r;else{const u=Mi(a+(i??s.meta.image),t.src);l=(await e.load([{src:u,data:n}]))[u]}const h=new Kn({texture:l.source,data:s,cachePrefix:o});await h.parse();const c=s?.meta?.related_multi_packs;if(Array.isArray(c)){const u=[];for(const d of c){if(typeof d!="string")continue;let p=a+d;t.data?.ignoreMultiPack||(p=Mi(p,t.src),u.push(e.load({src:p,data:{textureOptions:n,ignoreMultiPack:!0}})))}const f=await Promise.all(u);h.linkedSheets=f,f.forEach(d=>{d.linkedSheets=[h].concat(h.linkedSheets.filter(p=>p!==d))})}return h},async unload(s,t,e){await e.unload(s.textureSource._sourceOrigin),s.destroy(!1)}}};K.add(Lc);const Kr=Object.create(null),Jn=Object.create(null);function cn(s,t){let e=Jn[s];return e===void 0&&(Kr[t]===void 0&&(Kr[t]=1),Jn[s]=e=Kr[t]++),e}let Ks;function il(){return(!Ks||Ks?.isContextLost())&&(Ks=J.get().createCanvas().getContext("webgl",{})),Ks}let Js;function Bc(){if(!Js){Js="mediump";const s=il();s&&s.getShaderPrecisionFormat&&(Js=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?"highp":"mediump")}return Js}function Dc(s,t,e){return t?s:e?(s=s.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${s}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${s}
        `}function $c(s,t,e){const r=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(s.substring(0,9)!=="precision"){let i=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return i==="highp"&&r!=="highp"&&(i="mediump"),`precision ${i} float;
${s}`}else if(r!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}function Uc(s,t){return t?`#version 300 es
${s}`:s}const Fc={},jc={};function Nc(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const r=e?Fc:jc;return r[t]?(r[t]++,t+=`-${r[t]}`):r[t]=1,s.indexOf("#define SHADER_NAME")!==-1?s:`${`#define SHADER_NAME ${t}`}
${s}`}function Gc(s,t){return t?s.replace("#version 300 es",""):s}const Jr={stripVersion:Gc,ensurePrecision:$c,addProgramDefines:Dc,setProgramName:Nc,insertVersion:Uc},as=Object.create(null),nl=class Ii{constructor(t){t={...Ii.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,r={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Bc()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let i=t.fragment,n=t.vertex;Object.keys(Jr).forEach(o=>{const a=r[o];i=Jr[o](i,a,!0),n=Jr[o](n,a,!1)}),this.fragment=i,this.vertex=n,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=cn(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,as[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return as[e]||(as[e]=new Ii(t),as[e]._cacheKey=e),as[e]}};nl.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let ol=nl;const Zn={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Wc(s){return Zn[s]??Zn.float32}const zc={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"},Qn=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|\)|$)/g;function to(s,t){let e;for(;(e=Qn.exec(s))!==null;){const r=zc[e[3]]??"float32";t[e[2]]={location:parseInt(e[1],10),format:r,stride:Wc(r).stride,offset:0,instance:!1,start:0}}Qn.lastIndex=0}function Hc(s){return s.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"")}function Vc({source:s,entryPoint:t}){const e={},r=Hc(s),i=r.indexOf(`fn ${t}(`);if(i===-1)return e;const n=r.indexOf("->",i);if(n===-1)return e;const o=r.substring(i,n);if(to(o,e),Object.keys(e).length===0){const a=o.match(/\(\s*\w+\s*:\s*(\w+)/);if(a){const l=a[1],h=new RegExp(`struct\\s+${l}\\s*\\{([^}]+)\\}`,"s"),c=r.match(h);c&&to(c[1],e)}}return e}function Zr(s){const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,i=/var(<[^>]+>)? (\w+)/,n=/:\s*([\w<>]+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,h=s.match(t)?.map(u=>({group:parseInt(u.match(e)[1],10),binding:parseInt(u.match(r)[1],10),name:u.match(i)[2],isUniform:u.match(i)[1]==="<uniform>",type:u.match(n)[1]}));if(!h)return{groups:[],structs:[]};const c=s.match(o)?.map(u=>{const f=u.match(l)[1],d=u.match(a).reduce((p,m)=>{const[g,y]=m.split(":");return p[g.trim()]=y.trim(),p},{});return d?{name:f,members:d}:null}).filter(({name:u})=>h.some(f=>f.type===u||f.type.includes(`<${u}>`)))??[];return{groups:h,structs:c}}var be=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(be||{});function qc({groups:s}){const t=[];for(let e=0;e<s.length;e++){const r=s[e];t[r.group]||(t[r.group]=[]),r.isUniform?t[r.group].push({binding:r.binding,visibility:be.VERTEX|be.FRAGMENT,buffer:{type:"uniform"}}):r.type==="sampler"?t[r.group].push({binding:r.binding,visibility:be.FRAGMENT,sampler:{type:"filtering"}}):r.type==="texture_2d"||r.type.startsWith("texture_2d<")?t[r.group].push({binding:r.binding,visibility:be.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}}):r.type==="texture_2d_array"||r.type.startsWith("texture_2d_array<")?t[r.group].push({binding:r.binding,visibility:be.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d-array",multisampled:!1}}):(r.type==="texture_cube"||r.type.startsWith("texture_cube<"))&&t[r.group].push({binding:r.binding,visibility:be.FRAGMENT,texture:{sampleType:"float",viewDimension:"cube",multisampled:!1}})}for(let e=0;e<t.length;e++)t[e]||(t[e]=[]);return t}function Yc({groups:s}){const t=[];for(let e=0;e<s.length;e++){const r=s[e];t[r.group]||(t[r.group]={}),t[r.group][r.name]=r.binding}return t}function Xc(s,t){const e=new Set,r=new Set,i=[...s.structs,...t.structs].filter(o=>e.has(o.name)?!1:(e.add(o.name),!0)),n=[...s.groups,...t.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return r.has(a)?!1:(r.add(a),!0)});return{structs:i,groups:n}}const ls=Object.create(null);class Pr{constructor(t){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:r,layout:i,gpuLayout:n,name:o}=t;if(this.name=o,this.fragment=e,this.vertex=r,e.source===r.source){const a=Zr(e.source);this.structsAndGroups=a}else{const a=Zr(r.source),l=Zr(e.source);this.structsAndGroups=Xc(a,l)}this.layout=i??Yc(this.structsAndGroups),this.gpuLayout=n??qc(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,r=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=cn(r,"program")}get attributeData(){return this._attributeData??(this._attributeData=Vc(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,ls[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return ls[e]||(ls[e]=new Pr(t),ls[e]._cacheKey=e),ls[e]}}const al=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Kc=al.reduce((s,t)=>(s[t]=!0,s),{});function Jc(s,t){switch(s){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ll=class hl{constructor(t,e){this._touched=0,this.uid=it("uniform"),this._resourceType="uniformGroup",this._resourceId=it("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...hl.defaultOptions,...e},this.uniformStructures=t;const r={};for(const i in t){const n=t[i];if(n.name=i,n.size=n.size??1,!Kc[n.type]){const o=n.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,l]=o;throw new Error(`Uniform type ${n.type} is not supported. Use type: '${a}', size: ${l} instead.`)}throw new Error(`Uniform type ${n.type} is not supported. Supported uniform types are: ${al.join(", ")}`)}n.value??(n.value=Jc(n.type,n.size)),r[i]=n.value}this.uniforms=r,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=cn(Object.keys(r).map(i=>`${i}-${t[i].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};ll.defaultOptions={ubo:!1,isStatic:!1};let cl=ll;class yr{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const r in t){const i=t[r];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const r in this.resources)t[e++]=this.resources[r]._resourceId;this._key=t.join("|")}setResource(t,e){const r=this.resources[e];t!==r&&(r&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t,e){const r=this.resources;for(const i in r)r[i]._gcLastUsed=t,r[i]._touched=e}destroy(){const t=this.resources;for(const e in t)t[e]?.off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const r in e)e[r]===t&&(e[r]=null)}else this._updateKey()}}var Oi=(s=>(s[s.WEBGL=1]="WEBGL",s[s.WEBGPU=2]="WEBGPU",s[s.CANVAS=4]="CANVAS",s[s.BOTH=3]="BOTH",s))(Oi||{});class un extends Gt{constructor(t){super(),this.uid=it("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[],this._destroyed=!1;let{gpuProgram:e,glProgram:r,groups:i,resources:n,compatibleRenderers:o,groupMap:a}=t;this.gpuProgram=e,this.glProgram=r,o===void 0&&(o=0,e&&(o|=Oi.WEBGPU),r&&(o|=Oi.WEBGL)),this.compatibleRenderers=o;const l={};if(!n&&!i&&(n={}),n&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&i&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&i&&a)for(const h in a)for(const c in a[h]){const u=a[h][c];l[u]={group:h,binding:c,name:u}}else if(e&&i&&!a){const h=e.structsAndGroups.groups;a={},h.forEach(c=>{a[c.group]=a[c.group]||{},a[c.group][c.binding]=c.name,l[c.name]=c})}else if(n){i={},a={},e&&e.structsAndGroups.groups.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,l[u.name]=u});let h=0;for(const c in n)l[c]||(i[99]||(i[99]=new yr,this._ownedBindGroups.push(i[99])),l[c]={group:99,binding:h,name:c},a[99]=a[99]||{},a[99][h]=c,h++);for(const c in n){const u=c;let f=n[c];!f.source&&!f._resourceType&&(f=new cl(f));const d=l[u];d&&(i[d.group]||(i[d.group]=new yr,this._ownedBindGroups.push(i[d.group])),i[d.group].setResource(f,d.binding))}}this.groups=i,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(i,l)}addResource(t,e,r){var i,n;(i=this._uniformBindMap)[e]||(i[e]={}),(n=this._uniformBindMap[e])[r]||(n[r]=t),this.groups[e]||(this.groups[e]=new yr,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const r={};for(const i in e){const n=e[i];Object.defineProperty(r,n.name,{get(){return t[n.group].getResource(n.binding)},set(o){t[n.group].setResource(o,n.binding)}})}return r}destroy(t=!1){this._destroyed||(this._destroyed=!0,this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(e=>{e.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null)}static from(t){const{gpu:e,gl:r,...i}=t;let n,o;return e&&(n=Pr.from(e)),r&&(o=ol.from(r)),new un({gpuProgram:n,glProgram:o,...i})}}const Zc={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},Qr=0,ti=1,ei=2,si=3,ri=4,ii=5,Li=class ul{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Qr)}set blend(t){!!(this.data&1<<Qr)!==t&&(this.data^=1<<Qr)}get offsets(){return!!(this.data&1<<ti)}set offsets(t){!!(this.data&1<<ti)!==t&&(this.data^=1<<ti)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<ei)}set culling(t){!!(this.data&1<<ei)!==t&&(this.data^=1<<ei)}get depthTest(){return!!(this.data&1<<si)}set depthTest(t){!!(this.data&1<<si)!==t&&(this.data^=1<<si)}get depthMask(){return!!(this.data&1<<ii)}set depthMask(t){!!(this.data&1<<ii)!==t&&(this.data^=1<<ii)}get clockwiseFrontFace(){return!!(this.data&1<<ri)}set clockwiseFrontFace(t){!!(this.data&1<<ri)!==t&&(this.data^=1<<ri)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=Zc[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new ul;return t.depthTest=!1,t.blend=!0,t}};Li.default2d=Li.for2d();let dl=Li;const Bi=[];K.handleByNamedList(M.Environment,Bi);async function Qc(s){if(!s)for(let t=0;t<Bi.length;t++){const e=Bi[t];if(e.value.test()){await e.value.load();return}}}let hs;function tu(){if(typeof hs=="boolean")return hs;try{hs=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{hs=!1}return hs}function eo(s,t,e=2){const r=t&&t.length,i=r?t[0]*e:s.length;let n=fl(s,0,i,e,!0);const o=[];if(!n||n.next===n.prev)return o;let a,l,h;if(r&&(n=nu(s,t,n,e)),s.length>80*e){a=s[0],l=s[1];let c=a,u=l;for(let f=e;f<i;f+=e){const d=s[f],p=s[f+1];d<a&&(a=d),p<l&&(l=p),d>c&&(c=d),p>u&&(u=p)}h=Math.max(c-a,u-l),h=h!==0?32767/h:0}return Cs(n,o,e,a,l,h,0),o}function fl(s,t,e,r,i){let n;if(i===mu(s,t,e,r)>0)for(let o=t;o<e;o+=r)n=so(o/r|0,s[o],s[o+1],n);else for(let o=e-r;o>=t;o-=r)n=so(o/r|0,s[o],s[o+1],n);return n&&Qe(n,n.next)&&(Ps(n),n=n.next),n}function ke(s,t){if(!s)return s;t||(t=s);let e=s,r;do if(r=!1,!e.steiner&&(Qe(e,e.next)||tt(e.prev,e,e.next)===0)){if(Ps(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function Cs(s,t,e,r,i,n,o){if(!s)return;!o&&n&&cu(s,r,i,n);let a=s;for(;s.prev!==s.next;){const l=s.prev,h=s.next;if(n?su(s,r,i,n):eu(s)){t.push(l.i,s.i,h.i),Ps(s),s=h.next,a=h.next;continue}if(s=h,s===a){o?o===1?(s=ru(ke(s),t),Cs(s,t,e,r,i,n,2)):o===2&&iu(s,t,e,r,i,n):Cs(ke(s),t,e,r,i,n,1);break}}}function eu(s){const t=s.prev,e=s,r=s.next;if(tt(t,e,r)>=0)return!1;const i=t.x,n=e.x,o=r.x,a=t.y,l=e.y,h=r.y,c=Math.min(i,n,o),u=Math.min(a,l,h),f=Math.max(i,n,o),d=Math.max(a,l,h);let p=r.next;for(;p!==t;){if(p.x>=c&&p.x<=f&&p.y>=u&&p.y<=d&&ys(i,a,n,l,o,h,p.x,p.y)&&tt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function su(s,t,e,r){const i=s.prev,n=s,o=s.next;if(tt(i,n,o)>=0)return!1;const a=i.x,l=n.x,h=o.x,c=i.y,u=n.y,f=o.y,d=Math.min(a,l,h),p=Math.min(c,u,f),m=Math.max(a,l,h),g=Math.max(c,u,f),y=Di(d,p,t,e,r),x=Di(m,g,t,e,r);let b=s.prevZ,_=s.nextZ;for(;b&&b.z>=y&&_&&_.z<=x;){if(b.x>=d&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&ys(a,c,l,u,h,f,b.x,b.y)&&tt(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=d&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==o&&ys(a,c,l,u,h,f,_.x,_.y)&&tt(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=y;){if(b.x>=d&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&ys(a,c,l,u,h,f,b.x,b.y)&&tt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=x;){if(_.x>=d&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==o&&ys(a,c,l,u,h,f,_.x,_.y)&&tt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function ru(s,t){let e=s;do{const r=e.prev,i=e.next.next;!Qe(r,i)&&gl(r,e,e.next,i)&&Es(r,i)&&Es(i,r)&&(t.push(r.i,e.i,i.i),Ps(e),Ps(e.next),e=s=i),e=e.next}while(e!==s);return ke(e)}function iu(s,t,e,r,i,n){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&fu(o,a)){let l=ml(o,a);o=ke(o,o.next),l=ke(l,l.next),Cs(o,t,e,r,i,n,0),Cs(l,t,e,r,i,n,0);return}a=a.next}o=o.next}while(o!==s)}function nu(s,t,e,r){const i=[];for(let n=0,o=t.length;n<o;n++){const a=t[n]*r,l=n<o-1?t[n+1]*r:s.length,h=fl(s,a,l,r,!1);h===h.next&&(h.steiner=!0),i.push(du(h))}i.sort(ou);for(let n=0;n<i.length;n++)e=au(i[n],e);return e}function ou(s,t){let e=s.x-t.x;if(e===0&&(e=s.y-t.y,e===0)){const r=(s.next.y-s.y)/(s.next.x-s.x),i=(t.next.y-t.y)/(t.next.x-t.x);e=r-i}return e}function au(s,t){const e=lu(s,t);if(!e)return t;const r=ml(e,s);return ke(r,r.next),ke(e,e.next)}function lu(s,t){let e=t;const r=s.x,i=s.y;let n=-1/0,o;if(Qe(s,e))return e;do{if(Qe(s,e.next))return e.next;if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){const u=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=r&&u>n&&(n=u,o=e.x<e.next.x?e:e.next,u===r))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,l=o.x,h=o.y;let c=1/0;e=o;do{if(r>=e.x&&e.x>=l&&r!==e.x&&pl(i<h?r:n,i,l,h,i<h?n:r,i,e.x,e.y)){const u=Math.abs(i-e.y)/(r-e.x);Es(e,s)&&(u<c||u===c&&(e.x>o.x||e.x===o.x&&hu(o,e)))&&(o=e,c=u)}e=e.next}while(e!==a);return o}function hu(s,t){return tt(s.prev,s,t.prev)<0&&tt(t.next,s,s.next)<0}function cu(s,t,e,r){let i=s;do i.z===0&&(i.z=Di(i.x,i.y,t,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,uu(i)}function uu(s){let t,e=1;do{let r=s,i;s=null;let n=null;for(t=0;r;){t++;let o=r,a=0;for(let h=0;h<e&&(a++,o=o.nextZ,!!o);h++);let l=e;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||r.z<=o.z)?(i=r,r=r.nextZ,a--):(i=o,o=o.nextZ,l--),n?n.nextZ=i:s=i,i.prevZ=n,n=i;r=o}n.nextZ=null,e*=2}while(t>1);return s}function Di(s,t,e,r,i){return s=(s-e)*i|0,t=(t-r)*i|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function du(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function pl(s,t,e,r,i,n,o,a){return(i-o)*(t-a)>=(s-o)*(n-a)&&(s-o)*(r-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(i-o)*(r-a)}function ys(s,t,e,r,i,n,o,a){return!(s===o&&t===a)&&pl(s,t,e,r,i,n,o,a)}function fu(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!pu(s,t)&&(Es(s,t)&&Es(t,s)&&gu(s,t)&&(tt(s.prev,s,t.prev)||tt(s,t.prev,t))||Qe(s,t)&&tt(s.prev,s,s.next)>0&&tt(t.prev,t,t.next)>0)}function tt(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function Qe(s,t){return s.x===t.x&&s.y===t.y}function gl(s,t,e,r){const i=Qs(tt(s,t,e)),n=Qs(tt(s,t,r)),o=Qs(tt(e,r,s)),a=Qs(tt(e,r,t));return!!(i!==n&&o!==a||i===0&&Zs(s,e,t)||n===0&&Zs(s,r,t)||o===0&&Zs(e,s,r)||a===0&&Zs(e,t,r))}function Zs(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function Qs(s){return s>0?1:s<0?-1:0}function pu(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&gl(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Es(s,t){return tt(s.prev,s,s.next)<0?tt(s,t,s.next)>=0&&tt(s,s.prev,t)>=0:tt(s,t,s.prev)<0||tt(s,s.next,t)<0}function gu(s,t){let e=s,r=!1;const i=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&i<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==s);return r}function ml(s,t){const e=$i(s.i,s.x,s.y),r=$i(t.i,t.x,t.y),i=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=i,i.prev=e,r.next=e,e.prev=r,n.next=r,r.prev=n,r}function so(s,t,e,r){const i=$i(s,t,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ps(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function $i(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function mu(s,t,e,r){let i=0;for(let n=t,o=e-r;n<e;n+=r)i+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return i}const yu=eo.default||eo;var yl=(s=>(s[s.NONE=0]="NONE",s[s.COLOR=16384]="COLOR",s[s.STENCIL=1024]="STENCIL",s[s.DEPTH=256]="DEPTH",s[s.COLOR_DEPTH=16640]="COLOR_DEPTH",s[s.COLOR_STENCIL=17408]="COLOR_STENCIL",s[s.DEPTH_STENCIL=1280]="DEPTH_STENCIL",s[s.ALL=17664]="ALL",s))(yl||{});class _u{constructor(t){this.items=[],this._name=t}emit(t,e,r,i,n,o,a,l){const{name:h,items:c}=this;for(let u=0,f=c.length;u<f;u++)c[u][h](t,e,r,i,n,o,a,l);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const bu=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],_l=class bl extends Gt{constructor(t){super(),this.tick=0,this.uid=it("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...bu,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await Qc(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)t={...this._systemsHash[r].constructor.defaultOptions,...t};t={...bl.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(t);this._initOptions=t}render(t,e){this.tick++;let r=t;if(r instanceof H&&(r={container:r},e&&(W(rt,"passing a second argument is deprecated, please use render options instead"),r.target=e.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const i=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=i?r.clearColor:ht.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.visible&&(r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r))}resize(t,e,r){const i=this.view.resolution;this.view.resize(t,e,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==i&&this.runners.resolutionChange.emit(r)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=yl.ALL);const{clear:r,clearColor:i,target:n,mipLevel:o,layer:a}=t;ht.shared.setValue(i??this.background.colorRgba),e.renderTarget.clear(n,r,ht.shared.toArray(),o??0,a??0)}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new _u(e)})}_addSystems(t){let e;for(e in t){const r=t[e];this._addSystem(r.value,r.name)}}_addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const i in this.runners)this.runners[i].add(r);return this}_addPipes(t,e){const r=e.reduce((i,n)=>(i[n.name]=n.value,i),{});t.forEach(i=>{const n=i.value,o=i.name,a=r[o];this.renderPipes[o]=new n(this,a?new a:null),this.runners.destroy.add(this.renderPipes[o])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&Fs.release(),Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!tu())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};_l.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let xl=_l,tr;function xu(s){return tr!==void 0||(tr=(()=>{const t={stencil:!0,failIfMajorPerformanceCaveat:s??xl.defaultOptions.failIfMajorPerformanceCaveat};try{if(!J.get().getWebGLRenderingContext())return!1;let r=J.get().createCanvas().getContext("webgl",t);const i=!!r?.getContextAttributes()?.stencil;if(r){const n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,i}catch{return!1}})()),tr}let er;async function wu(s={}){return er!==void 0||(er=await(async()=>{const t=J.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(s)).requestDevice(),!0}catch{return!1}})()),er}const ro=["webgl","webgpu","canvas"];async function vu(s){let t=[];s.preference?(t.push(s.preference),ro.forEach(n=>{n!==s.preference&&t.push(n)})):t=ro.slice();let e,r={};for(let n=0;n<t.length;n++){const o=t[n];if(o==="webgpu"&&await wu()){const{WebGPURenderer:a}=await ze(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-EjlDT_eo.js");return{WebGPURenderer:l}},__vite__mapDeps([3,4,5,2]));e=a,r={...s,...s.webgpu};break}else if(o==="webgl"&&xu(s.failIfMajorPerformanceCaveat??xl.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await ze(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-CidRy07d.js");return{WebGLRenderer:l}},__vite__mapDeps([6,4,5,2]));e=a,r={...s,...s.webgl};break}else if(o==="canvas"){const{CanvasRenderer:a}=await ze(async()=>{const{CanvasRenderer:l}=await import("./CanvasRenderer-huKEzz5P.js");return{CanvasRenderer:l}},__vite__mapDeps([7,5,2]));e=a,r={...s,...s.canvasOptions};break}}if(delete r.webgpu,delete r.webgl,delete r.canvasOptions,!e)throw new Error("No available renderer for the current environment");const i=new e;return await i.init(r),i}const wl="8.16.0";class vl{static init(){globalThis.__PIXI_APP_INIT__?.(this,wl)}static destroy(){}}vl.extension=M.Application;class Su{constructor(t){this._renderer=t}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,wl)}destroy(){this._renderer=null}}Su.extension={type:[M.WebGLSystem,M.WebGPUSystem],name:"initHook",priority:-10};class Sl{static init(t){Object.defineProperty(this,"resizeTo",{configurable:!0,set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;e=i,r=n}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Sl.extension=M.Application;class Al{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{configurable:!0,set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,ks.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?jt.shared:new jt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Al.extension=M.Application;K.add(Sl);K.add(Al);const Tl=class Ui{constructor(...t){this.stage=new H,t[0]!==void 0&&W(rt,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.stage||(this.stage=new H),this.renderer=await vu(t),Ui._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return W(rt,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const r=Ui._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Tl._plugins=[];let kl=Tl;K.handleByList(M.Application,kl._plugins);K.add(vl);const ni={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in t){const f=t[u].match(/^[a-z]+/gm)[0],d=t[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),p={};for(const m in d){const g=d[m].split("="),y=g[0],x=g[1].replace(/"/gm,""),b=parseFloat(x),_=isNaN(b)?x:b;p[y]=_}e[f].push(p)}const r={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[i]=e.info,[n]=e.common,[o]=e.distanceField??[];o&&(r.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),r.fontSize=parseInt(i.size,10),r.fontFamily=i.face,r.lineHeight=parseInt(n.lineHeight,10);const a=e.page;for(let u=0;u<a.length;u++)r.pages.push({id:parseInt(a[u].id,10)||0,file:a[u].file});const l={};r.baseLineOffset=r.lineHeight-parseInt(n.base,10);const h=e.char;for(let u=0;u<h.length;u++){const f=h[u],d=parseInt(f.id,10);let p=f.letter??f.char??String.fromCharCode(d);p==="space"&&(p=" "),l[d]=p,r.chars[p]={id:d,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}const c=e.kerning||[];for(let u=0;u<c.length;u++){const f=parseInt(c[u].first,10),d=parseInt(c[u].second,10),p=parseInt(c[u].amount,10);r.chars[l[d]].kerning[l[f]]=p}return r}},io={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],r=s.getElementsByTagName("common")[0],i=s.getElementsByTagName("distanceField")[0];i&&(t.distanceField={type:i.getAttribute("fieldType"),range:parseInt(i.getAttribute("distanceRange"),10)});const n=s.getElementsByTagName("page"),o=s.getElementsByTagName("char"),a=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(r.getAttribute("lineHeight"),10);for(let h=0;h<n.length;h++)t.pages.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});const l={};t.baseLineOffset=t.lineHeight-parseInt(r.getAttribute("base"),10);for(let h=0;h<o.length;h++){const c=o[h],u=parseInt(c.getAttribute("id"),10);let f=c.getAttribute("letter")??c.getAttribute("char")??String.fromCharCode(u);f==="space"&&(f=" "),l[u]=f,t.chars[f]={id:u,page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xOffset:parseInt(c.getAttribute("xoffset"),10),yOffset:parseInt(c.getAttribute("yoffset"),10),xAdvance:parseInt(c.getAttribute("xadvance"),10),kerning:{}}}for(let h=0;h<a.length;h++){const c=parseInt(a[h].getAttribute("first"),10),u=parseInt(a[h].getAttribute("second"),10),f=parseInt(a[h].getAttribute("amount"),10);t.chars[l[u]].kerning[l[c]]=f}return t}},no={test(s){return typeof s=="string"&&s.match(/<font(\s|>)/)?io.test(J.get().parseXML(s)):!1},parse(s){return io.parse(J.get().parseXML(s))}},Au=[".xml",".fnt"],Tu={extension:{type:M.CacheParser,name:"cacheBitmapFont"},test:s=>!!s?.pages&&!!s?.chars&&typeof s?.fontFamily=="string",getCacheableAssets(s,t){const e={};return s.forEach(r=>{e[r]=t,e[`${r}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},ku={extension:{type:M.LoadParser,priority:ne.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return Au.includes(At.extname(s).toLowerCase())},async testParse(s){return ni.test(s)||no.test(s)},async parse(s,t,e){const r=ni.test(s)?ni.parse(s):no.parse(s),{src:i}=t,{pages:n}=r,o=[],a=r.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let f=0;f<n.length;++f){const d=n[f].file;let p=At.join(At.dirname(i),d);p=Mi(p,i),o.push({src:p,data:a})}const[l,{BitmapFont:h}]=await Promise.all([e.load(o),ze(()=>import("./BitmapFont--u43fdo0.js"),[])]),c=o.map(f=>l[f.src]);return new h({data:r,textures:c},i)},async load(s,t){return await(await J.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(r=>e.unload(r.texture.source._sourceOrigin))),s.destroy()}};class Cu{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const Eu={extension:{type:M.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(t=>t instanceof j),getCacheableAssets:(s,t)=>{const e={};return s.forEach(r=>{t.forEach((i,n)=>{e[r+(n===0?"":n+1)]=i})}),e}};async function Cl(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Pu={extension:{type:M.DetectionParser,priority:1},test:async()=>Cl("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},oo=["png","jpg","jpeg"],Ru={extension:{type:M.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...oo],remove:async s=>s.filter(t=>!oo.includes(t))},Mu="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Rr(s){return Mu?!1:document.createElement("video").canPlayType(s)!==""}const Iu={extension:{type:M.DetectionParser,priority:0},test:async()=>Rr("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},Ou={extension:{type:M.DetectionParser,priority:0},test:async()=>Rr("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},Lu={extension:{type:M.DetectionParser,priority:0},test:async()=>Rr("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},Bu={extension:{type:M.DetectionParser,priority:0},test:async()=>Cl("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")},El=class _r{constructor(){this.loadOptions={..._r.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let i=null,n=null;if((e.parser||e.loadParser)&&(n=this._parserHash[e.parser||e.loadParser],e.loadParser&&Z(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),n||Z(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!n){for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];if(a.load&&a.test?.(t,e,this)){n=a;break}}if(!n)return Z(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await n.load(t,e,this),r.parser=n;for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(i,e,this)&&(i=await a.parse(i,e,this)||i,r.parser=a)}return i})(),r}async load(t,e){this._parsersValidated||this._validateParsers();const r=typeof e=="function"?{..._r.defaultOptions,...this.loadOptions,onProgress:e}:{..._r.defaultOptions,...this.loadOptions,...e||{}},{onProgress:i,onError:n,strategy:o,retryCount:a,retryDelay:l}=r;let h=0;const c={},u=xr(t),f=Ot(t,m=>({alias:[m],src:m,data:{}})),d=f.reduce((m,g)=>m+(g.progressSize||1),0),p=f.map(async m=>{const g=At.toAbsolute(m.src);c[m.src]||(await this._loadAssetWithRetry(g,m,{onProgress:i,onError:n,strategy:o,retryCount:a,retryDelay:l},c),h+=m.progressSize||1,i&&i(h/d))});return await Promise.all(p),u?c[f[0].src]:c}async unload(t){const r=Ot(t,i=>({alias:[i],src:i})).map(async i=>{const n=At.toAbsolute(i.src),o=this.promiseCache[n];if(o){const a=await o.promise;delete this.promiseCache[n],await o.parser?.unload?.(a,i,this)}});await Promise.all(r)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?Z("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&Z(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}async _loadAssetWithRetry(t,e,r,i){let n=0;const{onError:o,strategy:a,retryCount:l,retryDelay:h}=r,c=u=>new Promise(f=>setTimeout(f,u));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,e)),i[e.src]=await this.promiseCache[t].promise;return}catch(u){delete this.promiseCache[t],delete i[e.src],n++;const f=a!=="retry"||n>l;if(a==="retry"&&!f){o&&o(u,e),await c(h);continue}if(a==="skip"){o&&o(u,e);return}o&&o(u,e);const d=new Error(`[Loader.load] Failed to load ${t}.
${u}`);throw u instanceof Error&&u.stack&&(d.stack=u.stack),d}}};El.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let Du=El;function ss(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function rs(s,t){const e=s.split("?")[0],r=At.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const $u=".json",Uu="application/json",Fu={extension:{type:M.LoadParser,priority:ne.Low},name:"loadJson",id:"json",test(s){return ss(s,Uu)||rs(s,$u)},async load(s){return await(await J.get().fetch(s)).json()}},ju=".txt",Nu="text/plain",Gu={name:"loadTxt",id:"text",extension:{type:M.LoadParser,priority:ne.Low,name:"loadTxt"},test(s){return ss(s,Nu)||rs(s,ju)},async load(s){return await(await J.get().fetch(s)).text()}},Wu=["normal","bold","100","200","300","400","500","600","700","800","900"],zu=[".ttf",".otf",".woff",".woff2"],Hu=["font/ttf","font/otf","font/woff","font/woff2"],Vu=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function qu(s){const t=At.extname(s),i=At.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let n=i.length>0;for(const a of i)if(!a.match(Vu)){n=!1;break}let o=i.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const Yu=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Xu(s){return Yu.test(s)?s:encodeURI(s)}const Ku={extension:{type:M.LoadParser,priority:ne.Low},name:"loadWebFont",id:"web-font",test(s){return ss(s,Hu)||rs(s,zu)},async load(s,t){const e=J.get().getFontFaceSet();if(e){const r=[],i=t.data?.family??qu(s),n=t.data?.weights?.filter(a=>Wu.includes(a))??["normal"],o=t.data??{};for(let a=0;a<n.length;a++){const l=n[a],h=new FontFace(i,`url(${Xu(s)})`,{...o,weight:l});await h.load(),e.add(h),r.push(h)}return dt.has(`${i}-and-url`)?dt.get(`${i}-and-url`).entries.push({url:s,faces:r}):dt.set(`${i}-and-url`,{entries:[{url:s,faces:r}]}),r.length===1?r[0]:r}return Z("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const t=Array.isArray(s)?s:[s],e=t[0].family,r=dt.get(`${e}-and-url`),i=r.entries.find(n=>n.faces.some(o=>t.indexOf(o)!==-1));i.faces=i.faces.filter(n=>t.indexOf(n)===-1),i.faces.length===0&&(r.entries=r.entries.filter(n=>n!==i)),t.forEach(n=>{J.get().getFontFaceSet().delete(n)}),r.entries.length===0&&dt.remove(`${e}-and-url`)}};var oi,ao;function Ju(){if(ao)return oi;ao=1,oi=e;var s={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function e(n){var o=[];return n.replace(t,function(a,l,h){var c=l.toLowerCase();for(h=i(h),c=="m"&&h.length>2&&(o.push([l].concat(h.splice(0,2))),c="l",l=l=="m"?"l":"L");;){if(h.length==s[c])return h.unshift(l),o.push(h);if(h.length<s[c])throw new Error("malformed path data");o.push([l].concat(h.splice(0,s[c])))}}),o}var r=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function i(n){var o=n.match(r);return o?o.map(Number):[]}return oi}var Zu=Ju();const Qu=ka(Zu);function td(s,t){const e=Qu(s),r=[];let i=null,n=0,o=0;for(let a=0;a<e.length;a++){const l=e[a],h=l[0],c=l;switch(h){case"M":n=c[1],o=c[2],t.moveTo(n,o);break;case"m":n+=c[1],o+=c[2],t.moveTo(n,o);break;case"H":n=c[1],t.lineTo(n,o);break;case"h":n+=c[1],t.lineTo(n,o);break;case"V":o=c[1],t.lineTo(n,o);break;case"v":o+=c[1],t.lineTo(n,o);break;case"L":n=c[1],o=c[2],t.lineTo(n,o);break;case"l":n+=c[1],o+=c[2],t.lineTo(n,o);break;case"C":n=c[5],o=c[6],t.bezierCurveTo(c[1],c[2],c[3],c[4],n,o);break;case"c":t.bezierCurveTo(n+c[1],o+c[2],n+c[3],o+c[4],n+c[5],o+c[6]),n+=c[5],o+=c[6];break;case"S":n=c[3],o=c[4],t.bezierCurveToShort(c[1],c[2],n,o);break;case"s":t.bezierCurveToShort(n+c[1],o+c[2],n+c[3],o+c[4]),n+=c[3],o+=c[4];break;case"Q":n=c[3],o=c[4],t.quadraticCurveTo(c[1],c[2],n,o);break;case"q":t.quadraticCurveTo(n+c[1],o+c[2],n+c[3],o+c[4]),n+=c[3],o+=c[4];break;case"T":n=c[1],o=c[2],t.quadraticCurveToShort(n,o);break;case"t":n+=c[1],o+=c[2],t.quadraticCurveToShort(n,o);break;case"A":n=c[6],o=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,o);break;case"a":n+=c[6],o+=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,o);break;case"Z":case"z":t.closePath(),r.length>0&&(i=r.pop(),i?(n=i.startX,o=i.startY):(n=0,o=0)),i=null;break;default:Z(`Unknown SVG path command: ${h}`)}h!=="Z"&&h!=="z"&&i===null&&(i={startX:n,startY:o},r.push(i))}return t}class dn{constructor(t=0,e=0,r=0){this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new dn(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-t,n=this.y-e;return i*=i,n*=n,i+n<=r}strokeContains(t,e,r,i=.5){if(this.radius===0)return!1;const n=this.x-t,o=this.y-e,a=this.radius,l=(1-i)*r,h=Math.sqrt(n*n+o*o);return h<=a+l&&h>a-(r-l)}getBounds(t){return t||(t=new Q),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class fn{constructor(t=0,e=0,r=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=i}clone(){return new fn(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return r*=r,i*=i,r+i<=1}strokeContains(t,e,r,i=.5){const{halfWidth:n,halfHeight:o}=this;if(n<=0||o<=0)return!1;const a=r*(1-i),l=r-a,h=n-l,c=o-l,u=n+a,f=o+a,d=t-this.x,p=e-this.y,m=d*d/(h*h)+p*p/(c*c),g=d*d/(u*u)+p*p/(f*f);return m>1&&g<=1}getBounds(t){return t||(t=new Q),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function ed(s,t,e,r,i,n){const o=s-e,a=t-r,l=i-e,h=n-r,c=o*l+a*h,u=l*l+h*h;let f=-1;u!==0&&(f=c/u);let d,p;f<0?(d=e,p=r):f>1?(d=i,p=n):(d=e+f*l,p=r+f*h);const m=s-d,g=t-p;return m*m+g*g}let sd,rd;class ws{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let i=0,n=e.length;i<n;i++)r.push(e[i].x,e[i].y);e=r}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,r=e.length;for(let i=0;i<r;i+=2){const n=e[i],o=e[i+1],a=e[(i+2)%r],l=e[(i+3)%r];t+=(a-n)*(l+o)}return t<0}containsPolygon(t){const e=this.getBounds(sd),r=t.getBounds(rd);if(!e.containsRect(r))return!1;const i=t.points;for(let n=0;n<i.length;n+=2){const o=i[n],a=i[n+1];if(!this.contains(o,a))return!1}return!0}clone(){const t=this.points.slice(),e=new ws(t);return e.closePath=this.closePath,e}contains(t,e){let r=!1;const i=this.points.length/2;for(let n=0,o=i-1;n<i;o=n++){const a=this.points[n*2],l=this.points[n*2+1],h=this.points[o*2],c=this.points[o*2+1];l>e!=c>e&&t<(h-a)*((e-l)/(c-l))+a&&(r=!r)}return r}strokeContains(t,e,r,i=.5){const n=r*r,o=n*(1-i),a=n-o,{points:l}=this,h=l.length-(this.closePath?0:2);for(let c=0;c<h;c+=2){const u=l[c],f=l[c+1],d=l[(c+2)%l.length],p=l[(c+3)%l.length],m=ed(t,e,u,f,d,p),g=Math.sign((d-u)*(e-f)-(p-f)*(t-u));if(m<=(g<0?a:o))return!0}return!1}getBounds(t){t||(t=new Q);const e=this.points;let r=1/0,i=-1/0,n=1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=2){const h=e[a],c=e[a+1];r=h<r?h:r,i=h>i?h:i,n=c<n?c:n,o=c>o?c:o}return t.x=r,t.width=i-r,t.y=n,t.height=o-n,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return W("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return W("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const sr=(s,t,e,r,i,n,o)=>{const a=s-e,l=t-r,h=Math.sqrt(a*a+l*l);return h>=i-n&&h<=i+o};class pn{constructor(t=0,e=0,r=0,i=0,n=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=i,this.radius=n}getBounds(t){return t||(t=new Q),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new pn(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),n=e-(this.y+r);const o=r*r;if(i*i+n*n<=o||(i=t-(this.x+this.width-r),i*i+n*n<=o)||(n=e-(this.y+this.height-r),i*i+n*n<=o)||(i=t-(this.x+r),i*i+n*n<=o))return!0}return!1}strokeContains(t,e,r,i=.5){const{x:n,y:o,width:a,height:l,radius:h}=this,c=r*(1-i),u=r-c,f=n+h,d=o+h,p=a-h*2,m=l-h*2,g=n+a,y=o+l;return(t>=n-c&&t<=n+u||t>=g-u&&t<=g+c)&&e>=d&&e<=d+m||(e>=o-c&&e<=o+u||e>=y-u&&e<=y+c)&&t>=f&&t<=f+p?!0:t<f&&e<d&&sr(t,e,f,d,h,u,c)||t>g-h&&e<d&&sr(t,e,g-h,d,h,u,c)||t>g-h&&e>y-h&&sr(t,e,g-h,y-h,h,u,c)||t<f&&e>y-h&&sr(t,e,f,y-h,h,u,c)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Pl={};function id(s,t,e){let r=2166136261;for(let i=0;i<t;i++)r^=s[i].uid,r=Math.imul(r,16777619),r>>>=0;return Pl[r]||nd(s,t,r,e)}function nd(s,t,e,r){const i={};let n=0;for(let a=0;a<r;a++){const l=a<t?s[a]:j.EMPTY.source;i[n++]=l.source,i[n++]=l.style}const o=new yr(i);return Pl[e]=o,o}class lo{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this.uint32View=null,this.float32View=null,this.uint16View=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._int32View=null,this._float64Array=null,this._bigUint64Array=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function ho(s,t,e,r){if(e??(e=0),r??(r=Math.min(s.byteLength-e,t.byteLength)),!(e&7)&&!(r&7)){const i=r/8;new Float64Array(t,0,i).set(new Float64Array(s,e,i))}else if(!(e&3)&&!(r&3)){const i=r/4;new Float32Array(t,0,i).set(new Float32Array(s,e,i))}else new Uint8Array(t).set(new Uint8Array(s,e,r))}const od={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var ad=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",s[s.NONE=5]="NONE",s))(ad||{});function co(s,t){return t.alphaMode==="no-premultiply-alpha"&&od[s]||s}const ld=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function hd(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function cd(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const r=ld.replace(/%forloop%/gi,hd(s));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}}finally{t.deleteShader(e)}return s}let Pe=null;function ud(){if(Pe)return Pe;const s=il();return Pe=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),Pe=cd(Pe,s),s.getExtension("WEBGL_lose_context")?.loseContext(),Pe}class dd{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class fd{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new dd,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null,this.elements=null}}const vs=[];let wr=0;Fs.register({clear:()=>{if(vs.length>0)for(const s of vs)s&&s.destroy();vs.length=0,wr=0}});function uo(){return wr>0?vs[--wr]:new fd}function fo(s){s.elements=null,vs[wr++]=s}let cs=0;const Rl=class Ml{constructor(t){this.uid=it("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...Ml.defaultOptions,...t},t.maxTextures||(W("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=ud());const{maxTextures:e,attributesInitialSize:r,indicesInitialSize:i}=t;this.attributeBuffer=new lo(r*4),this.indexBuffer=new Uint16Array(i),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)fo(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const r=t._batch.textures.ids[e._source.uid];return!r&&r!==0?!1:(t._textureId=r,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let r=uo(),i=r.textures;i.clear();const n=e[this.elementStart];let o=co(n.blendMode,n.texture._source),a=n.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,h=this.attributeBuffer.uint32View,c=this.indexBuffer;let u=this._batchIndexSize,f=this._batchIndexStart,d="startBatch",p=[];const m=this.maxTextures;for(let g=this.elementStart;g<this.elementSize;++g){const y=e[g];e[g]=null;const b=y.texture._source,_=co(y.blendMode,b),w=o!==_||a!==y.topology;if(b._batchTick===cs&&!w){y._textureId=b._textureBindLocation,u+=y.indexSize,y.packAsQuad?(this.packQuadAttributes(y,l,h,y._attributeStart,y._textureId),this.packQuadIndex(c,y._indexStart,y._attributeStart/this.vertexSize)):(this.packAttributes(y,l,h,y._attributeStart,y._textureId),this.packIndex(y,c,y._indexStart,y._attributeStart/this.vertexSize)),y._batch=r,p.push(y);continue}b._batchTick=cs,(i.count>=m||w)&&(this._finishBatch(r,f,u-f,i,o,a,t,d,p),d="renderBatch",f=u,o=_,a=y.topology,r=uo(),i=r.textures,i.clear(),p=[],++cs),y._textureId=b._textureBindLocation=i.count,i.ids[b.uid]=i.count,i.textures[i.count++]=b,y._batch=r,p.push(y),u+=y.indexSize,y.packAsQuad?(this.packQuadAttributes(y,l,h,y._attributeStart,y._textureId),this.packQuadIndex(c,y._indexStart,y._attributeStart/this.vertexSize)):(this.packAttributes(y,l,h,y._attributeStart,y._textureId),this.packIndex(y,c,y._indexStart,y._attributeStart/this.vertexSize))}i.count>0&&(this._finishBatch(r,f,u-f,i,o,a,t,d,p),f=u,++cs),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=u}_finishBatch(t,e,r,i,n,o,a,l,h){t.gpuBindGroup=null,t.bindGroup=null,t.action=l,t.batcher=this,t.textures=i,t.blendMode=n,t.topology=o,t.start=e,t.size=r,t.elements=h,++cs,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),r=new lo(e);ho(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){const e=this.indexBuffer;let r=Math.max(t,e.length*1.5);r+=r%2;const i=r>65535?new Uint32Array(r):new Uint16Array(r);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let n=0;n<e.length;n++)i[n]=e[n];else ho(e.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(t,e,r){t[e]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3}packIndex(t,e,r,i){const n=t.indices,o=t.indexSize,a=t.indexOffset,l=t.attributeOffset;for(let h=0;h<o;h++)e[r++]=i+n[h+a]-l}destroy(t={}){if(this.batches!==null){for(let e=0;e<this.batchIndex;e++)fo(this.batches[e]);this.batches=null,this.geometry.destroy(!0),this.geometry=null,t.shader&&(this.shader?.destroy(),this.shader=null);for(let e=0;e<this._elements.length;e++)this._elements[e]&&(this._elements[e]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};Rl.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let pd=Rl;var bt=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(bt||{});let Rs=class extends Gt{constructor(t){let{data:e,size:r}=t;const{usage:i,label:n,shrinkToFit:o}=t;super(),this._gpuData=Object.create(null),this._gcLastUsed=-1,this.autoGarbageCollect=!0,this.uid=it("buffer"),this._resourceType="buffer",this._resourceId=it("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,r??(r=e?.byteLength);const a=!!e;this.descriptor={size:r,usage:i,mappedAtCreation:a,label:n},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&bt.STATIC)}set static(t){t?this.descriptor.usage|=bt.STATIC:this.descriptor.usage&=~bt.STATIC}setDataWithSize(t,e,r){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){r&&this.emit("update",this);return}const i=this._data;if(this._data=t,this._dataInt32=null,!i||i.length!==t.length){!this.shrinkToFit&&i&&t.byteLength<i.byteLength?r&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=it("resource"),this.emit("change",this));return}r&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}};function Il(s,t){if(!(s instanceof Rs)){let e=t?bt.INDEX:bt.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=bt.INDEX|bt.COPY_DST):(s=new Float32Array(s),e=bt.VERTEX|bt.COPY_DST)),s=new Rs({data:s,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return s}function gd(s,t,e){const r=s.getAttribute(t);if(!r)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const i=r.buffer.data;let n=1/0,o=1/0,a=-1/0,l=-1/0;const h=i.BYTES_PER_ELEMENT,c=(r.offset||0)/h,u=(r.stride||8)/h;for(let f=c;f<i.length;f+=u){const d=i[f],p=i[f+1];d>a&&(a=d),p>l&&(l=p),d<n&&(n=d),p<o&&(o=p)}return e.minX=n,e.minY=o,e.maxX=a,e.maxY=l,e}function md(s){return(s instanceof Rs||Array.isArray(s)||s.BYTES_PER_ELEMENT)&&(s={buffer:s}),s.buffer=Il(s.buffer,!1),s}class yd extends Gt{constructor(t={}){super(),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=it("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new Ct,this._boundsDirty=!0;const{attributes:e,indexBuffer:r,topology:i}=t;if(this.buffers=[],this.attributes={},e)for(const n in e)this.addAttribute(n,e[n]);this.instanceCount=t.instanceCount??1,r&&this.addIndex(r),this.topology=i||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const r=md(e);this.buffers.indexOf(r.buffer)===-1&&(this.buffers.push(r.buffer),r.buffer.on("update",this.onBufferUpdate,this),r.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=r}addIndex(t){this.indexBuffer=Il(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,gd(this,"aPosition",this._bounds)):this._bounds}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null)}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.unload(),this.indexBuffer?.destroy(),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const _d=new Float32Array(1),bd=new Uint32Array(1);class xd extends yd{constructor(){const e=new Rs({data:_d,label:"attribute-batch-buffer",usage:bt.VERTEX|bt.COPY_DST,shrinkToFit:!1}),r=new Rs({data:bd,label:"index-batch-buffer",usage:bt.INDEX|bt.COPY_DST,shrinkToFit:!1}),i=24;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:i,offset:0},aUV:{buffer:e,format:"float32x2",stride:i,offset:8},aColor:{buffer:e,format:"unorm8x4",stride:i,offset:16},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:i,offset:20}},indexBuffer:r})}}function po(s,t,e){if(s)for(const r in s){const i=r.toLocaleLowerCase(),n=t[i];if(n){let o=s[r];r==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&n.push(`//----${e}----//`),n.push(o)}else Z(`${r} placement hook does not exist in shader`)}}const wd=/\{\{(.*?)\}\}/g;function go(s){const t={};return(s.match(wd)?.map(r=>r.replace(/[{()}]/g,""))??[]).forEach(r=>{t[r]=[]}),t}function mo(s,t){let e;const r=/@in\s+([^;]+);/g;for(;(e=r.exec(s))!==null;)t.push(e[1])}function yo(s,t,e=!1){const r=[];mo(t,r),s.forEach(a=>{a.header&&mo(a.header,r)});const i=r;e&&i.sort();const n=i.map((a,l)=>`       @location(${l}) ${a},`).join(`
`);let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${n}
`),o}function _o(s,t){let e;const r=/@out\s+([^;]+);/g;for(;(e=r.exec(s))!==null;)t.push(e[1])}function vd(s){const e=/\b(\w+)\s*:/g.exec(s);return e?e[1]:""}function Sd(s){const t=/@.*?\s+/g;return s.replace(t,"")}function Ad(s,t){const e=[];_o(t,e),s.forEach(l=>{l.header&&_o(l.header,e)});let r=0;const i=e.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${r++}) ${l}`).join(`,
`),n=e.sort().map(l=>`       var ${Sd(l)};`).join(`
`),o=`return VSOutput(
            ${e.sort().map(l=>` ${vd(l)}`).join(`,
`)});`;let a=t.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${i}
`),a=a.replace("{{start}}",`
${n}
`),a=a.replace("{{return}}",`
${o}
`),a}function bo(s,t){let e=s;for(const r in t){const i=t[r];i.join(`
`).length?e=e.replace(`{{${r}}}`,`//-----${r} START-----//
${i.join(`
`)}
//----${r} FINISH----//`):e=e.replace(`{{${r}}}`,"")}return e}const re=Object.create(null),ai=new Map;let Td=0;function kd({template:s,bits:t}){const e=Ol(s,t);if(re[e])return re[e];const{vertex:r,fragment:i}=Ed(s,t);return re[e]=Ll(r,i,t),re[e]}function Cd({template:s,bits:t}){const e=Ol(s,t);return re[e]||(re[e]=Ll(s.vertex,s.fragment,t)),re[e]}function Ed(s,t){const e=t.map(o=>o.vertex).filter(o=>!!o),r=t.map(o=>o.fragment).filter(o=>!!o);let i=yo(e,s.vertex,!0);i=Ad(e,i);const n=yo(r,s.fragment,!0);return{vertex:i,fragment:n}}function Ol(s,t){return t.map(e=>(ai.has(e)||ai.set(e,Td++),ai.get(e))).sort((e,r)=>e-r).join("-")+s.vertex+s.fragment}function Ll(s,t,e){const r=go(s),i=go(t);return e.forEach(n=>{po(n.vertex,r,n.name),po(n.fragment,i,n.name)}),{vertex:bo(s,r),fragment:bo(t,i)}}const Pd=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,Rd=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,Md=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,Id=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,Od={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},Ld={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function Bd({bits:s,name:t}){const e=kd({template:{fragment:Rd,vertex:Pd},bits:[Od,...s]});return Pr.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function Dd({bits:s,name:t}){return new ol({name:t,...Cd({template:{vertex:Md,fragment:Id},bits:[Ld,...s]})})}const $d={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Ud={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},li={};function Fd(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let r=0;r<s;r++)t.push(`@group(1) @binding(${e++}) var textureSource${r+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${r+1}: sampler;`)}return t.join(`
`)}function jd(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function Nd(s){return li[s]||(li[s]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${Fd(s)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${jd(s)}
            `}}),li[s]}const hi={};function Gd(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function Wd(s){return hi[s]||(hi[s]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${s}];

            `,main:`

                ${Gd(s)}
            `}}),hi[s]}const zd={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Hd={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},xo={};function Vd(s){let t=xo[s];if(t)return t;const e=new Int32Array(s);for(let r=0;r<s;r++)e[r]=r;return t=xo[s]=new cl({uTextures:{value:e,type:"i32",size:s}},{isStatic:!0}),t}class wo extends un{constructor(t){const e=Dd({name:"batch",bits:[Ud,Wd(t),Hd]}),r=Bd({name:"batch",bits:[$d,Nd(t),zd]});super({glProgram:e,gpuProgram:r,resources:{batchSamplers:Vd(t)}}),this.maxTextures=t}}let us=null;const Bl=class Dl extends pd{constructor(t){super(t),this.geometry=new xd,this.name=Dl.extension.name,this.vertexSize=6,us??(us=new wo(t.maxTextures)),this.shader=us}packAttributes(t,e,r,i,n){const o=n<<16|t.roundPixels&65535,a=t.transform,l=a.a,h=a.b,c=a.c,u=a.d,f=a.tx,d=a.ty,{positions:p,uvs:m}=t,g=t.color,y=t.attributeOffset,x=y+t.attributeSize;for(let b=y;b<x;b++){const _=b*2,w=p[_],v=p[_+1];e[i++]=l*w+c*v+f,e[i++]=u*v+h*w+d,e[i++]=m[_],e[i++]=m[_+1],r[i++]=g,r[i++]=o}}packQuadAttributes(t,e,r,i,n){const o=t.texture,a=t.transform,l=a.a,h=a.b,c=a.c,u=a.d,f=a.tx,d=a.ty,p=t.bounds,m=p.maxX,g=p.minX,y=p.maxY,x=p.minY,b=o.uvs,_=t.color,w=n<<16|t.roundPixels&65535;e[i+0]=l*g+c*x+f,e[i+1]=u*x+h*g+d,e[i+2]=b.x0,e[i+3]=b.y0,r[i+4]=_,r[i+5]=w,e[i+6]=l*m+c*x+f,e[i+7]=u*x+h*m+d,e[i+8]=b.x1,e[i+9]=b.y1,r[i+10]=_,r[i+11]=w,e[i+12]=l*m+c*y+f,e[i+13]=u*y+h*m+d,e[i+14]=b.x2,e[i+15]=b.y2,r[i+16]=_,r[i+17]=w,e[i+18]=l*g+c*y+f,e[i+19]=u*y+h*g+d,e[i+20]=b.x3,e[i+21]=b.y3,r[i+22]=_,r[i+23]=w}_updateMaxTextures(t){this.shader.maxTextures!==t&&(us=new wo(t),this.shader=us)}destroy(){this.shader=null,super.destroy()}};Bl.extension={type:[M.Batcher],name:"default"};let qd=Bl;class js{constructor(t){this.items=Object.create(null);const{renderer:e,type:r,onUnload:i,priority:n,name:o}=t;this._renderer=e,e.gc.addResourceHash(this,"items",r,n??0),this._onUnload=i,this.name=o}add(t){return this.items[t.uid]?!1:(this.items[t.uid]=t,t.once("unload",this.remove,this),t._gcLastUsed=this._renderer.gc.now,!0)}remove(t,...e){if(!this.items[t.uid])return;const r=t._gpuData[this._renderer.uid];r&&(this._onUnload?.(t,...e),r.destroy(),t._gpuData[this._renderer.uid]=null,this.items[t.uid]=null)}removeAll(...t){Object.values(this.items).forEach(e=>e&&this.remove(e,...t))}destroy(...t){this.removeAll(...t),this.items=Object.create(null),this._renderer=null,this._onUnload=null}}function Yd(s,t,e,r,i,n,o,a=null){let l=0;e*=t,i*=n;const h=a.a,c=a.b,u=a.c,f=a.d,d=a.tx,p=a.ty;for(;l<o;){const m=s[e],g=s[e+1];r[i]=h*m+u*g+d,r[i+1]=c*m+f*g+p,i+=n,e+=t,l++}}function Xd(s,t,e,r){let i=0;for(t*=e;i<r;)s[t]=0,s[t+1]=0,t+=e,i++}function $l(s,t,e,r,i){const n=t.a,o=t.b,a=t.c,l=t.d,h=t.tx,c=t.ty;e||(e=0),r||(r=2),i||(i=s.length/r-e);let u=e*r;for(let f=0;f<i;f++){const d=s[u],p=s[u+1];s[u]=n*d+a*p+h,s[u+1]=o*d+l*p+c,u+=r}}const Kd=new N;class gn{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,r=this.renderable;return r?ja(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||Kd}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Ms={extension:{type:M.ShapeBuilder,name:"circle"},build(s,t){let e,r,i,n,o,a;if(s.type==="circle"){const _=s;if(o=a=_.radius,o<=0)return!1;e=_.x,r=_.y,i=n=0}else if(s.type==="ellipse"){const _=s;if(o=_.halfWidth,a=_.halfHeight,o<=0||a<=0)return!1;e=_.x,r=_.y,i=n=0}else{const _=s,w=_.width/2,v=_.height/2;e=_.x+w,r=_.y+v,o=a=Math.max(0,Math.min(_.radius,Math.min(w,v))),i=w-o,n=v-a}if(i<0||n<0)return!1;const l=Math.ceil(2.3*Math.sqrt(o+a)),h=l*8+(i?4:0)+(n?4:0);if(h===0)return!1;if(l===0)return t[0]=t[6]=e+i,t[1]=t[3]=r+n,t[2]=t[4]=e-i,t[5]=t[7]=r-n,!0;let c=0,u=l*4+(i?2:0)+2,f=u,d=h,p=i+o,m=n,g=e+p,y=e-p,x=r+m;if(t[c++]=g,t[c++]=x,t[--u]=x,t[--u]=y,n){const _=r-m;t[f++]=y,t[f++]=_,t[--d]=_,t[--d]=g}for(let _=1;_<l;_++){const w=Math.PI/2*(_/l),v=i+Math.cos(w)*o,S=n+Math.sin(w)*a,T=e+v,P=e-v,k=r+S,A=r-S;t[c++]=T,t[c++]=k,t[--u]=k,t[--u]=P,t[f++]=P,t[f++]=A,t[--d]=A,t[--d]=T}p=i,m=n+a,g=e+p,y=e-p,x=r+m;const b=r-m;return t[c++]=g,t[c++]=x,t[--d]=b,t[--d]=g,i&&(t[c++]=y,t[c++]=x,t[--d]=b,t[--d]=y),!0},triangulate(s,t,e,r,i,n){if(s.length===0)return;let o=0,a=0;for(let c=0;c<s.length;c+=2)o+=s[c],a+=s[c+1];o/=s.length/2,a/=s.length/2;let l=r;t[l*e]=o,t[l*e+1]=a;const h=l++;for(let c=0;c<s.length;c+=2)t[l*e]=s[c],t[l*e+1]=s[c+1],c>0&&(i[n++]=l,i[n++]=h,i[n++]=l-1),l++;i[n++]=h+1,i[n++]=h,i[n++]=l-1}},Jd={...Ms,extension:{...Ms.extension,name:"ellipse"}},Zd={...Ms,extension:{...Ms.extension,name:"roundedRectangle"}},Ul=1e-4,vo=1e-4;function Qd(s){const t=s.length;if(t<6)return 1;let e=0;for(let r=0,i=s[t-2],n=s[t-1];r<t;r+=2){const o=s[r],a=s[r+1];e+=(o-i)*(a+n),i=o,n=a}return e<0?-1:1}function So(s,t,e,r,i,n,o,a){const l=s-e*i,h=t-r*i,c=s+e*n,u=t+r*n;let f,d;o?(f=r,d=-e):(f=-r,d=e);const p=l+f,m=h+d,g=c+f,y=u+d;return a.push(p,m),a.push(g,y),2}function ce(s,t,e,r,i,n,o,a){const l=e-s,h=r-t;let c=Math.atan2(l,h),u=Math.atan2(i-s,n-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let f=c;const d=u-c,p=Math.abs(d),m=Math.sqrt(l*l+h*h),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=d/g;if(f+=y,a){o.push(s,t),o.push(e,r);for(let x=1,b=f;x<g;x++,b+=y)o.push(s,t),o.push(s+Math.sin(b)*m,t+Math.cos(b)*m);o.push(s,t),o.push(i,n)}else{o.push(e,r),o.push(s,t);for(let x=1,b=f;x<g;x++,b+=y)o.push(s+Math.sin(b)*m,t+Math.cos(b)*m),o.push(s,t);o.push(i,n),o.push(s,t)}return g*2}function tf(s,t,e,r,i,n){const o=Ul;if(s.length===0)return;const a=t;let l=a.alignment;if(t.alignment!==.5){let I=Qd(s);l=(l-.5)*I+.5}const h=new yt(s[0],s[1]),c=new yt(s[s.length-2],s[s.length-1]),u=r,f=Math.abs(h.x-c.x)<o&&Math.abs(h.y-c.y)<o;if(u){s=s.slice(),f&&(s.pop(),s.pop(),c.set(s[s.length-2],s[s.length-1]));const I=(h.x+c.x)*.5,Y=(c.y+h.y)*.5;s.unshift(I,Y),s.push(I,Y)}const d=i,p=s.length/2;let m=s.length;const g=d.length/2,y=a.width/2,x=y*y,b=a.miterLimit*a.miterLimit;let _=s[0],w=s[1],v=s[2],S=s[3],T=0,P=0,k=-(w-S),A=_-v,D=0,$=0,F=Math.sqrt(k*k+A*A);k/=F,A/=F,k*=y,A*=y;const V=l,C=(1-V)*2,R=V*2;u||(a.cap==="round"?m+=ce(_-k*(C-R)*.5,w-A*(C-R)*.5,_-k*C,w-A*C,_+k*R,w+A*R,d,!0)+2:a.cap==="square"&&(m+=So(_,w,k,A,C,R,!0,d))),d.push(_-k*C,w-A*C),d.push(_+k*R,w+A*R);for(let I=1;I<p-1;++I){_=s[(I-1)*2],w=s[(I-1)*2+1],v=s[I*2],S=s[I*2+1],T=s[(I+1)*2],P=s[(I+1)*2+1],k=-(w-S),A=_-v,F=Math.sqrt(k*k+A*A),k/=F,A/=F,k*=y,A*=y,D=-(S-P),$=v-T,F=Math.sqrt(D*D+$*$),D/=F,$/=F,D*=y,$*=y;const Y=v-_,nt=w-S,ct=v-T,mt=P-S,$t=Y*ct+nt*mt,Ee=nt*ct-mt*Y,ns=Ee<0;if(Math.abs(Ee)<.001*Math.abs($t)){d.push(v-k*C,S-A*C),d.push(v+k*R,S+A*R),$t>=0&&(a.join==="round"?m+=ce(v,S,v-k*C,S-A*C,v-D*C,S-$*C,d,!1)+4:m+=2,d.push(v-D*R,S-$*R),d.push(v+D*C,S+$*C));continue}const Cn=(-k+_)*(-A+S)-(-k+v)*(-A+w),En=(-D+T)*(-$+S)-(-D+v)*(-$+P),Gs=(Y*En-ct*Cn)/Ee,Ws=(mt*Cn-nt*En)/Ee,$r=(Gs-v)*(Gs-v)+(Ws-S)*(Ws-S),oe=v+(Gs-v)*C,ae=S+(Ws-S)*C,le=v-(Gs-v)*R,he=S-(Ws-S)*R,Ch=Math.min(Y*Y+nt*nt,ct*ct+mt*mt),Pn=ns?C:R,Eh=Ch+Pn*Pn*x;$r<=Eh?a.join==="bevel"||$r/x>b?(ns?(d.push(oe,ae),d.push(v+k*R,S+A*R),d.push(oe,ae),d.push(v+D*R,S+$*R)):(d.push(v-k*C,S-A*C),d.push(le,he),d.push(v-D*C,S-$*C),d.push(le,he)),m+=2):a.join==="round"?ns?(d.push(oe,ae),d.push(v+k*R,S+A*R),m+=ce(v,S,v+k*R,S+A*R,v+D*R,S+$*R,d,!0)+4,d.push(oe,ae),d.push(v+D*R,S+$*R)):(d.push(v-k*C,S-A*C),d.push(le,he),m+=ce(v,S,v-k*C,S-A*C,v-D*C,S-$*C,d,!1)+4,d.push(v-D*C,S-$*C),d.push(le,he)):(d.push(oe,ae),d.push(le,he)):(d.push(v-k*C,S-A*C),d.push(v+k*R,S+A*R),a.join==="round"?ns?m+=ce(v,S,v+k*R,S+A*R,v+D*R,S+$*R,d,!0)+2:m+=ce(v,S,v-k*C,S-A*C,v-D*C,S-$*C,d,!1)+2:a.join==="miter"&&$r/x<=b&&(ns?(d.push(le,he),d.push(le,he)):(d.push(oe,ae),d.push(oe,ae)),m+=2),d.push(v-D*C,S-$*C),d.push(v+D*R,S+$*R),m+=2)}_=s[(p-2)*2],w=s[(p-2)*2+1],v=s[(p-1)*2],S=s[(p-1)*2+1],k=-(w-S),A=_-v,F=Math.sqrt(k*k+A*A),k/=F,A/=F,k*=y,A*=y,d.push(v-k*C,S-A*C),d.push(v+k*R,S+A*R),u||(a.cap==="round"?m+=ce(v-k*(C-R)*.5,S-A*(C-R)*.5,v-k*C,S-A*C,v+k*R,S+A*R,d,!1)+2:a.cap==="square"&&(m+=So(v,S,k,A,C,R,!1,d)));const z=vo*vo;for(let I=g;I<m+g-2;++I)_=d[I*2],w=d[I*2+1],v=d[(I+1)*2],S=d[(I+1)*2+1],T=d[(I+2)*2],P=d[(I+2)*2+1],!(Math.abs(_*(S-P)+v*(P-w)+T*(w-S))<z)&&n.push(I,I+1,I+2)}function ef(s,t,e,r){const i=Ul;if(s.length===0)return;const n=s[0],o=s[1],a=s[s.length-2],l=s[s.length-1],h=t||Math.abs(n-a)<i&&Math.abs(o-l)<i,c=e,u=s.length/2,f=c.length/2;for(let d=0;d<u;d++)c.push(s[d*2]),c.push(s[d*2+1]);for(let d=0;d<u-1;d++)r.push(f+d,f+d+1);h&&r.push(f+u-1,f)}function Fl(s,t,e,r,i,n,o){const a=yu(s,t,2);if(!a)return;for(let h=0;h<a.length;h+=3)n[o++]=a[h]+i,n[o++]=a[h+1]+i,n[o++]=a[h+2]+i;let l=i*r;for(let h=0;h<s.length;h+=2)e[l]=s[h],e[l+1]=s[h+1],l+=r}const sf=[],rf={extension:{type:M.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,r,i,n){Fl(s,sf,t,e,r,i,n)}},nf={extension:{type:M.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,r=e.x,i=e.y,n=e.width,o=e.height;return n>0&&o>0?(t[0]=r,t[1]=i,t[2]=r+n,t[3]=i,t[4]=r+n,t[5]=i+o,t[6]=r,t[7]=i+o,!0):!1},triangulate(s,t,e,r,i,n){let o=0;r*=e,t[r+o]=s[0],t[r+o+1]=s[1],o+=e,t[r+o]=s[2],t[r+o+1]=s[3],o+=e,t[r+o]=s[6],t[r+o+1]=s[7],o+=e,t[r+o]=s[4],t[r+o+1]=s[5],o+=e;const a=r/e;i[n++]=a,i[n++]=a+1,i[n++]=a+2,i[n++]=a+1,i[n++]=a+3,i[n++]=a+2}},of={extension:{type:M.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,r,i,n){let o=0;r*=e,t[r+o]=s[0],t[r+o+1]=s[1],o+=e,t[r+o]=s[2],t[r+o+1]=s[3],o+=e,t[r+o]=s[4],t[r+o+1]=s[5];const a=r/e;i[n++]=a,i[n++]=a+1,i[n++]=a+2}},Ao=[{offset:0,color:"white"},{offset:1,color:"black"}],mn=class Fi{constructor(...t){this.uid=it("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=af(t);e={...e.type==="radial"?Fi.defaultRadialOptions:Fi.defaultLinearOptions,...Pa(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(i=>{this.addColorStop(i.offset,i.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:ht.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:r,y:i}=this.end,n=r-t,o=i-e;const a=n<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(n<0){const g=t;t=r,r=g,n*=-1}if(o<0){const g=e;e=i,i=g,o*=-1}}const l=this.colorStops.length?this.colorStops:Ao,h=this._textureSize,{canvas:c,context:u}=ko(h,1),f=a?u.createLinearGradient(this._textureSize,0,0,0):u.createLinearGradient(0,0,this._textureSize,0);To(f,l),u.fillStyle=f,u.fillRect(0,0,h,1),this.texture=new j({source:new Ze({resource:c,addressMode:this._wrapMode})});const d=Math.sqrt(n*n+o*o),p=Math.atan2(o,n),m=new N;m.scale(d/h,1),m.rotate(p),m.translate(t,e),this.textureSpace==="local"&&m.scale(h,h),this.transform=m}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Ao,e=this._textureSize,{canvas:r,context:i}=ko(e,e),{x:n,y:o}=this.center,{x:a,y:l}=this.outerCenter,h=this.innerRadius,c=this.outerRadius,u=a-c,f=l-c,d=e/(c*2),p=(n-u)*d,m=(o-f)*d,g=i.createRadialGradient(p,m,h*d,(a-u)*d,(l-f)*d,c*d);To(g,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=g,i.translate(p,m),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-p,-m),i.fillRect(0,0,e,e),this.texture=new j({source:new Ze({resource:r,addressMode:this._wrapMode})});const y=new N;y.scale(1/d,1/d),y.translate(u,f),this.textureSpace==="local"&&y.scale(e,e),this.transform=y}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};mn.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};mn.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Kt=mn;function To(s,t){for(let e=0;e<t.length;e++){const r=t[e];s.addColorStop(r.offset,r.color)}}function ko(s,t){const e=J.get().createCanvas(s,t),r=e.getContext("2d");return{canvas:e,context:r}}function af(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(W("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??Kt.defaultLinearOptions.textureSize}),t}const lf=new N,hf=new Q;function cf(s,t,e,r){const i=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const o=e.getBounds(hf);t.width&&o.pad(t.width);const{x:a,y:l}=o,h=1/o.width,c=1/o.height,u=-a*h,f=-l*c,d=i.a,p=i.b,m=i.c,g=i.d;i.a*=h,i.b*=h,i.c*=c,i.d*=c,i.tx=u*d+f*m+i.tx,i.ty=u*p+f*g+i.ty}else i.translate(t.texture.frame.x,t.texture.frame.y),i.scale(1/t.texture.source.width,1/t.texture.source.height);const n=t.texture.source.style;return!(t.fill instanceof Kt)&&n.addressMode==="clamp-to-edge"&&(n.addressMode="repeat",n.update()),r&&i.append(lf.copyFrom(r).invert()),i}const Mr={};K.handleByMap(M.ShapeBuilder,Mr);K.add(nf,rf,of,Ms,Jd,Zd);const uf=new Q,df=new N;function ff(s,t){const{geometryData:e,batches:r}=t;r.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let i=0;i<s.instructions.length;i++){const n=s.instructions[i];if(n.action==="texture")pf(n.data,r,e);else if(n.action==="fill"||n.action==="stroke"){const o=n.action==="stroke",a=n.data.path.shapePath,l=n.data.style,h=n.data.hole;o&&h&&Co(h.shapePath,l,!0,r,e),h&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=h.shapePath.shapePrimitives),Co(a,l,o,r,e)}}}function pf(s,t,e){const r=[],i=Mr.rectangle,n=uf;n.x=s.dx,n.y=s.dy,n.width=s.dw,n.height=s.dh;const o=s.transform;if(!i.build(n,r))return;const{vertices:a,uvs:l,indices:h}=e,c=h.length,u=a.length/2;o&&$l(r,o),i.triangulate(r,a,2,u,h,c);const f=s.image,d=f.uvs;l.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const p=xt.get(gn);p.indexOffset=c,p.indexSize=h.length-c,p.attributeOffset=u,p.attributeSize=a.length/2-u,p.baseColor=s.style,p.alpha=s.alpha,p.texture=f,p.geometryData=e,t.push(p)}function Co(s,t,e,r,i){const{vertices:n,uvs:o,indices:a}=i;s.shapePrimitives.forEach(({shape:l,transform:h,holes:c})=>{const u=[],f=Mr[l.type];if(!f.build(l,u))return;const d=a.length,p=n.length/2;let m="triangle-list";if(h&&$l(u,h),e){const b=l.closePath??!0,_=t;_.pixelLine?(ef(u,b,n,a),m="line-list"):tf(u,_,!1,b,n,a)}else if(c){const b=[],_=u.slice();gf(c).forEach(v=>{b.push(_.length/2),_.push(...v)}),Fl(_,b,n,2,p,a,d)}else f.triangulate(u,n,2,p,a,d);const g=o.length/2,y=t.texture;if(y!==j.WHITE){const b=cf(df,t,l,h);Yd(n,2,p,o,g,2,n.length/2-p,b)}else Xd(o,g,2,n.length/2-p);const x=xt.get(gn);x.indexOffset=d,x.indexSize=a.length-d,x.attributeOffset=p,x.attributeSize=n.length/2-p,x.baseColor=t.color,x.alpha=t.alpha,x.texture=y,x.geometryData=i,x.topology=m,r.push(x)})}function gf(s){const t=[];for(let e=0;e<s.length;e++){const r=s[e].shape,i=[];Mr[r.type].build(r,i)&&t.push(i)}return t}class mf{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}reset(){this.batches&&this.batches.forEach(t=>{xt.return(t)}),this.graphicsData&&xt.return(this.graphicsData),this.isBatchable=!1,this.context=null,this.batches.length=0,this.geometryData.indices.length=0,this.geometryData.vertices.length=0,this.geometryData.uvs.length=0,this.graphicsData=null}destroy(){this.reset(),this.batches=null,this.geometryData=null}}class yf{constructor(){this.instructions=new ln}init(t){const e=t.maxTextures;this.batcher?this.batcher._updateMaxTextures(e):this.batcher=new qd({maxTextures:e}),this.instructions.reset()}get geometry(){return W(Nh,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const yn=class ji{constructor(t){this._renderer=t,this._managedContexts=new js({renderer:t,type:"resource",name:"graphicsContext"})}init(t){ji.defaultOptions.bezierSmoothness=t?.bezierSmoothness??ji.defaultOptions.bezierSmoothness}getContextRenderData(t){return t._gpuData[this._renderer.uid].graphicsData||this._initContextRenderData(t)}updateGpuContext(t){const e=!!t._gpuData[this._renderer.uid],r=t._gpuData[this._renderer.uid]||this._initContext(t);if(t.dirty||!e){e&&r.reset(),ff(t,r);const i=t.batchMode;t.customShader||i==="no-batch"?r.isBatchable=!1:i==="auto"?r.isBatchable=r.geometryData.vertices.length<400:r.isBatchable=!0,t.dirty=!1}return r}getGpuContext(t){return t._gpuData[this._renderer.uid]||this._initContext(t)}_initContextRenderData(t){const e=xt.get(yf,{maxTextures:this._renderer.limits.maxBatchableTextures}),r=t._gpuData[this._renderer.uid],{batches:i,geometryData:n}=r;r.graphicsData=e;const o=n.vertices.length,a=n.indices.length;for(let u=0;u<i.length;u++)i[u].applyTransform=!1;const l=e.batcher;l.ensureAttributeBuffer(o),l.ensureIndexBuffer(a),l.begin();for(let u=0;u<i.length;u++){const f=i[u];l.add(f)}l.finish(e.instructions);const h=l.geometry;h.indexBuffer.setDataWithSize(l.indexBuffer,l.indexSize,!0),h.buffers[0].setDataWithSize(l.attributeBuffer.float32View,l.attributeSize,!0);const c=l.batches;for(let u=0;u<c.length;u++){const f=c[u];f.bindGroup=id(f.textures.textures,f.textures.count,this._renderer.limits.maxBatchableTextures)}return e}_initContext(t){const e=new mf;return e.context=t,t._gpuData[this._renderer.uid]=e,this._managedContexts.add(t),e}destroy(){this._managedContexts.destroy(),this._renderer=null}};yn.extension={type:[M.WebGLSystem,M.WebGPUSystem],name:"graphicsContext"};yn.defaultOptions={bezierSmoothness:.5};let _n=yn;const _f=8,rr=11920929e-14,bf=1;function jl(s,t,e,r,i,n,o,a,l,h){const u=Math.min(.99,Math.max(0,h??_n.defaultOptions.bezierSmoothness));let f=(bf-u)/1;return f*=f,xf(t,e,r,i,n,o,a,l,s,f),s}function xf(s,t,e,r,i,n,o,a,l,h){Ni(s,t,e,r,i,n,o,a,l,h,0),l.push(o,a)}function Ni(s,t,e,r,i,n,o,a,l,h,c){if(c>_f)return;const u=(s+e)/2,f=(t+r)/2,d=(e+i)/2,p=(r+n)/2,m=(i+o)/2,g=(n+a)/2,y=(u+d)/2,x=(f+p)/2,b=(d+m)/2,_=(p+g)/2,w=(y+b)/2,v=(x+_)/2;if(c>0){let S=o-s,T=a-t;const P=Math.abs((e-o)*T-(r-a)*S),k=Math.abs((i-o)*T-(n-a)*S);if(P>rr&&k>rr){if((P+k)*(P+k)<=h*(S*S+T*T)){l.push(w,v);return}}else if(P>rr){if(P*P<=h*(S*S+T*T)){l.push(w,v);return}}else if(k>rr){if(k*k<=h*(S*S+T*T)){l.push(w,v);return}}else if(S=w-(s+o)/2,T=v-(t+a)/2,S*S+T*T<=h){l.push(w,v);return}}Ni(s,t,u,f,y,x,w,v,l,h,c+1),Ni(w,v,b,_,m,g,o,a,l,h,c+1)}const wf=8,vf=11920929e-14,Sf=1;function Af(s,t,e,r,i,n,o,a){const h=Math.min(.99,Math.max(0,a??_n.defaultOptions.bezierSmoothness));let c=(Sf-h)/1;return c*=c,Tf(t,e,r,i,n,o,s,c),s}function Tf(s,t,e,r,i,n,o,a){Gi(o,s,t,e,r,i,n,a,0),o.push(i,n)}function Gi(s,t,e,r,i,n,o,a,l){if(l>wf)return;const h=(t+r)/2,c=(e+i)/2,u=(r+n)/2,f=(i+o)/2,d=(h+u)/2,p=(c+f)/2;let m=n-t,g=o-e;const y=Math.abs((r-n)*g-(i-o)*m);if(y>vf){if(y*y<=a*(m*m+g*g)){s.push(d,p);return}}else if(m=d-(t+n)/2,g=p-(e+o)/2,m*m+g*g<=a){s.push(d,p);return}Gi(s,t,e,h,c,d,p,a,l+1),Gi(s,d,p,u,f,n,o,a,l+1)}function Nl(s,t,e,r,i,n,o,a){let l=Math.abs(i-n);(!o&&i>n||o&&n>i)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(r,1/3)*(l/Math.PI)))),a=Math.max(a,3);let h=l/a,c=i;h*=o?-1:1;for(let u=0;u<a+1;u++){const f=Math.cos(c),d=Math.sin(c),p=t+f*r,m=e+d*r;s.push(p,m),c+=h}}function kf(s,t,e,r,i,n){const o=s[s.length-2],l=s[s.length-1]-e,h=o-t,c=i-e,u=r-t,f=Math.abs(l*u-h*c);if(f<1e-8||n===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const d=l*l+h*h,p=c*c+u*u,m=l*c+h*u,g=n*Math.sqrt(d)/f,y=n*Math.sqrt(p)/f,x=g*m/d,b=y*m/p,_=g*u+y*h,w=g*c+y*l,v=h*(y+x),S=l*(y+x),T=u*(g+b),P=c*(g+b),k=Math.atan2(S-w,v-_),A=Math.atan2(P-w,T-_);Nl(s,_+t,w+e,n,k,A,h*c>u*l)}const Ss=Math.PI*2,ci={centerX:0,centerY:0,ang1:0,ang2:0},ui=({x:s,y:t},e,r,i,n,o,a,l)=>{s*=e,t*=r;const h=i*s-n*t,c=n*s+i*t;return l.x=h+o,l.y=c+a,l};function Cf(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=t===1.5707963267948966?.551915024494:e,i=Math.cos(s),n=Math.sin(s),o=Math.cos(s+t),a=Math.sin(s+t);return[{x:i-n*r,y:n+i*r},{x:o+a*r,y:a-o*r},{x:o,y:a}]}const Eo=(s,t,e,r)=>{const i=s*r-t*e<0?-1:1;let n=s*e+t*r;return n>1&&(n=1),n<-1&&(n=-1),i*Math.acos(n)},Ef=(s,t,e,r,i,n,o,a,l,h,c,u,f)=>{const d=Math.pow(i,2),p=Math.pow(n,2),m=Math.pow(c,2),g=Math.pow(u,2);let y=d*p-d*g-p*m;y<0&&(y=0),y/=d*g+p*m,y=Math.sqrt(y)*(o===a?-1:1);const x=y*i/n*u,b=y*-n/i*c,_=h*x-l*b+(s+e)/2,w=l*x+h*b+(t+r)/2,v=(c-x)/i,S=(u-b)/n,T=(-c-x)/i,P=(-u-b)/n,k=Eo(1,0,v,S);let A=Eo(v,S,T,P);a===0&&A>0&&(A-=Ss),a===1&&A<0&&(A+=Ss),f.centerX=_,f.centerY=w,f.ang1=k,f.ang2=A};function Pf(s,t,e,r,i,n,o,a=0,l=0,h=0){if(n===0||o===0)return;const c=Math.sin(a*Ss/360),u=Math.cos(a*Ss/360),f=u*(t-r)/2+c*(e-i)/2,d=-c*(t-r)/2+u*(e-i)/2;if(f===0&&d===0)return;n=Math.abs(n),o=Math.abs(o);const p=Math.pow(f,2)/Math.pow(n,2)+Math.pow(d,2)/Math.pow(o,2);p>1&&(n*=Math.sqrt(p),o*=Math.sqrt(p)),Ef(t,e,r,i,n,o,l,h,c,u,f,d,ci);let{ang1:m,ang2:g}=ci;const{centerX:y,centerY:x}=ci;let b=Math.abs(g)/(Ss/4);Math.abs(1-b)<1e-7&&(b=1);const _=Math.max(Math.ceil(b),1);g/=_;let w=s[s.length-2],v=s[s.length-1];const S={x:0,y:0};for(let T=0;T<_;T++){const P=Cf(m,g),{x:k,y:A}=ui(P[0],n,o,u,c,y,x,S),{x:D,y:$}=ui(P[1],n,o,u,c,y,x,S),{x:F,y:V}=ui(P[2],n,o,u,c,y,x,S);jl(s,w,v,k,A,D,$,F,V),w=F,v=V,m+=g}}function Rf(s,t,e){const r=(o,a)=>{const l=a.x-o.x,h=a.y-o.y,c=Math.sqrt(l*l+h*h),u=l/c,f=h/c;return{len:c,nx:u,ny:f}},i=(o,a)=>{o===0?s.moveTo(a.x,a.y):s.lineTo(a.x,a.y)};let n=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],l=a.radius??e;if(l<=0){i(o,a),n=a;continue}const h=t[(o+1)%t.length],c=r(a,n),u=r(a,h);if(c.len<1e-4||u.len<1e-4){i(o,a),n=a;continue}let f=Math.asin(c.nx*u.ny-c.ny*u.nx),d=1,p=!1;c.nx*u.nx-c.ny*-u.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,p=!0):f>0&&(d=-1,p=!0);const m=f/2;let g,y=Math.abs(Math.cos(m)*l/Math.sin(m));y>Math.min(c.len/2,u.len/2)?(y=Math.min(c.len/2,u.len/2),g=Math.abs(y*Math.sin(m)/Math.cos(m))):g=l;const x=a.x+u.nx*y+-u.ny*g*d,b=a.y+u.ny*y+u.nx*g*d,_=Math.atan2(c.ny,c.nx)+Math.PI/2*d,w=Math.atan2(u.ny,u.nx)-Math.PI/2*d;o===0&&s.moveTo(x+Math.cos(_)*g,b+Math.sin(_)*g),s.arc(x,b,g,_,w,p),n=a}}function Mf(s,t,e,r){const i=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),n=(a,l,h)=>({x:a.x+(l.x-a.x)*h,y:a.y+(l.y-a.y)*h}),o=t.length;for(let a=0;a<o;a++){const l=t[(a+1)%o],h=l.radius??e;if(h<=0){a===0?s.moveTo(l.x,l.y):s.lineTo(l.x,l.y);continue}const c=t[a],u=t[(a+2)%o],f=i(c,l);let d;if(f<1e-4)d=l;else{const g=Math.min(f/2,h);d=n(l,c,g/f)}const p=i(u,l);let m;if(p<1e-4)m=l;else{const g=Math.min(p/2,h);m=n(l,u,g/p)}a===0?s.moveTo(d.x,d.y):s.lineTo(d.x,d.y),s.quadraticCurveTo(l.x,l.y,m.x,m.y,r)}}const If=new Q;class Of{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Ct,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const r=this._currentPoly.points,i=r[r.length-2],n=r[r.length-1];return(i!==t||n!==e)&&r.push(t,e),this}arc(t,e,r,i,n,o){this._ensurePoly(!1);const a=this._currentPoly.points;return Nl(a,t,e,r,i,n,o),this}arcTo(t,e,r,i,n){this._ensurePoly();const o=this._currentPoly.points;return kf(o,t,e,r,i,n),this}arcToSvg(t,e,r,i,n,o,a){const l=this._currentPoly.points;return Pf(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,t,e,r,i,n),this}bezierCurveTo(t,e,r,i,n,o,a){this._ensurePoly();const l=this._currentPoly;return jl(this._currentPoly.points,l.lastX,l.lastY,t,e,r,i,n,o,a),this}quadraticCurveTo(t,e,r,i,n){this._ensurePoly();const o=this._currentPoly;return Af(this._currentPoly.points,o.lastX,o.lastY,t,e,r,i,n),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const r=this.shapePrimitives,i=r.length;for(let n=0;n<t.instructions.length;n++){const o=t.instructions[n];this[o.action](...o.data)}if(t.checkForHoles&&r.length-i>1){let n=null;for(let o=i;o<r.length;o++){const a=r[o];if(a.shape.type==="polygon"){const l=a.shape,h=n?.shape;h&&h.containsPolygon(l)?(n.holes||(n.holes=[]),n.holes.push(a),r.copyWithin(o,o+1),r.length--,o--):n=a}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,r,i,n){return this.drawShape(new Q(t,e,r,i),n),this}circle(t,e,r,i){return this.drawShape(new dn(t,e,r),i),this}poly(t,e,r){const i=new ws(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i,n=0,o){i=Math.max(i|0,3);const a=-1*Math.PI/2+n,l=Math.PI*2/i,h=[];for(let c=0;c<i;c++){const u=a-c*l;h.push(t+r*Math.cos(u),e+r*Math.sin(u))}return this.poly(h,!0,o),this}roundPoly(t,e,r,i,n,o=0,a){if(i=Math.max(i|0,3),n<=0)return this.regularPoly(t,e,r,i,o);const l=r*Math.sin(Math.PI/i)-.001;n=Math.min(n,l);const h=-1*Math.PI/2+o,c=Math.PI*2/i,u=(i-2)*Math.PI/i/2;for(let f=0;f<i;f++){const d=f*c+h,p=t+r*Math.cos(d),m=e+r*Math.sin(d),g=d+Math.PI+u,y=d-Math.PI-u,x=p+n*Math.cos(g),b=m+n*Math.sin(g),_=p+n*Math.cos(y),w=m+n*Math.sin(y);f===0?this.moveTo(x,b):this.lineTo(x,b),this.quadraticCurveTo(p,m,_,w,a)}return this.closePath()}roundShape(t,e,r=!1,i){return t.length<3?this:(r?Mf(this,t,e,i):Rf(this,t,e),this.closePath())}filletRect(t,e,r,i,n){if(n===0)return this.rect(t,e,r,i);const o=Math.min(r,i)/2,a=Math.min(o,Math.max(-o,n)),l=t+r,h=e+i,c=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+c,e+c,t+u,e,u).lineTo(l-u,e).arcTo(l-c,e+c,l,e+u,u).lineTo(l,h-u).arcTo(l-c,h-c,t+r-u,h,u).lineTo(t+u,h).arcTo(t+c,h-c,t,h-u,u).closePath()}chamferRect(t,e,r,i,n,o){if(n<=0)return this.rect(t,e,r,i);const a=Math.min(n,Math.min(r,i)/2),l=t+r,h=e+i,c=[t+a,e,l-a,e,l,e+a,l,h-a,l-a,h,t+a,h,t,h-a,t,e+a];for(let u=c.length-1;u>=2;u-=2)c[u]===c[u-2]&&c[u-1]===c[u-3]&&c.splice(u-1,2);return this.poly(c,!0,o)}ellipse(t,e,r,i,n){return this.drawShape(new fn(t,e,r,i),n),this}roundRect(t,e,r,i,n,o){return this.drawShape(new pn(t,e,r,i,n),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),r=new ws,r.points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new ws,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let r=e.shape.x,i=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const n=e.transform,o=r;r=n.a*r+n.c*i+n.tx,i=n.b*o+n.d*i+n.ty}this._currentPoly.points.push(r,i)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let r=0;r<e.length;r++){const i=e[r],n=i.shape.getBounds(If);i.transform?t.addRect(n,i.transform):t.addRect(n)}return t}}class Xt{constructor(t,e=!1){this.instructions=[],this.uid=it("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?td(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new Of(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,r,i,n){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(yt.shared);let l=0,h=0;if(!o||o.action!=="bezierCurveTo")l=a.x,h=a.y;else{l=o.data[2],h=o.data[3];const c=a.x,u=a.y;l=c+(c-l),h=u+(u-h)}return this.instructions.push({action:"bezierCurveTo",data:[l,h,t,e,r,i,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){const i=this.instructions[this.instructions.length-1],n=this.getLastPoint(yt.shared);let o=0,a=0;if(!i||i.action!=="quadraticCurveTo")o=n.x,a=n.y;else{o=i.data[0],a=i.data[1];const l=n.x,h=n.y;o=l+(l-o),a=h+(h-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,t,e,r]}),this._dirty=!0,this}rect(t,e,r,i,n){return this.instructions.push({action:"rect",data:[t,e,r,i,n]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,i,n,o,a){n||(n=i/2);const l=-1*Math.PI/2+o,h=r*2,c=Math.PI*2/h,u=[];for(let f=0;f<h;f++){const d=f%2?n:i,p=f*c+l;u.push(t+d*Math.cos(p),e+d*Math.sin(p))}return this.poly(u,!0,a),this}clone(t=!1){const e=new Xt;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let r=0;r<this.instructions.length;r++){const i=this.instructions[r];e.instructions.push({action:i.action,data:i.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,r=t.b,i=t.c,n=t.d,o=t.tx,a=t.ty;let l=0,h=0,c=0,u=0,f=0,d=0,p=0,m=0;for(let g=0;g<this.instructions.length;g++){const y=this.instructions[g],x=y.data;switch(y.action){case"moveTo":case"lineTo":l=x[0],h=x[1],x[0]=e*l+i*h+o,x[1]=r*l+n*h+a;break;case"bezierCurveTo":c=x[0],u=x[1],f=x[2],d=x[3],l=x[4],h=x[5],x[0]=e*c+i*u+o,x[1]=r*c+n*u+a,x[2]=e*f+i*d+o,x[3]=r*f+n*d+a,x[4]=e*l+i*h+o,x[5]=r*l+n*h+a;break;case"quadraticCurveTo":c=x[0],u=x[1],l=x[2],h=x[3],x[0]=e*c+i*u+o,x[1]=r*c+n*u+a,x[2]=e*l+i*h+o,x[3]=r*l+n*h+a;break;case"arcToSvg":l=x[5],h=x[6],p=x[0],m=x[1],x[0]=e*p+i*m,x[1]=r*p+n*m,x[5]=e*l+i*h+o,x[6]=r*l+n*h+a;break;case"circle":x[4]=ds(x[3],t);break;case"rect":x[4]=ds(x[4],t);break;case"ellipse":x[8]=ds(x[8],t);break;case"roundRect":x[5]=ds(x[5],t);break;case"addPath":x[0].transform(t);break;case"poly":x[2]=ds(x[2],t);break;default:Z("unknown transform action",y.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;r.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t);break}return t}}function ds(s,t){return s?s.prepend(t):t.clone()}function et(s,t,e){const r=s.getAttribute(t);return r?Number(r):e}function Lf(s,t){const e=s.querySelectorAll("defs");for(let r=0;r<e.length;r++){const i=e[r];for(let n=0;n<i.children.length;n++){const o=i.children[n];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=Bf(o);break;case"radialgradient":t.defs[o.id]=Df();break}}}}function Bf(s){const t=et(s,"x1",0),e=et(s,"y1",0),r=et(s,"x2",1),i=et(s,"y2",0),n=s.getAttribute("gradientUnits")||"objectBoundingBox",o=new Kt(t,e,r,i,n==="objectBoundingBox"?"local":"global");for(let a=0;a<s.children.length;a++){const l=s.children[a],h=et(l,"offset",0),c=ht.shared.setValue(l.getAttribute("stop-color")).toNumber();o.addColorStop(h,c)}return o}function Df(s){return Z("[SVG Parser] Radial gradients are not yet supported"),new Kt(0,0,1,0)}function Po(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const Ro={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function Gl(s,t){const e=s.getAttribute("style"),r={},i={},n={strokeStyle:r,fillStyle:i,useFill:!1,useStroke:!1};for(const o in Ro){const a=s.getAttribute(o);a&&Mo(t,n,o,a.trim())}if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const l=o[a].trim(),[h,c]=l.split(":");Ro[h]&&Mo(t,n,h,c.trim())}}return{strokeStyle:n.useStroke?r:null,fillStyle:n.useFill?i:null,useFill:n.useFill,useStroke:n.useStroke}}function Mo(s,t,e,r){switch(e){case"stroke":if(r!=="none"){if(r.startsWith("url(")){const i=Po(r);t.strokeStyle.fill=s.defs[i]}else t.strokeStyle.color=ht.shared.setValue(r).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(r);break;case"fill":if(r!=="none"){if(r.startsWith("url(")){const i=Po(r);t.fillStyle.fill=s.defs[i]}else t.fillStyle.color=ht.shared.setValue(r).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(r);break;case"stroke-opacity":t.strokeStyle.alpha=Number(r);break;case"opacity":t.fillStyle.alpha=Number(r),t.strokeStyle.alpha=Number(r);break}}function $f(s){if(s.length<=2)return!0;const t=s.map(a=>a.area).sort((a,l)=>l-a),[e,r]=t,i=t[t.length-1],n=e/r,o=r/i;return!(n>3&&o<2)}function Uf(s){return s.split(/(?=[Mm])/).filter(r=>r.trim().length>0)}function Ff(s){const t=s.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),r=[],i=[];for(let c=0;c<e.length;c+=2)c+1<e.length&&(r.push(e[c]),i.push(e[c+1]));if(r.length===0||i.length===0)return 0;const n=Math.min(...r),o=Math.max(...r),a=Math.min(...i),l=Math.max(...i);return(o-n)*(l-a)}function Io(s,t){const e=new Xt(s,!1);for(const r of e.instructions)t.instructions.push(r)}function jf(s,t){if(typeof s=="string"){const o=document.createElement("div");o.innerHTML=s.trim(),s=o.querySelector("svg")}const e={context:t,defs:{},path:new Xt};Lf(s,e);const r=s.children,{fillStyle:i,strokeStyle:n}=Gl(s,e);for(let o=0;o<r.length;o++){const a=r[o];a.nodeName.toLowerCase()!=="defs"&&Wl(a,e,i,n)}return t}function Wl(s,t,e,r){const i=s.children,{fillStyle:n,strokeStyle:o}=Gl(s,t);n&&e?e={...e,...n}:n&&(e=n),o&&r?r={...r,...o}:o&&(r=o);const a=!e&&!r;a&&(e={color:0});let l,h,c,u,f,d,p,m,g,y,x,b,_,w,v,S,T;switch(s.nodeName.toLowerCase()){case"path":{w=s.getAttribute("d");const P=s.getAttribute("fill-rule"),k=Uf(w),A=P==="evenodd",D=k.length>1;if(A&&D){const F=k.map(C=>({path:C,area:Ff(C)}));if(F.sort((C,R)=>R.area-C.area),k.length>3||!$f(F))for(let C=0;C<F.length;C++){const R=F[C],z=C===0;t.context.beginPath();const I=new Xt(void 0,!0);Io(R.path,I),t.context.path(I),z?(e&&t.context.fill(e),r&&t.context.stroke(r)):t.context.cut()}else for(let C=0;C<F.length;C++){const R=F[C],z=C%2===1;t.context.beginPath();const I=new Xt(void 0,!0);Io(R.path,I),t.context.path(I),z?t.context.cut():(e&&t.context.fill(e),r&&t.context.stroke(r))}}else{const F=P?P==="evenodd":!0;v=new Xt(w,F),t.context.path(v),e&&t.context.fill(e),r&&t.context.stroke(r)}break}case"circle":p=et(s,"cx",0),m=et(s,"cy",0),g=et(s,"r",0),t.context.ellipse(p,m,g,g),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"rect":l=et(s,"x",0),h=et(s,"y",0),S=et(s,"width",0),T=et(s,"height",0),y=et(s,"rx",0),x=et(s,"ry",0),y||x?t.context.roundRect(l,h,S,T,y||x):t.context.rect(l,h,S,T),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"ellipse":p=et(s,"cx",0),m=et(s,"cy",0),y=et(s,"rx",0),x=et(s,"ry",0),t.context.beginPath(),t.context.ellipse(p,m,y,x),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"line":c=et(s,"x1",0),u=et(s,"y1",0),f=et(s,"x2",0),d=et(s,"y2",0),t.context.beginPath(),t.context.moveTo(c,u),t.context.lineTo(f,d),r&&t.context.stroke(r);break;case"polygon":_=s.getAttribute("points"),b=_.match(/-?\d+/g).map(P=>parseInt(P,10)),t.context.poly(b,!0),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"polyline":_=s.getAttribute("points"),b=_.match(/-?\d+/g).map(P=>parseInt(P,10)),t.context.poly(b,!1),r&&t.context.stroke(r);break;case"g":case"svg":break;default:{Z(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}a&&(e=null);for(let P=0;P<i.length;P++)Wl(i[P],t,e,r)}const Oo={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Ir{constructor(t,e){this.uid=it("fillPattern"),this._tick=0,this.transform=new N,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=Oo[e].addressModeU,t.source.style.addressModeV=Oo[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}function Nf(s){return ht.isColorLike(s)}function Lo(s){return s instanceof Ir}function Bo(s){return s instanceof Kt}function Gf(s){return s instanceof j}function Wf(s,t,e){const r=ht.shared.setValue(t??0);return s.color=r.toNumber(),s.alpha=r.alpha===1?e.alpha:r.alpha,s.texture=j.WHITE,{...e,...s}}function zf(s,t,e){return s.texture=t,{...e,...s}}function Do(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function $o(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function Hf(s,t){const e={...t,...s},r=ht.shared.setValue(e.color);return e.alpha*=r.alpha,e.color=r.toNumber(),e}function Ae(s,t){if(s==null)return null;const e={},r=s;return Nf(s)?Wf(e,s,t):Gf(s)?zf(e,s,t):Lo(s)?Do(e,s,t):Bo(s)?$o(e,s,t):r.fill&&Lo(r.fill)?Do(r,r.fill,t):r.fill&&Bo(r.fill)?$o(r,r.fill,t):Hf(r,t)}function vr(s,t){const{width:e,alignment:r,miterLimit:i,cap:n,join:o,pixelLine:a,...l}=t,h=Ae(s,l);return h?{width:e,alignment:r,miterLimit:i,cap:n,join:o,pixelLine:a,...h}:null}const Vf=new yt,Uo=new N,bn=class Ft extends Gt{constructor(){super(...arguments),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=it("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this.destroyed=!1,this._activePath=new Xt,this._transform=new N,this._fillStyle={...Ft.defaultFillStyle},this._strokeStyle={...Ft.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Ct,this._boundsDirty=!0}clone(){const t=new Ft;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=Ae(t,Ft.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=vr(t,Ft.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=Ae(t,Ft.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=Ae(t,Ft.defaultStrokeStyle),this}texture(t,e,r,i,n,o){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:n||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e||e===0?ht.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Xt,this}fill(t,e){let r;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i?.action==="stroke"?r=i.data.path:r=this._activePath.clone(),r?(t!=null&&(e!==void 0&&typeof t=="number"&&(W(rt,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=Ae(t,Ft.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(yt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r?.action==="fill"?e=r.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=vr(t,Ft.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(r);else{e.data.hole=r;break}}return this._initNextPathLocation(),this}arc(t,e,r,i,n,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,r,i,n,o),this}arcTo(t,e,r,i,n){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,n),this}arcToSvg(t,e,r,i,n,o,a){this._tick++;const l=this._transform;return this._activePath.arcToSvg(t,e,r,i,n,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(t,e,r,i,n,o,a){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*t+l.c*e+l.tx,l.b*t+l.d*e+l.ty,l.a*r+l.c*i+l.tx,l.b*r+l.d*i+l.ty,l.a*n+l.c*o+l.tx,l.b*n+l.d*o+l.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform,i=this._activePath.instructions,n=r.a*t+r.c*e+r.tx,o=r.b*t+r.d*e+r.ty;return i.length===1&&i[0].action==="moveTo"?(i[0].data[0]=n,i[0].data[1]=o,this):(this._activePath.moveTo(n,o),this)}quadraticCurveTo(t,e,r,i,n){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,n),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,n){return this._tick++,this._activePath.roundRect(t,e,r,i,n,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i,n=0,o){return this._tick++,this._activePath.regularPoly(t,e,r,i,n,o),this}roundPoly(t,e,r,i,n,o){return this._tick++,this._activePath.roundPoly(t,e,r,i,n,o),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,n){return this._tick++,this._activePath.filletRect(t,e,r,i,n),this}chamferRect(t,e,r,i,n,o){return this._tick++,this._activePath.chamferRect(t,e,r,i,n,o),this}star(t,e,r,i,n=0,o=0){return this._tick++,this._activePath.star(t,e,r,i,n,o,this._transform.clone()),this}svg(t){return this._tick++,jf(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,i,n,o){return t instanceof N?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,i,n,o),this)}transform(t,e,r,i,n,o){return t instanceof N?(this._transform.append(t),this):(Uo.set(t,e,r,i,n,o),this._transform.append(Uo),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],i=r.action;if(i==="fill"){const n=r.data;t.addBounds(n.path.bounds)}else if(i==="texture"){const n=r.data;t.addFrame(n.dx,n.dy,n.dx+n.dw,n.dy+n.dh,n.transform)}if(i==="stroke"){const n=r.data,o=n.style.alignment,a=n.style.width*(1-o),l=n.path.bounds;t.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let r=!1;for(let i=0;i<e.length;i++){const n=e[i],o=n.data,a=o.path;if(!n.action||!a)continue;const l=o.style,h=a.shapePath.shapePrimitives;for(let c=0;c<h.length;c++){const u=h[c].shape;if(!l||!u)continue;const f=h[c].transform,d=f?f.applyInverse(t,Vf):t;if(n.action==="fill")r=u.contains(d.x,d.y);else{const m=l;r=u.strokeContains(d.x,d.y,m.width,m.alignment)}const p=o.hole;if(p){const m=p.shapePath?.shapePrimitives;if(m)for(let g=0;g<m.length;g++)m[g].shape.contains(d.x,d.y)&&(r=!1)}if(r)return!0}}return r}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null)}destroy(t=!1){if(this.destroyed)return;if(this.destroyed=!0,this._stateStack.length=0,this._transform=null,this.unload(),this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(r)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(r))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};bn.defaultFillStyle={color:16777215,alpha:1,texture:j.WHITE,matrix:null,fill:null,textureSpace:"local"};bn.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:j.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let Tt=bn;function xn(s,t=1){const e=es.RETINA_PREFIX?.exec(s);return e?parseFloat(e[1]):t}function wn(s,t,e){s.label=e,s._sourceOrigin=e;const r=new j({source:s,label:e}),i=()=>{delete t.promiseCache[e],dt.has(e)&&dt.remove(e)};return r.source.once("destroy",()=>{t.promiseCache[e]&&(Z("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),i())}),r.once("destroy",()=>{s.destroyed||(Z("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),i())}),r}const qf=".svg",Yf="image/svg+xml",Xf={extension:{type:M.LoadParser,priority:ne.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return ss(s,Yf)||rs(s,qf)},async load(s,t,e){return t.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?Jf(s):Kf(s,t,e,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function Kf(s,t,e,r){const i=await J.get().fetch(s),n=J.get().createImage();n.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await i.text())}`,n.crossOrigin=r,await n.decode();const o=t.data?.width??n.width,a=t.data?.height??n.height,l=t.data?.resolution||xn(s),h=Math.ceil(o*l),c=Math.ceil(a*l),u=J.get().createCanvas(h,c),f=u.getContext("2d");f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(n,0,0,o*l,a*l);const{parseAsGraphicsContext:d,...p}=t.data??{},m=new Ze({resource:u,alphaMode:"premultiply-alpha-on-upload",resolution:l,...p});return wn(m,e,s)}async function Jf(s){const e=await(await J.get().fetch(s)).text(),r=new Tt;return r.svg(e),r}const Zf=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function") return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let He=null,Wi=class{constructor(){He||(He=URL.createObjectURL(new Blob([Zf],{type:"application/javascript"}))),this.worker=new Worker(He)}};Wi.revokeObjectURL=function(){He&&(URL.revokeObjectURL(He),He=null)};const Qf=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let Ve=null;class zl{constructor(){Ve||(Ve=URL.createObjectURL(new Blob([Qf],{type:"application/javascript"}))),this.worker=new Worker(Ve)}}zl.revokeObjectURL=function(){Ve&&(URL.revokeObjectURL(Ve),Ve=null)};let Fo=0,di;class tp{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Wi;e.addEventListener("message",r=>{e.terminate(),Wi.revokeObjectURL(),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){return this._run("loadImageBitmap",[t,e?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){di===void 0&&(di=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<di&&(this._createdWorkers++,t=new zl().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){this._resolveHash[t.uuid]&&(t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),delete this._resolveHash[t.uuid])}async _run(t,e){await this._initWorkers();const r=new Promise((i,n)=>{this._queue.push({id:t,arguments:e,resolve:i,reject:n})});return this._next(),r}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),r=e.id;this._resolveHash[Fo]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Fo++,id:r})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const jo=new tp,ep=[".jpeg",".jpg",".png",".webp",".avif"],sp=["image/jpeg","image/png","image/webp","image/avif"];async function rp(s,t){const e=await J.get().fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const r=await e.blob();return t?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(r,{premultiplyAlpha:"none"}):createImageBitmap(r)}const Hl={name:"loadTextures",id:"texture",extension:{type:M.LoadParser,priority:ne.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return ss(s,sp)||rs(s,ep)},async load(s,t,e){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await jo.isImageBitmapSupported()?r=await jo.loadImageBitmap(s,t):r=await rp(s,t):r=await new Promise((n,o)=>{r=J.get().createImage(),r.crossOrigin=this.config.crossOrigin,r.src=s,r.complete?n(r):(r.onload=()=>{n(r)},r.onerror=o)});const i=new Ze({resource:r,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||xn(s),...t.data});return wn(i,e,s)},unload(s){s.destroy(!0)}},ip=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let fi,pi;function np(s,t,e){e===void 0&&!t.startsWith("data:")?s.crossOrigin=ap(t):e!==!1&&(s.crossOrigin=typeof e=="string"?e:"anonymous")}function op(s){return new Promise((t,e)=>{s.addEventListener("canplaythrough",r),s.addEventListener("error",i),s.load();function r(){n(),t()}function i(o){n(),e(o)}function n(){s.removeEventListener("canplaythrough",r),s.removeEventListener("error",i)}})}function ap(s,t=globalThis.location){if(s.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function lp(){const s=[],t=[];for(const e of ip){const r=xs.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Rr(r)&&(s.push(e),t.includes(r)||t.push(r))}return{validVideoExtensions:s,validVideoMime:t}}const hp={name:"loadVideo",id:"video",extension:{type:M.LoadParser,name:"loadVideo"},test(s){if(!fi||!pi){const{validVideoExtensions:r,validVideoMime:i}=lp();fi=r,pi=i}const t=ss(s,pi),e=rs(s,fi);return t||e},async load(s,t,e){const r={...xs.defaultOptions,resolution:t.data?.resolution||xn(s),alphaMode:t.data?.alphaMode||await Za(),...t.data},i=document.createElement("video"),n={preload:r.autoLoad!==!1?"auto":void 0,"webkit-playsinline":r.playsinline!==!1?"":void 0,playsinline:r.playsinline!==!1?"":void 0,muted:r.muted===!0?"":void 0,loop:r.loop===!0?"":void 0,autoplay:r.autoPlay!==!1?"":void 0};Object.keys(n).forEach(l=>{const h=n[l];h!==void 0&&i.setAttribute(l,h)}),r.muted===!0&&(i.muted=!0),np(i,s,r.crossorigin);const o=document.createElement("source");let a;if(r.mime)a=r.mime;else if(s.startsWith("data:"))a=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const l=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();a=xs.MIME_TYPES[l]||`video/${l}`}return o.src=s,a&&(o.type=a),new Promise((l,h)=>{r.preload&&!r.autoPlay&&i.load(),i.addEventListener("canplay",c),i.addEventListener("error",u),o.addEventListener("error",u),i.appendChild(o);async function c(){const d=new xs({...r,resource:i});f(),t.data.preload&&await op(i),l(wn(d,e,s))}function u(d){f(),h(d)}function f(){i.removeEventListener("canplay",c),i.removeEventListener("error",u),o.removeEventListener("error",u)}})},unload(s){s.destroy(!0)}},Vl={extension:{type:M.ResolveParser,name:"resolveTexture"},test:Hl.test,parse:s=>({resolution:parseFloat(es.RETINA_PREFIX.exec(s)?.[1]??"1"),format:s.split(".").pop(),src:s})},cp={extension:{type:M.ResolveParser,priority:-2,name:"resolveJson"},test:s=>es.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:Vl.parse};class up{constructor(){this._detections=[],this._initialized=!1,this.resolver=new es,this.loader=new Du,this.cache=dt,this._backgroundLoader=new Cu(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){Z("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let n=t.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}const e=t.texturePreference?.resolution??1,r=typeof e=="number"?[e]:e,i=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:r}}),t.preferences&&this.setPreferences(t.preferences),t.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...t.loadOptions})}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const r=xr(t),i=Ot(t).map(a=>{if(typeof a!="string"){const l=this.resolver.getAlias(a);return l.some(h=>!this.resolver.hasKey(h))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(i),o=await this._mapLoadToResolve(n,e);return r?o[i[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const i=this.resolver.resolveBundle(t),n={},o=Object.keys(i);let a=0;const l=[],h=()=>{e?.(l.reduce((u,f)=>u+f,0)/a)},c=o.map((u,f)=>{const d=i[u],p=Object.values(d),g=[...new Set(p.flat())].reduce((y,x)=>y+(x.progressSize||1),0);return l.push(0),a+=g,this._mapLoadToResolve(d,y=>{l[f]=y*g,h()}).then(y=>{n[u]=y})});return await Promise.all(c),r?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return dt.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=dt.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const i=await this.loader.load(r,e);this._backgroundLoader.active=!0;const n={};return r.forEach(o=>{const a=i[o.src],l=[o.src];o.alias&&l.push(...o.alias),l.forEach(h=>{n[h]=a}),dt.set(l,a)}),n}async unload(t){this._initialized||await this.init();const e=Ot(t).map(i=>typeof i!="string"?i.src:i),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Ot(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(i=>this._unloadFromResolved(e[i]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{dt.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,i)=>e.indexOf(r)===i),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const Lt=new up;K.handleByList(M.LoadParser,Lt.loader.parsers).handleByList(M.ResolveParser,Lt.resolver.parsers).handleByList(M.CacheParser,Lt.cache.parsers).handleByList(M.DetectionParser,Lt.detections);K.add(Eu,Ru,Pu,Bu,Iu,Ou,Lu,Fu,Gu,Ku,Xf,Hl,hp,ku,Tu,Vl,cp);const No={loader:M.LoadParser,resolver:M.ResolveParser,cache:M.CacheParser,detection:M.DetectionParser};K.handle(M.Asset,s=>{const t=s.ref;Object.entries(No).filter(([e])=>!!t[e]).forEach(([e,r])=>K.add(Object.assign(t[e],{extension:t[e].extension??r})))},s=>{const t=s.ref;Object.keys(No).filter(e=>!!t[e]).forEach(e=>K.remove(t[e]))});class dp{constructor(){this.isBatchable=!1}reset(){this.isBatchable=!1,this.context=null,this.graphicsData&&(this.graphicsData.destroy(),this.graphicsData=null)}destroy(){this.reset()}}class fp{constructor(){this.instructions=new ln}init(){this.instructions.reset()}destroy(){this.instructions.destroy(),this.instructions=null}}const vn=class zi{constructor(t){this._renderer=t,this._managedContexts=new js({renderer:t,type:"resource",name:"graphicsContext"})}init(t){zi.defaultOptions.bezierSmoothness=t?.bezierSmoothness??zi.defaultOptions.bezierSmoothness}getContextRenderData(t){return this.getGpuContext(t).graphicsData||this._initContextRenderData(t)}updateGpuContext(t){const e=t._gpuData,r=!!e[this._renderer.uid],i=e[this._renderer.uid]||this._initContext(t);return(t.dirty||!r)&&(r&&i.reset(),i.isBatchable=!1,t.dirty=!1),i}getGpuContext(t){return t._gpuData[this._renderer.uid]||this._initContext(t)}_initContextRenderData(t){const e=new fp,r=this.getGpuContext(t);return r.graphicsData=e,e.init(),e}_initContext(t){const e=new dp;return e.context=t,t._gpuData[this._renderer.uid]=e,this._managedContexts.add(t),e}destroy(){this._managedContexts.destroy(),this._renderer=null}};vn.extension={type:[M.CanvasSystem],name:"graphicsContext"};vn.defaultOptions={bezierSmoothness:.5};let pp=vn;class ql{constructor(t,e){this.state=dl.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new js({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){return!1}addRenderable(t,e){this._managedGraphics.add(t),this.renderer.renderPipes.batch.break(e),e.add(t)}updateRenderable(t){}execute(t){t.isRenderable&&this._adaptor.execute(this,t)}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null}}ql.extension={type:[M.CanvasPipes],name:"graphics"};function gp(s,t,e){const r=(s>>24&255)/255;t[e++]=(s&255)/255*r,t[e++]=(s>>8&255)/255*r,t[e++]=(s>>16&255)/255*r,t[e++]=r}class mp{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{xt.return(t)}),this.batches.length=0}}class Yl{constructor(t,e){this.state=dl.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new js({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const e=t.context,r=!!t._gpuData,n=this.renderer.graphicsContext.updateGpuContext(e);return!!(n.isBatchable||r!==n.isBatchable)}addRenderable(t,e){const i=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),i.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const r=this._getGpuDataForRenderable(t).batches;for(let i=0;i<r.length;i++){const n=r[i];n._batcher.updateElement(n)}}execute(t){if(!t.isRenderable)return;const e=this.renderer,r=t.context;if(!e.graphicsContext.getGpuContext(r).batches.length)return;const n=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const o=n.resources.localUniforms.uniforms;o.uTransformMatrix=t.groupTransform,o.uRound=e._roundPixels|t._roundPixels,gp(t.groupColorAlpha,o.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=this._getGpuDataForRenderable(t),i=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),i.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){const r=this.renderer.renderPipes.batch,i=this._getGpuDataForRenderable(t).batches;for(let n=0;n<i.length;n++){const o=i[n];r.addToBatch(o,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const e=new mp;return t._gpuData[this.renderer.uid]=e,this._managedGraphics.add(t),e}_updateBatchesForRenderable(t,e){const r=t.context,n=this.renderer.graphicsContext.getGpuContext(r),o=this.renderer._roundPixels|t._roundPixels;e.batches=n.batches.map(a=>{const l=xt.get(gn);return a.copyTo(l),l.renderable=t,l.roundPixels=o,l})}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}Yl.extension={type:[M.WebGLPipes,M.WebGPUPipes],name:"graphics"};K.add(ql);K.add(Yl);K.add(pp);K.add(_n);class G extends hn{constructor(t){t instanceof Tt&&(t={context:t});const{context:e,roundPixels:r,...i}=t||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",e?this.context=e:(this.context=this._ownedContext=new Tt,this.context.autoGarbageCollect=this.autoGarbageCollect),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=r??!1}set context(t){t!==this._context&&(this._context&&(this._context.off("update",this.onViewUpdate,this),this._context.off("unload",this.unload,this)),this._context=t,this._context.on("update",this.onViewUpdate,this),this._context.on("unload",this.unload,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_onTouch(t){this._gcLastUsed=t,this._context._gcLastUsed=t}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new G(this._context.clone()):(this._ownedContext=null,new G(this._context))}lineStyle(t,e,r){W(rt,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return t&&(i.width=t),e&&(i.color=e),r&&(i.alpha=r),this.context.strokeStyle=i,this}beginFill(t,e){W(rt,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const r={};return t!==void 0&&(r.color=t),e!==void 0&&(r.alpha=e),this.context.fillStyle=r,this}endFill(){W(rt,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==Tt.defaultStrokeStyle.width||t.color!==Tt.defaultStrokeStyle.color||t.alpha!==Tt.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return W(rt,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return W(rt,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return W(rt,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return W(rt,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return W(rt,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return W(rt,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class ts extends Nt{constructor(...t){let e=t[0];Array.isArray(t[0])&&(e={textures:t[0],autoUpdate:t[1]});const{animationSpeed:r=1,autoPlay:i=!1,autoUpdate:n=!0,loop:o=!0,onComplete:a=null,onFrameChange:l=null,onLoop:h=null,textures:c,updateAnchor:u=!1,...f}=e,[d]=c;super({...f,texture:d instanceof j?d:d.texture}),this._textures=null,this._durations=null,this._autoUpdate=n,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=o,this.updateAnchor=u,this.onComplete=a,this.onFrameChange=l,this.onLoop=h,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=c,i&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(jt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(jt.shared.add(this.update,this,ks.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=t.deltaTime,r=this.animationSpeed*e,i=this.currentFrame;if(this._durations!==null){let n=this._currentTime%1*this._durations[this.currentFrame];for(n+=r/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];const o=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t=!1){if(typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._textures.forEach(i=>{this.texture!==i&&i.destroy(r)})}this._textures=[],this._durations=null,this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let r=0;r<t.length;++r)e.push(j.from(t[r]));return new ts(e)}static fromImages(t){const e=[];for(let r=0;r<t.length;++r)e.push(j.from(t[r]));return new ts(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof j)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(jt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(jt.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class yp extends hn{constructor(t,e){const{text:r,resolution:i,style:n,anchor:o,width:a,height:l,roundPixels:h,...c}=t;super({...c}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=r??"",this.style=n,this.resolution=i??null,this.allowChildren=!1,this._anchor=new gt({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=h??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){t||(t={}),this._style?.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,r=this.bounds.height,i=-e*this.anchor.x;let n=0;return t.x>=i&&t.x<=i+e&&(n=-r*this.anchor.y,t.y>=n&&t.y<=n+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t?.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function _p(s,t){let e=s[0]??{};return(typeof e=="string"||s[1])&&(W(rt,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:s[1]}),e}class bp{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const r=J.get().createCanvas();r.width=t,r.height=e;const i=r.getContext("2d");return{canvas:r,context:i}}getOptimalCanvasAndContext(t,e,r=1){t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),t=Xe(t),e=Xe(e);const i=(t<<17)+(e<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let n=this._canvasPool[i].pop();return n||(n=this._createCanvasAndContext(t,e)),n}returnCanvasAndContext(t){const e=t.canvas,{width:r,height:i}=e,n=(r<<17)+(i<<1);t.context.resetTransform(),t.context.clearRect(0,0,r,i),this._canvasPool[n].push(t)}clear(){this._canvasPool={}}}const Hi=new bp;Fs.register(Hi);let ue=null,qt=null;function xp(s,t){ue||(ue=J.get().createCanvas(256,128),qt=ue.getContext("2d",{willReadFrequently:!0}),qt.globalCompositeOperation="copy",qt.globalAlpha=1),(ue.width<s||ue.height<t)&&(ue.width=Xe(s),ue.height=Xe(t))}function Go(s,t,e){for(let r=0,i=4*e*t;r<t;++r,i+=4)if(s[i+3]!==0)return!1;return!0}function Wo(s,t,e,r,i){const n=4*t;for(let o=r,a=r*n+4*e;o<=i;++o,a+=n)if(s[a+3]!==0)return!1;return!0}function wp(...s){let t=s[0];t.canvas||(t={canvas:s[0],resolution:s[1]});const{canvas:e}=t,r=Math.min(t.resolution??1,1),i=t.width??e.width,n=t.height??e.height;let o=t.output;if(xp(i,n),!qt)throw new TypeError("Failed to get canvas 2D context");qt.drawImage(e,0,0,i,n,0,0,i*r,n*r);const l=qt.getImageData(0,0,i,n).data;let h=0,c=0,u=i-1,f=n-1;for(;c<n&&Go(l,i,c);)++c;if(c===n)return Q.EMPTY;for(;Go(l,i,f);)--f;for(;Wo(l,i,h,c,f);)++h;for(;Wo(l,i,u,c,f);)--u;return++u,++f,qt.globalCompositeOperation="source-over",qt.strokeRect(h,c,u-h,f-c),qt.globalCompositeOperation="copy",o??(o=new Q),o.set(h/r,c/r,(u-h)/r,(f-c)/r),o}class vp{constructor(t=0,e=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=r,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){const e=new Array(t.length);for(let r=0;r<t.length;r++){const i=t[r];e[r]=[i,this.get(i)]}return e}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=new Array(this.size);let e=this.first,r=0;for(;e!==null;)t[r++]=e.key,e=e.next;return t}setWithEvicted(t,e,r=this.resetTtl){let i=null;if(this.has(t))this.set(t,e,!0,r);else{this.max>0&&this.size===this.max&&(i={...this.first},this.evict(!0));let n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=n:this.last.next=n,this.last=n}return i}set(t,e,r=!1,i=this.resetTtl){let n=this.items[t];return r||n!==void 0?(n.value=e,r===!1&&i&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(n)):(this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=n:this.last.next=n,this.last=n),this}values(t=this.keys()){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=this.get(t[r]);return e}}function Sp(s=1e3,t=0,e=!1){if(isNaN(s)||s<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new vp(s,t,e)}function Xl(s){return!!s.tagStyles&&Object.keys(s.tagStyles).length>0}function Kl(s){return s.includes("<")}function Ap(s,t){return s.clone().assign(t)}function Tp(s,t){const e=[],r=t.tagStyles;if(!Xl(t)||!Kl(s))return e.push({text:s,style:t}),e;const i=[t],n=[];let o="",a=0;for(;a<s.length;){const l=s[a];if(l==="<"){const h=s.indexOf(">",a);if(h===-1){o+=l,a++;continue}const c=s.slice(a+1,h);if(c.startsWith("/")){const u=c.slice(1).trim();if(n.length>0&&n[n.length-1]===u){o.length>0&&(e.push({text:o,style:i[i.length-1]}),o=""),i.pop(),n.pop(),a=h+1;continue}else{o+=s.slice(a,h+1),a=h+1;continue}}else{const u=c.trim();if(r[u]){o.length>0&&(e.push({text:o,style:i[i.length-1]}),o="");const f=i[i.length-1],d=Ap(f,r[u]);i.push(d),n.push(u),a=h+1;continue}else{o+=s.slice(a,h+1),a=h+1;continue}}}else o+=l,a++}return o.length>0&&e.push({text:o,style:i[i.length-1]}),e}const kp=[10,13],Cp=new Set(kp),Ep=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],Pp=new Set(Ep),Rp=/(\r\n|\r|\n)/,Mp=/(?:\r\n|\r|\n)/;function Sn(s){return typeof s!="string"?!1:Cp.has(s.charCodeAt(0))}function Bt(s,t){return typeof s!="string"?!1:Pp.has(s.charCodeAt(0))}function Jl(s){return s==="normal"||s==="pre-line"}function Zl(s){return s==="normal"}function Ht(s){if(typeof s!="string")return"";let t=s.length-1;for(;t>=0&&Bt(s[t]);)t--;return t<s.length-1?s.slice(0,t+1):s}function Ql(s){const t=[],e=[];if(typeof s!="string")return t;for(let r=0;r<s.length;r++){const i=s[r],n=s[r+1];if(Bt(i)||Sn(i)){e.length>0&&(t.push(e.join("")),e.length=0),i==="\r"&&n===`
`?(t.push(`\r
`),r++):t.push(i);continue}e.push(i)}return e.length>0&&t.push(e.join("")),t}function th(s,t,e,r){const i=e(s),n=[];for(let o=0;o<i.length;o++){let a=i[o],l=a,h=1;for(;i[o+h];){const c=i[o+h];if(!r(l,c,s,o,t))a+=c,l=c,h++;else break}o+=h-1,n.push(a)}return n}const Ip=/\r\n|\r|\n/g;function Op(s,t,e,r,i,n,o,a){const l=Tp(s,t);if(Zl(t.whiteSpace))for(let F=0;F<l.length;F++){const V=l[F];l[F]={text:V.text.replace(Ip," "),style:V.style}}const c=[];let u=[];for(const F of l){const V=F.text.split(Rp);for(let C=0;C<V.length;C++){const R=V[C];R===`\r
`||R==="\r"||R===`
`?(c.push(u),u=[]):R.length>0&&u.push({text:R,style:F.style})}}(u.length>0||c.length===0)&&c.push(u);const f=e?Lp(c,t,r,i,o,a):c,d=[],p=[],m=[],g=[],y=[];let x=0;const b=t._fontString,_=n(b);_.fontSize===0&&(_.fontSize=t.fontSize,_.ascent=t.fontSize);let w="",v=!!t.dropShadow;for(const F of f){let V=0,C=_.ascent,R=_.descent,z="";for(const Y of F){const nt=Y.style._fontString,ct=n(nt);nt!==w&&(r.font=nt,w=nt);const mt=i(Y.text,Y.style.letterSpacing,r);V+=mt,C=Math.max(C,ct.ascent),R=Math.max(R,ct.descent),z+=Y.text,!v&&Y.style.dropShadow&&(v=!0)}F.length===0&&(C=_.ascent,R=_.descent),d.push(V),p.push(C),m.push(R),y.push(z);const I=t.lineHeight||C+R;g.push(I+t.leading),x=Math.max(x,V)}const S=t._stroke?.width||0,k=(e&&t.align!=="left"&&t.align!=="justify"?Math.max(x,t.wordWrapWidth):x)+S+(t.dropShadow?t.dropShadow.distance:0);let A=0;for(let F=0;F<g.length;F++)A+=g[F];A=Math.max(A,g[0]+S);const D=A+(t.dropShadow?t.dropShadow.distance:0),$=t.lineHeight||_.fontSize;return{width:k,height:D,lines:y,lineWidths:d,lineHeight:$+t.leading,maxLineWidth:x,fontProperties:_,runsByLine:f,lineAscents:p,lineDescents:m,lineHeights:g,hasDropShadow:v}}function Lp(s,t,e,r,i,n){const{letterSpacing:o,whiteSpace:a,wordWrapWidth:l,breakWords:h}=t,c=Jl(a),u=l+o,f={};let d="";const p=(g,y)=>{const x=`${g}|${y.styleKey}`;let b=f[x];if(b===void 0){const _=y._fontString;_!==d&&(e.font=_,d=_),b=r(g,y.letterSpacing,e)+y.letterSpacing,f[x]=b}return b},m=[];for(const g of s){const y=Bp(g),x=m.length,b=A=>{let D=0,$=A;do{const{token:F,style:V}=y[$];D+=p(F,V),$++}while($<y.length&&y[$].continuesFromPrevious);return D},_=A=>{const D=[];let $=A;do D.push({token:y[$].token,style:y[$].style}),$++;while($<y.length&&y[$].continuesFromPrevious);return D};let w=[],v=0,S=!c,T=null;const P=()=>{T&&T.text.length>0&&w.push(T),T=null},k=()=>{if(P(),w.length>0){const A=w[w.length-1];A.text=Ht(A.text),A.text.length===0&&w.pop()}m.push(w),w=[],v=0,S=!1};for(let A=0;A<y.length;A++){const{token:D,style:$,continuesFromPrevious:F}=y[A],V=p(D,$);if(c){const z=Bt(D),I=T?.text[T.text.length-1]??w[w.length-1]?.text.slice(-1)??"",Y=I?Bt(I):!1;if(z&&Y)continue}const C=!F,R=C?b(A):V;if(R>u&&C)if(v>0&&k(),h){const z=_(A);for(let I=0;I<z.length;I++){const Y=z[I].token,nt=z[I].style,ct=th(Y,h,n,i);for(const mt of ct){const $t=p(mt,nt);$t+v>u&&k(),!T||T.style!==nt?(P(),T={text:mt,style:nt}):T.text+=mt,v+=$t}}A+=z.length-1}else{const z=_(A);P(),m.push(z.map(I=>({text:I.token,style:I.style}))),S=!1,A+=z.length-1}else if(R+v>u&&C){if(Bt(D)){S=!1;continue}k(),T={text:D,style:$},v=V}else if(F&&!h)!T||T.style!==$?(P(),T={text:D,style:$}):T.text+=D,v+=V;else{const z=Bt(D);if(v===0&&z&&!S)continue;!T||T.style!==$?(P(),T={text:D,style:$}):T.text+=D,v+=V}}if(P(),w.length>0){const A=w[w.length-1];A.text=Ht(A.text),A.text.length===0&&w.pop()}(w.length>0||m.length===x)&&m.push(w)}return m}function Bp(s){const t=[];let e=!1;for(const r of s){const i=Ql(r.text);let n=!0;for(const o of i){const a=Bt(o)||Sn(o),l=n&&e&&!a;t.push({token:o,style:r.style,continuesFromPrevious:l}),e=!a,n=!1}}return t}const Dp={willReadFrequently:!0};function zo(s,t,e,r,i){let n=e[s];return typeof n!="number"&&(n=i(s,t,r)+t,e[s]=n),n}function $p(s,t,e,r,i,n,o){const a=e.getContext("2d",Dp);a.font=t._fontString;let l=0,h="";const c=[],u=Object.create(null),{letterSpacing:f,whiteSpace:d}=t,p=Jl(d),m=Zl(d);let g=!p;const y=t.wordWrapWidth+f,x=Ql(s);for(let _=0;_<x.length;_++){let w=x[_];if(Sn(w)){if(!m){c.push(Ht(h)),g=!p,h="",l=0;continue}w=" "}if(p){const S=Bt(w),T=Bt(h[h.length-1]);if(S&&T)continue}const v=zo(w,f,u,a,r);if(v>y)if(h!==""&&(c.push(Ht(h)),h="",l=0),i(w,t.breakWords)){const S=th(w,t.breakWords,o,n);for(const T of S){const P=zo(T,f,u,a,r);P+l>y&&(c.push(Ht(h)),g=!1,h="",l=0),h+=T,l+=P}}else h.length>0&&(c.push(Ht(h)),h="",l=0),c.push(Ht(w)),g=!1,h="",l=0;else v+l>y&&(g=!1,c.push(Ht(h)),h="",l=0),(h.length>0||!Bt(w)||g)&&(h+=w,l+=v)}const b=Ht(h);return b.length>0&&c.push(b),c.join(`
`)}const Ho={willReadFrequently:!0},Jt=class U{static get experimentalLetterSpacingSupported(){let t=U._experimentalLetterSpacingSupported;if(t===void 0){const e=J.get().getCanvasRenderingContext2D().prototype;t=U._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,i,n,o,a,l,h,c){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=h,c&&(this.runsByLine=c.runsByLine,this.lineAscents=c.lineAscents,this.lineDescents=c.lineDescents,this.lineHeights=c.lineHeights,this.hasDropShadow=c.hasDropShadow)}static measureText(t=" ",e,r=U._canvas,i=e.wordWrap){const n=`${t}-${e.styleKey}-wordWrap-${i}`;if(U._measurementCache.has(n))return U._measurementCache.get(n);if(Xl(e)&&Kl(t)){const w=Op(t,e,i,U._context,U._measureText,U.measureFont,U.canBreakChars,U.wordWrapSplit),v=new U(t,e,w.width,w.height,w.lines,w.lineWidths,w.lineHeight,w.maxLineWidth,w.fontProperties,{runsByLine:w.runsByLine,lineAscents:w.lineAscents,lineDescents:w.lineDescents,lineHeights:w.lineHeights,hasDropShadow:w.hasDropShadow});return U._measurementCache.set(n,v),v}const a=e._fontString,l=U.measureFont(a);l.fontSize===0&&(l.fontSize=e.fontSize,l.ascent=e.fontSize,l.descent=0);const h=U._context;h.font=a;const u=(i?U._wordWrap(t,e,r):t).split(Mp),f=new Array(u.length);let d=0;for(let w=0;w<u.length;w++){const v=U._measureText(u[w],e.letterSpacing,h);f[w]=v,d=Math.max(d,v)}const p=e._stroke?.width??0,m=e.lineHeight||l.fontSize,g=U._getAlignWidth(d,e,i),y=U._adjustWidthForStyle(g,e),x=Math.max(m,l.fontSize+p)+(u.length-1)*(m+e.leading),b=U._adjustHeightForStyle(x,e),_=new U(t,e,y,b,u,f,m+e.leading,d,l);return U._measurementCache.set(n,_),_}static _adjustWidthForStyle(t,e){const r=e._stroke?.width||0;let i=t+r;return e.dropShadow&&(i+=e.dropShadow.distance),i}static _adjustHeightForStyle(t,e){let r=t;return e.dropShadow&&(r+=e.dropShadow.distance),r}static _getAlignWidth(t,e,r){return r&&e.align!=="left"&&e.align!=="justify"?Math.max(t,e.wordWrapWidth):t}static _measureText(t,e,r){let i=!1;U.experimentalLetterSpacingSupported&&(U.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));const n=r.measureText(t);let o=n.width;const a=-(n.actualBoundingBoxLeft??0);let h=(n.actualBoundingBoxRight??0)-a;if(o>0)if(i)o-=e,h-=e;else{const c=(U.graphemeSegmenter(t).length-1)*e;o+=c,h+=c}return Math.max(o,h)}static _wordWrap(t,e,r=U._canvas){return $p(t,e,r,U._measureText,U.canBreakWords,U.canBreakChars,U.wordWrapSplit)}static isBreakingSpace(t,e){return Bt(t)}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,n){return!0}static wordWrapSplit(t){return U.graphemeSegmenter(t)}static measureFont(t){if(U._fonts[t])return U._fonts[t];const e=U._context;e.font=t;const r=e.measureText(U.METRICS_STRING+U.BASELINE_SYMBOL),i=r.actualBoundingBoxAscent??0,n=r.actualBoundingBoxDescent??0,o={ascent:i,descent:n,fontSize:i+n};return U._fonts[t]=o,o}static clearMetrics(t=""){t?delete U._fonts[t]:U._fonts={}}static get _canvas(){if(!U.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",Ho)?.measureText)return U.__canvas=e,e;t=J.get().createCanvas()}catch{t=J.get().createCanvas()}t.width=t.height=10,U.__canvas=t}return U.__canvas}static get _context(){return U.__context||(U.__context=U._canvas.getContext("2d",Ho)),U.__context}};Jt.METRICS_STRING="|q";Jt.BASELINE_SYMBOL="M";Jt.BASELINE_MULTIPLIER=1.4;Jt.HEIGHT_MULTIPLIER=2;Jt.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),r=[];let i=0;for(const n of e)r[i++]=n.segment;return r}}return s=>[...s]})();Jt.experimentalLetterSpacing=!1;Jt._fonts={};Jt._measurementCache=Sp(1e3);let te=Jt;const Up=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Vi(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let i=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!Up.includes(i)&&(i=`"${i}"`),e[r]=i}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const Vo=1e5;function ir(s,t,e,r=0,i=0,n=0){if(s.texture===j.WHITE&&!s.fill)return ht.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof Ir){const o=s.fill,a=t.createPattern(o.texture.source.resource,"repeat"),l=o.transform.copyTo(N.shared);return l.scale(o.texture.source.pixelWidth,o.texture.source.pixelHeight),a.setTransform(l),a}else if(s.fill instanceof Kt){const o=s.fill,a=o.type==="linear",l=o.textureSpace==="local";let h=1,c=1;l&&e&&(h=e.width+r,c=e.height+r);let u,f=!1;if(a){const{start:d,end:p}=o;u=t.createLinearGradient(d.x*h+i,d.y*c+n,p.x*h+i,p.y*c+n),f=Math.abs(p.x-d.x)<Math.abs((p.y-d.y)*.1)}else{const{center:d,innerRadius:p,outerCenter:m,outerRadius:g}=o;u=t.createRadialGradient(d.x*h+i,d.y*c+n,p*h,m.x*h+i,m.y*c+n,g*h)}if(f&&l&&e){const d=e.lineHeight/c;for(let p=0;p<e.lines.length;p++){const m=(p*e.lineHeight+r/2)/c;o.colorStops.forEach(g=>{let y=m+g.offset*d;y=Math.max(0,Math.min(1,y)),u.addColorStop(Math.floor(y*Vo)/Vo,ht.shared.setValue(g.color).toHex())})}}else o.colorStops.forEach(d=>{u.addColorStop(d.offset,ht.shared.setValue(d.color).toHex())});return u}}else{const o=t.createPattern(s.texture.source.resource,"repeat"),a=s.matrix.copyTo(N.shared);return a.scale(s.texture.source.pixelWidth,s.texture.source.pixelHeight),o.setTransform(a),o}return Z("FillStyle not recognised",s),"red"}const qo=new Q;class Fp{getCanvasAndContext(t){const{text:e,style:r,resolution:i=1}=t,n=r._getFinalPadding(),o=te.measureText(e||" ",r),a=Math.ceil(Math.ceil(Math.max(1,o.width)+n*2)*i),l=Math.ceil(Math.ceil(Math.max(1,o.height)+n*2)*i),h=Hi.getOptimalCanvasAndContext(a,l);this._renderTextToCanvas(r,n,i,h,o);const c=r.trim?wp({canvas:h.canvas,width:a,height:l,resolution:1,output:qo}):qo.set(0,0,a,l);return{canvasAndContext:h,frame:c}}returnCanvasAndContext(t){Hi.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,r,i,n){if(n.runsByLine&&n.runsByLine.length>0){this._renderTaggedTextToCanvas(n,t,e,r,i);return}const{canvas:o,context:a}=i,l=Vi(t),h=n.lines,c=n.lineHeight,u=n.lineWidths,f=n.maxLineWidth,d=n.fontProperties,p=o.height;if(a.resetTransform(),a.scale(r,r),a.textBaseline=t.textBaseline,t._stroke?.width){const v=t._stroke;a.lineWidth=v.width,a.miterLimit=v.miterLimit,a.lineJoin=v.join,a.lineCap=v.cap}a.font=l;let m,g;const y=t.dropShadow?2:1,x=t.wordWrap?t.wordWrapWidth:f,_=(t._stroke?.width??0)/2;let w=(c-d.fontSize)/2;c-d.fontSize<0&&(w=0);for(let v=0;v<y;++v){const S=t.dropShadow&&v===0,T=S?Math.ceil(Math.max(1,p)+e*2):0,P=T*r;if(S)this._setupDropShadow(a,t,r,P);else{const k=t._gradientBounds,A=t._gradientOffset;if(k){const D={width:k.width,height:k.height,lineHeight:k.height,lines:n.lines};this._setFillAndStrokeStyles(a,t,D,e,_,A?.x??0,A?.y??0)}else A?this._setFillAndStrokeStyles(a,t,n,e,_,A.x,A.y):this._setFillAndStrokeStyles(a,t,n,e,_);a.shadowColor="black"}for(let k=0;k<h.length;k++)m=_,g=_+k*c+d.ascent+w,m+=this._getAlignmentOffset(u[k],x,t.align),t._stroke?.width&&this._drawLetterSpacing(h[k],t,i,m+e,g+e-T,!0),t._fill!==void 0&&this._drawLetterSpacing(h[k],t,i,m+e,g+e-T)}}_renderTaggedTextToCanvas(t,e,r,i,n){const{canvas:o,context:a}=n,{runsByLine:l,lineWidths:h,maxLineWidth:c,lineAscents:u,lineHeights:f,hasDropShadow:d}=t,p=o.height;a.resetTransform(),a.scale(i,i),a.textBaseline=e.textBaseline;const m=d?2:1,g=e.wordWrap?e.wordWrapWidth:c,x=(e._stroke?.width??0)/2,b=[];for(let _=0;_<l.length;_++){const w=l[_],v=[];for(const S of w){const T=Vi(S.style);a.font=T,v.push({width:te._measureText(S.text,S.style.letterSpacing,a),font:T})}b.push(v)}for(let _=0;_<m;++_){const w=d&&_===0,v=w?Math.ceil(Math.max(1,p)+r*2):0,S=v*i;w||(a.shadowColor="black");let T=x;for(let P=0;P<l.length;P++){const k=l[P],A=h[P],D=u[P],$=f[P],F=b[P];let V=x;V+=this._getAlignmentOffset(A,g,e.align);const C=T+D;let R=V+r;for(let z=0;z<k.length;z++){const I=k[z],{width:Y,font:nt}=F[z];if(a.font=nt,a.textBaseline=I.style.textBaseline,I.style._stroke?.width){const ct=I.style._stroke;if(a.lineWidth=ct.width,a.miterLimit=ct.miterLimit,a.lineJoin=ct.join,a.lineCap=ct.cap,w)if(I.style.dropShadow)this._setupDropShadow(a,I.style,i,S);else{R+=Y;continue}else{const mt=te.measureFont(nt),$t=I.style.lineHeight||mt.fontSize,Ee={width:Y,height:$t,lineHeight:$t,lines:[I.text]};a.strokeStyle=ir(ct,a,Ee,r*2,R-r,T)}this._drawLetterSpacing(I.text,I.style,n,R,C+r-v,!0)}R+=Y}R=V+r;for(let z=0;z<k.length;z++){const I=k[z],{width:Y,font:nt}=F[z];if(a.font=nt,a.textBaseline=I.style.textBaseline,I.style._fill!==void 0){if(w)if(I.style.dropShadow)this._setupDropShadow(a,I.style,i,S);else{R+=Y;continue}else{const ct=te.measureFont(nt),mt=I.style.lineHeight||ct.fontSize,$t={width:Y,height:mt,lineHeight:mt,lines:[I.text]};a.fillStyle=ir(I.style._fill,a,$t,r*2,R-r,T)}this._drawLetterSpacing(I.text,I.style,n,R,C+r-v,!1)}R+=Y}T+=$}}}_setFillAndStrokeStyles(t,e,r,i,n,o=0,a=0){if(t.fillStyle=e._fill?ir(e._fill,t,r,i*2,o,a):null,e._stroke?.width){const l=n+i*2;t.strokeStyle=ir(e._stroke,t,r,l,o,a)}}_setupDropShadow(t,e,r,i){t.fillStyle="black",t.strokeStyle="black";const n=e.dropShadow,o=n.color,a=n.alpha;t.shadowColor=ht.shared.setValue(o).setAlpha(a).toRgbaString();const l=n.blur*r,h=n.distance*r;t.shadowBlur=l,t.shadowOffsetX=Math.cos(n.angle)*h,t.shadowOffsetY=Math.sin(n.angle)*h+i}_getAlignmentOffset(t,e,r){return r==="right"?e-t:r==="center"?(e-t)/2:0}_drawLetterSpacing(t,e,r,i,n,o=!1){const{context:a}=r,l=e.letterSpacing;let h=!1;if(te.experimentalLetterSpacingSupported&&(te.experimentalLetterSpacing?(a.letterSpacing=`${l}px`,a.textLetterSpacing=`${l}px`,h=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),l===0||h){o?a.strokeText(t,i,n):a.fillText(t,i,n);return}let c=i;const u=te.graphemeSegmenter(t);let f=a.measureText(t).width,d=0;for(let p=0;p<u.length;++p){const m=u[p];o?a.strokeText(m,c,n):a.fillText(m,c,n);let g="";for(let y=p+1;y<u.length;++y)g+=u[y];d=a.measureText(g).width,c+=f-d+l,f=d}}}const Ge=new Fp,An=class xe extends Gt{constructor(t={}){super(),this.uid=it("textStyle"),this._tick=0,this._cachedFontString=null,jp(t),t instanceof xe&&(t=t._toObject());const i={...xe.defaultTextStyle,...t};for(const n in i){const o=n;this[o]=i[n]}this._tagStyles=t.tagStyles??void 0,this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...xe.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...xe.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...Tt.defaultFillStyle,...t},()=>{this._fill=Ae({...this._originalFill},Tt.defaultFillStyle)})),this._fill=Ae(t===0?"black":t,Tt.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...Tt.defaultStrokeStyle,...t},()=>{this._stroke=vr({...this._originalStroke},Tt.defaultStrokeStyle)})),this._stroke=vr(t,Tt.defaultStrokeStyle),this.update())}get tagStyles(){return this._tagStyles}set tagStyles(t){this._tagStyles!==t&&(this._tagStyles=t??void 0,this.update())}update(){this._tick++,this._cachedFontString=null,this.emit("update",this)}reset(){const t=xe.defaultTextStyle;for(const e in t)this[e]=t[e]}assign(t){for(const e in t){const r=e;this[r]=t[e]}return this}get styleKey(){return`${this.uid}-${this._tick}`}get _fontString(){return this._cachedFontString===null&&(this._cachedFontString=Vi(this)),this._cachedFontString}_toObject(){return{align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill?{...this._fill}:void 0,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke?{...this._stroke}:void 0,textBaseline:this.textBaseline,trim:this.trim,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0,tagStyles:this._tagStyles?{...this._tagStyles}:void 0}}clone(){return new xe(this._toObject())}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(r),this._originalFill?.texture&&this._originalFill.texture.destroy(r),this._stroke?.texture&&this._stroke.texture.destroy(r),this._originalStroke?.texture&&this._originalStroke.texture.destroy(r)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(r,i,n)=>(r[i]===n||(r[i]=n,e?.(i,n),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(ht.isColorLike(t)||t instanceof Kt||t instanceof Ir)}};An.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};An.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Sr=An;function jp(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=Sr.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){W(rt,"strokeThickness is now a part of stroke");const e=t.stroke;let r={};if(ht.isColorLike(e))r.color=e;else if(e instanceof Kt||e instanceof Ir)r.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))r=e;else throw new Error("Invalid stroke value.");s.stroke={...r,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(W(rt,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&Z("The number of fill colors must match the number of fill gradient stops.");const e=new Kt({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),r=t.fillGradientStops.slice(),i=t.fill.map(n=>ht.shared.setValue(n).toNumber());r.forEach((n,o)=>{e.addColorStop(n,i[o])}),s.fill={fill:e}}}function Np(s,t){const{texture:e,bounds:r}=s,i=t._style._getFinalPadding();La(r,t._anchor,e);const n=t._anchor._x*i*2,o=t._anchor._y*i*2;r.minX-=i-n,r.minY-=i-o,r.maxX-=i-n,r.maxY-=i-o}class Gp{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}destroy(){this.reset()}}class Wp extends Gp{}class eh{constructor(t){this._renderer=t,t.runners.resolutionChange.add(this),this._managedTexts=new js({renderer:t,type:"renderable",onUnload:this.onTextUnload.bind(this),name:"canvasText"})}resolutionChange(){for(const t in this._managedTexts.items){const e=this._managedTexts.items[t];e?._autoResolution&&e.onViewUpdate()}}validateRenderable(t){const e=this._getGpuText(t),r=t.styleKey;return e.currentKey!==r?!0:t._didTextUpdate}addRenderable(t,e){const r=this._getGpuText(t);if(t._didTextUpdate){const i=t._autoResolution?this._renderer.resolution:t.resolution;(r.currentKey!==t.styleKey||t._resolution!==i)&&this._updateGpuText(t),t._didTextUpdate=!1,Np(r,t)}this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}_updateGpuText(t){const e=this._getGpuText(t);e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,e.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t.styleKey}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new Wp;return e.currentKey="--",e.renderable=t,e.transform=t.groupTransform,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,this._managedTexts.add(t),e}onTextUnload(t){const e=t._gpuData[this._renderer.uid];if(!e)return;const{canvasText:r}=this._renderer;r.getReferenceCount(e.currentKey)>0?r.decreaseReferenceCount(e.currentKey):e.texture&&r.returnTexture(e.texture)}destroy(){this._managedTexts.destroy(),this._renderer=null}}eh.extension={type:[M.WebGLPipes,M.WebGPUPipes,M.CanvasPipes],name:"text"};const zp=new Ct;function Hp(s,t,e,r){const i=zp;i.minX=0,i.minY=0,i.maxX=s.width/r|0,i.maxY=s.height/r|0;const n=Cr.getOptimalTexture(i.width,i.height,r,!1);return n.source.uploadMethodId="image",n.source.resource=s,n.source.alphaMode="premultiply-alpha-on-upload",n.frame.width=t/r,n.frame.height=e/r,n.source.emit("update",n.source),n.updateUvs(),n}class sh{constructor(t,e){this._activeTextures={},this._renderer=t,this._retainCanvasContext=e}getTexture(t,e,r,i){typeof t=="string"&&(W("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:r,resolution:e}),t.style instanceof Sr||(t.style=new Sr(t.style)),t.textureStyle instanceof Ke||(t.textureStyle=new Ke(t.textureStyle)),typeof t.text!="string"&&(t.text=t.text.toString());const{text:n,style:o,textureStyle:a}=t,l=t.resolution??this._renderer.resolution,{frame:h,canvasAndContext:c}=Ge.getCanvasAndContext({text:n,style:o,resolution:l}),u=Hp(c.canvas,h.width,h.height,l);if(a&&(u.source.style=a),o.trim&&(h.pad(o.padding),u.frame.copyFrom(h),u.frame.scale(1/l),u.updateUvs()),o.filters){const f=this._applyFilters(u,o.filters);return this.returnTexture(u),Ge.returnCanvasAndContext(c),f}return this._renderer.texture.initSource(u._source),this._retainCanvasContext||Ge.returnCanvasAndContext(c),u}returnTexture(t){const e=t.source,r=e.resource;if(this._retainCanvasContext&&r?.getContext){const i=r.getContext("2d");i&&Ge.returnCanvasAndContext({canvas:r,context:i})}e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",Cr.returnTexture(t,!0)}renderTextToCanvas(){W("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}getManagedTexture(t){t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const e=t.styleKey;if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;const r=this.getTexture({text:t.text,style:t.style,resolution:t._resolution,textureStyle:t.textureStyle});return this._activeTextures[e]={texture:r,usageCount:1},r}decreaseReferenceCount(t){const e=this._activeTextures[t];e&&(e.usageCount--,e.usageCount===0&&(this.returnTexture(e.texture),this._activeTextures[t]=null))}getReferenceCount(t){return this._activeTextures[t]?.usageCount??0}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}_applyFilters(t,e){const r=this._renderer.renderTarget.renderTarget,i=this._renderer.filter.generateFilteredTexture({texture:t,filters:e});return this._renderer.renderTarget.bind(r,!1),i}destroy(){this._renderer=null;for(const t in this._activeTextures)this._activeTextures[t]&&this.returnTexture(this._activeTextures[t].texture);this._activeTextures=null}}class rh extends sh{constructor(t){super(t,!0)}}rh.extension={type:[M.CanvasSystem],name:"canvasText"};class ih extends sh{constructor(t){super(t,!1)}}ih.extension={type:[M.WebGLSystem,M.WebGPUSystem],name:"canvasText"};K.add(rh);K.add(ih);K.add(eh);class at extends yp{constructor(...t){const e=_p(t,"Text");super(e,Sr),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof Ke?e.textureStyle:new Ke(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let r=0,i=0;if(this._style.trim){const{frame:n,canvasAndContext:o}=Ge.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Ge.returnCanvasAndContext(o),r=n.width,i=n.height}else{const n=te.measureText(this._text,this._style);r=n.width,i=n.height}t.minX=-e._x*r,t.maxX=t.minX+r,t.minY=-e._y*i,t.maxY=t.minY+i}}K.add(Mh,Ih);class Vp{fixedDt;maxSubSteps;onFixedUpdate;onUpdate;accumulator=0;constructor(t){this.fixedDt=t.fixedDt,this.maxSubSteps=t.maxSubSteps,this.onFixedUpdate=t.onFixedUpdate,this.onUpdate=t.onUpdate}tick(t){const e=Math.min(t,.25);this.accumulator+=e;let r=0;for(;this.accumulator>=this.fixedDt&&r<this.maxSubSteps;)this.onFixedUpdate(this.fixedDt),this.accumulator-=this.fixedDt,r++;this.onUpdate(e)}}class qp{app;debug;factories=new Map;current=null;data={};loop;constructor(t,e){this.app=t,this.debug=e,this.loop=new Vp({fixedDt:1/60,maxSubSteps:5,onFixedUpdate:r=>this.current?.fixedUpdate?.(r),onUpdate:r=>this.current?.update(r)}),this.app.ticker.add(()=>{const r=this.app.ticker.deltaMS/1e3;this.loop.tick(r)})}getApp(){return this.app}getDebug(){return this.debug}register(t,e){this.factories.set(t,e)}start(t){this.switchTo(t)}switchTo(t){const e=this.factories.get(t);if(!e)throw new Error(`Unknown scene: ${t}`);this.current&&this.current.exit(),this.app.stage.removeChildren(),this.current=e(),this.current.enter()}}function Ce(s){const t="/sling-survivor/";return s.startsWith("/")?t.slice(0,-1)+s:t+s}let qi=null,Yi=null;function Yp(){return qi}function Xp(){return Yi}async function Kp(){try{qi=await Lt.load(Ce("/assets/player_rocket.png"))}catch{qi=null}try{Yi=await Lt.load(Ce("/assets/enemies/ufo.png"))}catch{Yi=null}}const nr=[{id:"launch",title:"Launch",body:"Pull back on the launcher and release to launch your rocket. The further you pull, the more power."},{id:"thrust",title:"Thrust",body:"Use WASD or Arrow keys to thrust and steer. Your boost bar depletes while thrusting and refills when you don't."},{id:"coins",title:"Collect coins",body:"Fly through gold coins in the world to earn currency. Spend it at the merchant between rounds."},{id:"enemies",title:"Fight enemies",body:"UFOs chase and shoot at you. Destroy them with your weapon to gain scrap and XP. Level up to choose upgrades."},{id:"survive",title:"Survive",body:"Reach the round toll in scrap before you run out of rockets. Pay the toll at the merchant to advance. Good luck!"}];class Jp{el=null;currentPage=0;show(t,e){if(!this.el){this.el=document.createElement("div"),this.el.className="help-overlay",this.el.innerHTML=this.markup(),document.body.appendChild(this.el);const r=this.el.querySelector(".help-overlay-backdrop"),i=this.el.querySelector(".help-overlay-close"),n=this.el.querySelectorAll(".help-sidebar a");r?.addEventListener("click",()=>this.hide()),i?.addEventListener("click",()=>this.hide()),this.el.querySelector(".help-overlay-panel")?.addEventListener("click",a=>a.stopPropagation()),n.forEach((a,l)=>{a.addEventListener("click",h=>{h.preventDefault(),this.showPage(l)})}),this.el.querySelector(".help-next-btn")?.addEventListener("click",a=>{a.preventDefault();const l=(this.currentPage+1)%nr.length;this.showPage(l)})}this.el.style.display="flex",this.showPage(0)}hide(){this.el&&(this.el.style.display="none")}updateNextArrow(){if(!this.el)return;const t=this.el.querySelector(".help-next-btn");if(!t)return;const e=this.currentPage===nr.length-1;t.style.opacity=e?"0.4":"1",t.style.pointerEvents=e?"none":"auto"}showPage(t){this.currentPage=t,this.el&&(this.el.querySelectorAll(".help-sidebar a").forEach((e,r)=>{e.classList.toggle("active",r===t)}),this.el.querySelectorAll(".help-page").forEach((e,r)=>{e.style.display=r===t?"block":"none"}),this.updateNextArrow())}markup(){return`
<style>
  .help-overlay {
    position: fixed;
    inset: 0;
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.75);
  }
  .help-overlay-backdrop {
    position: absolute;
    inset: 0;
    cursor: pointer;
  }
  .help-overlay-panel {
    position: relative;
    width: 80vw;
    max-width: 100%;
    height: 80vh;
    max-height: 100%;
    display: flex;
    flex-direction: column;
    background: #12122a;
    border-radius: 16px;
    border: 2px solid rgba(68,136,170,0.6);
    box-shadow: 0 0 60px rgba(0,0,0,0.6);
    overflow: hidden;
    margin: auto;
  }
  .help-header {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 20px;
    background: rgba(0,0,0,0.35);
    border-bottom: 1px solid rgba(68,136,170,0.4);
  }
  .help-header-title {
    color: #fff;
    font: bold 18px system-ui, sans-serif;
    letter-spacing: 1px;
  }
  .help-overlay-close {
    padding: 8px 20px;
    background: #4488aa;
    color: #fff;
    border: none;
    border-radius: 10px;
    font: bold 14px system-ui, sans-serif;
    cursor: pointer;
  }
  .help-overlay-close:hover { background: #55aacc; }
  .help-panel-body {
    flex: 1;
    display: flex;
    min-height: 0;
  }
  .help-sidebar {
    width: 160px;
    flex-shrink: 0;
    background: rgba(0,0,0,0.3);
    padding: 20px 0;
  }
  .help-sidebar a {
    display: block;
    padding: 12px 20px;
    color: #8899aa;
    text-decoration: none;
    font: 14px/1.3 system-ui, sans-serif;
    border-left: 3px solid transparent;
  }
  .help-sidebar a:hover { color: #aaccdd; }
  .help-sidebar a.active {
    color: #fff;
    background: rgba(68,136,170,0.25);
    border-left-color: #4488aa;
  }
  .help-main-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
    position: relative;
  }
  .help-main {
    flex: 1;
    overflow: auto;
    padding: 24px 32px 60px 32px;
    scrollbar-width: thin;
    scrollbar-color: #4488aa #1a1a2e;
  }
  .help-main::-webkit-scrollbar { width: 10px; }
  .help-main::-webkit-scrollbar-track { background: #1a1a2e; }
  .help-main::-webkit-scrollbar-thumb { background: #4488aa; border-radius: 5px; }
  .help-main::-webkit-scrollbar-thumb:hover { background: #55aacc; }
  .help-next-btn {
    position: absolute;
    bottom: 20px;
    right: 24px;
    width: 48px;
    height: 48px;
    padding: 0;
    border: none;
    background: rgba(68,136,170,0.5);
    color: #fff;
    border-radius: 12px;
    font-size: 28px;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
  }
  .help-next-btn:hover { background: #4488aa; }
  .help-page { display: none; }
  .help-page h2 {
    margin: 0 0 16px 0;
    color: #88aacc;
    font: bold 20px/1.3 system-ui, sans-serif;
  }
  .help-image-wrap {
    width: 100%;
    max-width: 560px;
    aspect-ratio: 16/10;
    margin-bottom: 20px;
    background: #1a1a2e;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .help-image-wrap img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  .help-image-wrap img:not([src]),
  .help-image-wrap img[src=""] {
    display: none;
  }
  .help-image-wrap:has(img[src]:not([src=""])) .help-image-placeholder {
    display: none;
  }
  .help-image-wrap .help-image-placeholder {
    color: #556677;
    font: 14px system-ui, sans-serif;
    padding: 24px;
    text-align: center;
  }
  .help-body {
    color: #ccccdd;
    font: 14px/1.5 system-ui, sans-serif;
    max-width: 520px;
  }
  .help-overlay-close {
    position: absolute;
    top: 16px;
    right: 20px;
    padding: 10px 24px;
    background: #4488aa;
    color: #fff;
    border: none;
    border-radius: 10px;
    font: bold 14px system-ui, sans-serif;
    cursor: pointer;
    z-index: 1;
  }
  .help-overlay-close:hover { background: #55aacc; }
</style>
<div class="help-overlay-backdrop" aria-label="Close"></div>
<div class="help-overlay-panel">
  <header class="help-header">
    <span class="help-header-title">How to Play</span>
    <button type="button" class="help-overlay-close">Got it</button>
  </header>
  <div class="help-panel-body">
    <nav class="help-sidebar">
    ${nr.map((r,i)=>`<a href="#" class="${i===0?"active":""}" data-page="${i}">${r.title}</a>`).join("")}
  </nav>
    <div class="help-main-wrap">
      <main class="help-main">
        ${nr.map((r,i)=>`
        <section class="help-page" data-page="${i}" style="display: ${i===0?"block":"none"}">
          <h2>${r.title}</h2>
          <div class="help-image-wrap">
            <img src="" alt="${r.title}" data-help-image="${r.id}" />
            <span class="help-image-placeholder">Image: set img src for "${r.id}"</span>
          </div>
          <p class="help-body">${r.body}</p>
        </section>
        `).join("")}
      </main>
      <button type="button" class="help-next-btn" aria-label="Next page"></button>
    </div>
  </div>
</div>
`}}function Or(s,t){var e={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(s);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(s,r[i])&&(e[r[i]]=s[r[i]]);return e}function Zp(s,t,e,r){function i(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(c){try{h(r.next(c))}catch(u){o(u)}}function l(c){try{h(r.throw(c))}catch(u){o(u)}}function h(c){c.done?n(c.value):i(c.value).then(a,l)}h((r=r.apply(s,t||[])).next())})}const Qp=s=>s?(...t)=>s(...t):(...t)=>fetch(...t);class Tn extends Error{constructor(t,e="FunctionsError",r){super(t),this.name=e,this.context=r}}class tg extends Tn{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Yo extends Tn{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Xo extends Tn{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Xi;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(Xi||(Xi={}));class eg{constructor(t,{headers:e={},customFetch:r,region:i=Xi.Any}={}){this.url=t,this.headers=e,this.region=i,this.fetch=Qp(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Zp(this,arguments,void 0,function*(e,r={}){var i;let n,o;try{const{headers:a,method:l,body:h,signal:c,timeout:u}=r;let f={},{region:d}=r;d||(d=this.region);const p=new URL(`${this.url}/${e}`);d&&d!=="any"&&(f["x-region"]=d,p.searchParams.set("forceFunctionRegion",d));let m;h&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",m=h):typeof h=="string"?(f["Content-Type"]="text/plain",m=h):typeof FormData<"u"&&h instanceof FormData?m=h:(f["Content-Type"]="application/json",m=JSON.stringify(h)):h&&typeof h!="string"&&!(typeof Blob<"u"&&h instanceof Blob)&&!(h instanceof ArrayBuffer)&&!(typeof FormData<"u"&&h instanceof FormData)?m=JSON.stringify(h):m=h;let g=c;u&&(o=new AbortController,n=setTimeout(()=>o.abort(),u),c?(g=o.signal,c.addEventListener("abort",()=>o.abort())):g=o.signal);const y=yield this.fetch(p.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),a),body:m,signal:g}).catch(w=>{throw new tg(w)}),x=y.headers.get("x-relay-error");if(x&&x==="true")throw new Yo(y);if(!y.ok)throw new Xo(y);let b=((i=y.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),_;return b==="application/json"?_=yield y.json():b==="application/octet-stream"||b==="application/pdf"?_=yield y.blob():b==="text/event-stream"?_=y:b==="multipart/form-data"?_=yield y.formData():_=yield y.text(),{data:_,error:null,response:y}}catch(a){return{data:null,error:a,response:a instanceof Xo||a instanceof Yo?a.context:void 0}}finally{n&&clearTimeout(n)}})}}var sg=class extends Error{constructor(s){super(s.message),this.name="PostgrestError",this.details=s.details,this.hint=s.hint,this.code=s.code}},rg=class{constructor(s){var t,e,r;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(t=s.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=s.signal,this.isMaybeSingle=(e=s.isMaybeSingle)!==null&&e!==void 0?e:!1,this.urlLengthLimit=(r=s.urlLengthLimit)!==null&&r!==void 0?r:8e3,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,t){return this.headers=new Headers(this.headers),this.headers.set(s,t),this}then(s,t){var e=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{let o=null,a=null,l=null,h=n.status,c=n.statusText;if(n.ok){var u,f;if(e.method!=="HEAD"){var d;const y=await n.text();y===""||(e.headers.get("Accept")==="text/csv"||e.headers.get("Accept")&&(!((d=e.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?a=y:a=JSON.parse(y))}const m=(u=e.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),g=(f=n.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");m&&g&&g.length>1&&(l=parseInt(g[1])),e.isMaybeSingle&&e.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,h=406,c="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var p;const m=await n.text();try{o=JSON.parse(m),Array.isArray(o)&&n.status===404&&(a=[],o=null,h=200,c="OK")}catch{n.status===404&&m===""?(h=204,c="No Content"):o={message:m}}if(o&&e.isMaybeSingle&&(!(o==null||(p=o.details)===null||p===void 0)&&p.includes("0 rows"))&&(o=null,h=200,c="OK"),o&&e.shouldThrowOnError)throw new sg(o)}return{error:o,data:a,count:l,status:h,statusText:c}});return this.shouldThrowOnError||(i=i.catch(n=>{var o;let a="",l="",h="";const c=n?.cause;if(c){var u,f,d,p;const y=(u=c?.message)!==null&&u!==void 0?u:"",x=(f=c?.code)!==null&&f!==void 0?f:"";a=`${(d=n?.name)!==null&&d!==void 0?d:"FetchError"}: ${n?.message}`,a+=`

Caused by: ${(p=c?.name)!==null&&p!==void 0?p:"Error"}: ${y}`,x&&(a+=` (${x})`),c?.stack&&(a+=`
${c.stack}`)}else{var m;a=(m=n?.stack)!==null&&m!==void 0?m:""}const g=this.url.toString().length;return n?.name==="AbortError"||n?.code==="ABORT_ERR"?(h="",l="Request was aborted (timeout or manual cancellation)",g>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${g} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(c?.name==="HeadersOverflowError"||c?.code==="UND_ERR_HEADERS_OVERFLOW")&&(h="",l="HTTP headers exceeded server limits (typically 16KB)",g>this.urlLengthLimit&&(l+=`. Your request URL is ${g} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=n?.name)!==null&&o!==void 0?o:"FetchError"}: ${n?.message}`,details:a,hint:l,code:h},data:null,count:null,status:0,statusText:""}})),i.then(s,t)}returns(){return this}overrideTypes(){return this}},ig=class extends rg{select(s){let t=!1;const e=(s??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",e),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:t=!0,nullsFirst:e,foreignTable:r,referencedTable:i=r}={}){const n=i?`${i}.order`:"order",o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?`${o},`:""}${s}.${t?"asc":"desc"}${e===void 0?"":e?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:t,referencedTable:e=t}={}){const r=typeof e>"u"?"limit":`${e}.limit`;return this.url.searchParams.set(r,`${s}`),this}range(s,t,{foreignTable:e,referencedTable:r=e}={}){const i=typeof r>"u"?"offset":`${r}.offset`,n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${s}`),this.url.searchParams.set(n,`${t-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:t=!1,settings:e=!1,buffers:r=!1,wal:i=!1,format:n="text"}={}){var o;const a=[s?"analyze":null,t?"verbose":null,e?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${l}"; options=${a};`),n==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};const Ko=new RegExp("[,()]");var Ue=class extends ig{eq(s,t){return this.url.searchParams.append(s,`eq.${t}`),this}neq(s,t){return this.url.searchParams.append(s,`neq.${t}`),this}gt(s,t){return this.url.searchParams.append(s,`gt.${t}`),this}gte(s,t){return this.url.searchParams.append(s,`gte.${t}`),this}lt(s,t){return this.url.searchParams.append(s,`lt.${t}`),this}lte(s,t){return this.url.searchParams.append(s,`lte.${t}`),this}like(s,t){return this.url.searchParams.append(s,`like.${t}`),this}likeAllOf(s,t){return this.url.searchParams.append(s,`like(all).{${t.join(",")}}`),this}likeAnyOf(s,t){return this.url.searchParams.append(s,`like(any).{${t.join(",")}}`),this}ilike(s,t){return this.url.searchParams.append(s,`ilike.${t}`),this}ilikeAllOf(s,t){return this.url.searchParams.append(s,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(s,t){return this.url.searchParams.append(s,`ilike(any).{${t.join(",")}}`),this}regexMatch(s,t){return this.url.searchParams.append(s,`match.${t}`),this}regexIMatch(s,t){return this.url.searchParams.append(s,`imatch.${t}`),this}is(s,t){return this.url.searchParams.append(s,`is.${t}`),this}isDistinct(s,t){return this.url.searchParams.append(s,`isdistinct.${t}`),this}in(s,t){const e=Array.from(new Set(t)).map(r=>typeof r=="string"&&Ko.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(s,`in.(${e})`),this}notIn(s,t){const e=Array.from(new Set(t)).map(r=>typeof r=="string"&&Ko.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(s,`not.in.(${e})`),this}contains(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cs.{${t.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(t)}`),this}containedBy(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cd.{${t.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(t)}`),this}rangeGt(s,t){return this.url.searchParams.append(s,`sr.${t}`),this}rangeGte(s,t){return this.url.searchParams.append(s,`nxl.${t}`),this}rangeLt(s,t){return this.url.searchParams.append(s,`sl.${t}`),this}rangeLte(s,t){return this.url.searchParams.append(s,`nxr.${t}`),this}rangeAdjacent(s,t){return this.url.searchParams.append(s,`adj.${t}`),this}overlaps(s,t){return typeof t=="string"?this.url.searchParams.append(s,`ov.${t}`):this.url.searchParams.append(s,`ov.{${t.join(",")}}`),this}textSearch(s,t,{config:e,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const n=e===void 0?"":`(${e})`;return this.url.searchParams.append(s,`${i}fts${n}.${t}`),this}match(s){return Object.entries(s).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(s,t,e){return this.url.searchParams.append(s,`not.${t}.${e}`),this}or(s,{foreignTable:t,referencedTable:e=t}={}){const r=e?`${e}.or`:"or";return this.url.searchParams.append(r,`(${s})`),this}filter(s,t,e){return this.url.searchParams.append(s,`${t}.${e}`),this}},ng=class{constructor(s,{headers:t={},schema:e,fetch:r,urlLengthLimit:i=8e3}){this.url=s,this.headers=new Headers(t),this.schema=e,this.fetch=r,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(s,t){const{head:e=!1,count:r}=t??{},i=e?"HEAD":"GET";let n=!1;const o=(s??"*").split("").map(h=>/\s/.test(h)&&!n?"":(h==='"'&&(n=!n),h)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),r&&l.append("Prefer",`count=${r}`),new Ue({method:i,url:a,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(s,{count:t,defaultToNull:e=!0}={}){var r;const i="POST",{url:n,headers:o}=this.cloneRequestState();if(t&&o.append("Prefer",`count=${t}`),e||o.append("Prefer","missing=default"),Array.isArray(s)){const a=s.reduce((l,h)=>l.concat(Object.keys(h)),[]);if(a.length>0){const l=[...new Set(a)].map(h=>`"${h}"`);n.searchParams.set("columns",l.join(","))}}return new Ue({method:i,url:n,headers:o,schema:this.schema,body:s,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(s,{onConflict:t,ignoreDuplicates:e=!1,count:r,defaultToNull:i=!0}={}){var n;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${e?"ignore":"merge"}-duplicates`),t!==void 0&&a.searchParams.set("on_conflict",t),r&&l.append("Prefer",`count=${r}`),i||l.append("Prefer","missing=default"),Array.isArray(s)){const h=s.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(h.length>0){const c=[...new Set(h)].map(u=>`"${u}"`);a.searchParams.set("columns",c.join(","))}}return new Ue({method:o,url:a,headers:l,schema:this.schema,body:s,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}update(s,{count:t}={}){var e;const r="PATCH",{url:i,headers:n}=this.cloneRequestState();return t&&n.append("Prefer",`count=${t}`),new Ue({method:r,url:i,headers:n,schema:this.schema,body:s,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:s}={}){var t;const e="DELETE",{url:r,headers:i}=this.cloneRequestState();return s&&i.append("Prefer",`count=${s}`),new Ue({method:e,url:r,headers:i,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function Is(s){"@babel/helpers - typeof";return Is=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Is(s)}function og(s,t){if(Is(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var r=e.call(s,t);if(Is(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function ag(s){var t=og(s,"string");return Is(t)=="symbol"?t:t+""}function lg(s,t,e){return(t=ag(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function Jo(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),e.push.apply(e,r)}return e}function or(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Jo(Object(e),!0).forEach(function(r){lg(s,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):Jo(Object(e)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(e,r))})}return s}var hg=class nh{constructor(t,{headers:e={},schema:r,fetch:i,timeout:n,urlLengthLimit:o=8e3}={}){this.url=t,this.headers=new Headers(e),this.schemaName=r,this.urlLengthLimit=o;const a=i??globalThis.fetch;n!==void 0&&n>0?this.fetch=(l,h)=>{const c=new AbortController,u=setTimeout(()=>c.abort(),n),f=h?.signal;if(f){if(f.aborted)return clearTimeout(u),a(l,h);const d=()=>{clearTimeout(u),c.abort()};return f.addEventListener("abort",d,{once:!0}),a(l,or(or({},h),{},{signal:c.signal})).finally(()=>{clearTimeout(u),f.removeEventListener("abort",d)})}return a(l,or(or({},h),{},{signal:c.signal})).finally(()=>clearTimeout(u))}:this.fetch=a}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new ng(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new nh(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,e={},{head:r=!1,get:i=!1,count:n}={}){var o;let a;const l=new URL(`${this.url}/rpc/${t}`);let h;const c=d=>d!==null&&typeof d=="object"&&(!Array.isArray(d)||d.some(c)),u=r&&Object.values(e).some(c);u?(a="POST",h=e):r||i?(a=r?"HEAD":"GET",Object.entries(e).filter(([d,p])=>p!==void 0).map(([d,p])=>[d,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([d,p])=>{l.searchParams.append(d,p)})):(a="POST",h=e);const f=new Headers(this.headers);return u?f.set("Prefer",n?`count=${n},return=minimal`:"return=minimal"):n&&f.set("Prefer",`count=${n}`),new Ue({method:a,url:l,headers:f,schema:this.schemaName,body:h,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class cg{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const e=globalThis.process;if(e){const r=e.versions;if(r&&r.node){const i=r.node,n=parseInt(i.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){const r=this.getWebSocketConstructor();return new r(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const ug="2.97.0",dg=`realtime-js/${ug}`,fg="1.0.0",oh="2.0.0",Zo=oh,Ki=1e4,pg=1e3,gg=100;var ee;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(ee||(ee={}));var lt;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(lt||(lt={}));var Mt;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(Mt||(Mt={}));var Ji;(function(s){s.websocket="websocket"})(Ji||(Ji={}));var ve;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(ve||(ve={}));class mg{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,e){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return e(this._binaryEncodeUserBroadcastPush(t));let r=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(t){var e;return this._isArrayBuffer((e=t.payload)===null||e===void 0?void 0:e.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var e,r;const i=(r=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(t){var e,r;const i=(r=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,e,r){var i,n;const o=t.topic,a=(i=t.ref)!==null&&i!==void 0?i:"",l=(n=t.join_ref)!==null&&n!==void 0?n:"",h=t.payload.event,c=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},u=Object.keys(c).length===0?"":JSON.stringify(c);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const f=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+h.length+u.length,d=new ArrayBuffer(this.HEADER_LENGTH+f);let p=new DataView(d),m=0;p.setUint8(m++,this.KINDS.userBroadcastPush),p.setUint8(m++,l.length),p.setUint8(m++,a.length),p.setUint8(m++,o.length),p.setUint8(m++,h.length),p.setUint8(m++,u.length),p.setUint8(m++,e),Array.from(l,y=>p.setUint8(m++,y.charCodeAt(0))),Array.from(a,y=>p.setUint8(m++,y.charCodeAt(0))),Array.from(o,y=>p.setUint8(m++,y.charCodeAt(0))),Array.from(h,y=>p.setUint8(m++,y.charCodeAt(0))),Array.from(u,y=>p.setUint8(m++,y.charCodeAt(0)));var g=new Uint8Array(d.byteLength+r.byteLength);return g.set(new Uint8Array(d),0),g.set(new Uint8Array(r),d.byteLength),g.buffer}decode(t,e){if(this._isArrayBuffer(t)){let r=this._binaryDecode(t);return e(r)}if(typeof t=="string"){const r=JSON.parse(t),[i,n,o,a,l]=r;return e({join_ref:i,ref:n,topic:o,event:a,payload:l})}return e({})}_binaryDecode(t){const e=new DataView(t),r=e.getUint8(0),i=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,e,i)}_decodeUserBroadcast(t,e,r){const i=e.getUint8(1),n=e.getUint8(2),o=e.getUint8(3),a=e.getUint8(4);let l=this.HEADER_LENGTH+4;const h=r.decode(t.slice(l,l+i));l=l+i;const c=r.decode(t.slice(l,l+n));l=l+n;const u=r.decode(t.slice(l,l+o));l=l+o;const f=t.slice(l,t.byteLength),d=a===this.JSON_ENCODING?JSON.parse(r.decode(f)):f,p={type:this.BROADCAST_EVENT,event:c,payload:d};return o>0&&(p.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(t){var e;return t instanceof ArrayBuffer||((e=t?.constructor)===null||e===void 0?void 0:e.name)==="ArrayBuffer"}_pick(t,e){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([r])=>e.includes(r)))}}class ah{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var X;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(X||(X={}));const Qo=(s,t,e={})=>{var r;const i=(r=e.skipTypes)!==null&&r!==void 0?r:[];return t?Object.keys(t).reduce((n,o)=>(n[o]=yg(o,s,t,i),n),{}):{}},yg=(s,t,e,r)=>{const i=t.find(a=>a.name===s),n=i?.type,o=e[s];return n&&!r.includes(n)?lh(n,o):Zi(o)},lh=(s,t)=>{if(s.charAt(0)==="_"){const e=s.slice(1,s.length);return wg(t,e)}switch(s){case X.bool:return _g(t);case X.float4:case X.float8:case X.int2:case X.int4:case X.int8:case X.numeric:case X.oid:return bg(t);case X.json:case X.jsonb:return xg(t);case X.timestamp:return vg(t);case X.abstime:case X.date:case X.daterange:case X.int4range:case X.int8range:case X.money:case X.reltime:case X.text:case X.time:case X.timestamptz:case X.timetz:case X.tsrange:case X.tstzrange:return Zi(t);default:return Zi(t)}},Zi=s=>s,_g=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},bg=s=>{if(typeof s=="string"){const t=parseFloat(s);if(!Number.isNaN(t))return t}return s},xg=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s},wg=(s,t)=>{if(typeof s!="string")return s;const e=s.length-1,r=s[e];if(s[0]==="{"&&r==="}"){let n;const o=s.slice(1,e);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>lh(t,a))}return s},vg=s=>typeof s=="string"?s.replace(" ","T"):s,hh=s=>{const t=new URL(s);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class gi{constructor(t,e,r={},i=Ki){this.channel=t,this.event=e,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this._hasReceived(t)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var ta;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(ta||(ta={}));class As{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=As.syncState(this.state,i,n,o),this.pendingDiffs.forEach(l=>{this.state=As.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=As.syncDiff(this.state,i,n,o),a())}),this.onJoin((i,n,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:o})}),this.onLeave((i,n,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,r,i){const n=this.cloneDeep(t),o=this.transformState(e),a={},l={};return this.map(n,(h,c)=>{o[h]||(l[h]=c)}),this.map(o,(h,c)=>{const u=n[h];if(u){const f=c.map(g=>g.presence_ref),d=u.map(g=>g.presence_ref),p=c.filter(g=>d.indexOf(g.presence_ref)<0),m=u.filter(g=>f.indexOf(g.presence_ref)<0);p.length>0&&(a[h]=p),m.length>0&&(l[h]=m)}else a[h]=c}),this.syncDiff(n,{joins:a,leaves:l},r,i)}static syncDiff(t,e,r,i){const{joins:n,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(n,(a,l)=>{var h;const c=(h=t[a])!==null&&h!==void 0?h:[];if(t[a]=this.cloneDeep(l),c.length>0){const u=t[a].map(d=>d.presence_ref),f=c.filter(d=>u.indexOf(d.presence_ref)<0);t[a].unshift(...f)}r(a,c,l)}),this.map(o,(a,l)=>{let h=t[a];if(!h)return;const c=l.map(u=>u.presence_ref);h=h.filter(u=>c.indexOf(u.presence_ref)<0),t[a]=h,i(a,h,l),h.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(r=>e(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,r)=>{const i=t[r];return"metas"in i?e[r]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):e[r]=i,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ea;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(ea||(ea={}));var Ts;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Ts||(Ts={}));var Vt;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Vt||(Vt={}));class We{constructor(t,e={config:{}},r){var i,n;if(this.topic=t,this.params=e,this.socket=r,this.bindings={},this.state=lt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new gi(this,Mt.join,this.params,this.timeout),this.rejoinTimer=new ah(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=lt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=lt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=lt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=lt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=lt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Mt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new As(this),this.broadcastEndpointURL=hh(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((n=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||n===void 0)&&n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var r,i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==lt.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,h=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(d=>d.filter))!==null&&i!==void 0?i:[],c=!!this.bindings[Ts.PRESENCE]&&this.bindings[Ts.PRESENCE].length>0||((n=this.params.config.presence)===null||n===void 0?void 0:n.enabled)===!0,u={},f={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:h,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(d=>t?.(Vt.CHANNEL_ERROR,d)),this._onClose(()=>t?.(Vt.CLOSED)),this.updateJoinPayload(Object.assign({config:f},u)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:d})=>{var p;if(this.socket._isManualToken()||this.socket.setAuth(),d===void 0){t?.(Vt.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,g=(p=m?.length)!==null&&p!==void 0?p:0,y=[];for(let x=0;x<g;x++){const b=m[x],{filter:{event:_,schema:w,table:v,filter:S}}=b,T=d&&d[x];if(T&&T.event===_&&We.isFilterValueEqual(T.schema,w)&&We.isFilterValueEqual(T.table,v)&&We.isFilterValueEqual(T.filter,S))y.push(Object.assign(Object.assign({},b),{id:T.id}));else{this.unsubscribe(),this.state=lt.errored,t?.(Vt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,t&&t(Vt.SUBSCRIBED);return}}).receive("error",d=>{this.state=lt.errored,t?.(Vt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{t?.(Vt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,r){return this.state===lt.joined&&t===Ts.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,e,r)}async httpSend(t,e,r={}){var i;if(e==null)return Promise.reject("Payload is required for httpSend()");const n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const h=await a.json();l=h.error||h.message||l}catch{}return Promise.reject(new Error(l))}async send(t,e={}){var r,i;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:n,payload:o}=t,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=h.body)===null||i===void 0?void 0:i.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,l;const h=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),h.receive("ok",()=>n("ok")),h.receive("error",()=>n("error")),h.receive("timeout",()=>n("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=lt.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Mt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new gi(this,Mt.leave,{},t),r.receive("ok",()=>{e(),i("ok")}).receive("timeout",()=>{e(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=lt.closed,this.bindings={}}async _fetchWithTimeout(t,e,r){const i=new AbortController,n=setTimeout(()=>i.abort(),r),o=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(n),o}_push(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new gi(this,t,e,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>gg){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,r){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,r){var i,n;const o=t.toLocaleLowerCase(),{close:a,error:l,leave:h,join:c}=Mt;if(r&&[a,l,h,c].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,e,r);if(e&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(d=>{var p,m,g;return((p=d.filter)===null||p===void 0?void 0:p.event)==="*"||((g=(m=d.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(d=>d.callback(f,r)):(n=this.bindings[o])===null||n===void 0||n.filter(d=>{var p,m,g,y,x,b;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in d){const _=d.id,w=(p=d.filter)===null||p===void 0?void 0:p.event;return _&&((m=e.ids)===null||m===void 0?void 0:m.includes(_))&&(w==="*"||w?.toLocaleLowerCase()===((g=e.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const _=(x=(y=d?.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return _==="*"||_===((b=e?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return d.type.toLocaleLowerCase()===o}).map(d=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:m,table:g,commit_timestamp:y,type:x,errors:b}=p;f=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:y,eventType:x,new:{},old:{},errors:b}),this._getPayloadRecords(p))}d.callback(f,r)})}_isClosed(){return this.state===lt.closed}_isJoined(){return this.state===lt.joined}_isJoining(){return this.state===lt.joining}_isLeaving(){return this.state===lt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,r){const i=t.toLocaleLowerCase(),n={type:i,filter:e,callback:r};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(t,e){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&We.isEqual(i.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}static isFilterValueEqual(t,e){return(t??void 0)===(e??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Mt.close,{},t)}_onError(t){this._on(Mt.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=lt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=Qo(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=Qo(t.columns,t.old_record)),e}}const mi=()=>{},ar={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Sg=[1e3,2e3,5e3,1e4],Ag=1e4,Tg=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class kg{constructor(t,e){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ki,this.transport=null,this.heartbeatIntervalMs=ar.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=mi,this.ref=0,this.reconnectTimer=null,this.vsn=Zo,this.logger=mi,this.conn=null,this.sendBuffer=[],this.serializer=new mg,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),!(!((r=e?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${Ji.websocket}`,this.httpEndpoint=hh(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=cg.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,e??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,r){this.logger(t,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ee.connecting:return ve.Connecting;case ee.open:return ve.Open;case ee.closing:return ve.Closing;default:return ve.Closed}}isConnected(){return this.connectionState()===ve.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){const r=`realtime:${t}`,i=this.getChannels().find(n=>n.topic===r);if(i)return i;{const n=new We(`realtime:${t}`,e,this);return this.channels.push(n),n}}push(t){const{topic:e,event:r,payload:i,ref:n}=t,o=()=>{this.encode(t,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${r} (${n})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(pg,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},ar.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply"&&e.ref&&e.ref===this.pendingHeartbeatRef){const h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error",h)}catch(c){this.log("error","error in heartbeat callback",c)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:r,event:i,payload:n,ref:o}=e,a=o?`(${o})`:"",l=n.status||"";this.log("receive",`${l} ${r} ${i} ${a}`.trim(),n),this.channels.filter(h=>h._isMember(r)).forEach(h=>h._trigger(i,n,o)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===ee.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ee.open||this.conn.readyState===ee.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(Mt.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const r=t.match(/\?/)?"&":"?",i=new URLSearchParams(e);return`${t}${r}${i}`}_workerObjectUrl(t){let e;if(t)e=t;else{const r=new Blob([Tg],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}async _performAuth(t=null){let e,r=!1;if(t)e=t,r=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),e=this.accessTokenValue}else e=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(i=>{const n={access_token:e,version:dg};e&&i.updateJoinPayload(n),i.joinedOnce&&i._isJoined()&&i._push(Mt.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(e=>{this.log("error",`Error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(e)}catch(i){this.log("error",`error in ${t} callback`,i)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new ah(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ar.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var e,r,i,n,o,a,l,h,c,u,f,d;switch(this.transport=(e=t?.transport)!==null&&e!==void 0?e:null,this.timeout=(r=t?.timeout)!==null&&r!==void 0?r:Ki,this.heartbeatIntervalMs=(i=t?.heartbeatIntervalMs)!==null&&i!==void 0?i:ar.HEARTBEAT_INTERVAL,this.worker=(n=t?.worker)!==null&&n!==void 0?n:!1,this.accessToken=(o=t?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=t?.heartbeatCallback)!==null&&a!==void 0?a:mi,this.vsn=(l=t?.vsn)!==null&&l!==void 0?l:Zo,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=t?.reconnectAfterMs)!==null&&h!==void 0?h:(p=>Sg[p-1]||Ag),this.vsn){case fg:this.encode=(c=t?.encode)!==null&&c!==void 0?c:((p,m)=>m(JSON.stringify(p))),this.decode=(u=t?.decode)!==null&&u!==void 0?u:((p,m)=>m(JSON.parse(p)));break;case oh:this.encode=(f=t?.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(d=t?.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var Os=class extends Error{constructor(s,t){super(s),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Cg(s,t,e){const r=new URL(t,s);if(e)for(const[i,n]of Object.entries(e))n!==void 0&&r.searchParams.set(i,n);return r.toString()}async function Eg(s){return!s||s.type==="none"?{}:s.type==="bearer"?{Authorization:`Bearer ${s.token}`}:s.type==="header"?{[s.name]:s.value}:s.type==="custom"?await s.getHeaders():{}}function Pg(s){const t=s.fetchImpl??globalThis.fetch;return{async request({method:e,path:r,query:i,body:n,headers:o}){const a=Cg(s.baseUrl,r,i),l=await Eg(s.auth),h=await t(a,{method:e,headers:{...n?{"Content-Type":"application/json"}:{},...l,...o},body:n?JSON.stringify(n):void 0}),c=await h.text(),u=(h.headers.get("content-type")||"").includes("application/json"),f=u&&c?JSON.parse(c):c;if(!h.ok){const d=u?f:void 0,p=d?.error;throw new Os(p?.message??`Request failed with status ${h.status}`,{status:h.status,icebergType:p?.type,icebergCode:p?.code,details:d})}return{status:h.status,headers:h.headers,data:f}}}}function lr(s){return s.join("")}var Rg=class{constructor(s,t=""){this.client=s,this.prefix=t}async listNamespaces(s){const t=s?{parent:lr(s.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(s,t){const e={namespace:s.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:e})).data}async dropNamespace(s){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${lr(s.namespace)}`})}async loadNamespaceMetadata(s){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${lr(s.namespace)}`})).data.properties}}async namespaceExists(s){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${lr(s.namespace)}`}),!0}catch(t){if(t instanceof Os&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(s,t){try{return await this.createNamespace(s,t)}catch(e){if(e instanceof Os&&e.status===409)return;throw e}}};function Re(s){return s.join("")}var Mg=class{constructor(s,t="",e){this.client=s,this.prefix=t,this.accessDelegation=e}async listTables(s){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables`})).data.identifiers}async createTable(s,t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables`,body:t,headers:e})).data.metadata}async updateTable(s,t){const e=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,body:t});return{"metadata-location":e.data["metadata-location"],metadata:e.data.metadata}}async dropTable(s,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(s){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,headers:t})).data.metadata}async tableExists(s){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,headers:t}),!0}catch(e){if(e instanceof Os&&e.status===404)return!1;throw e}}async createTableIfNotExists(s,t){try{return await this.createTable(s,t)}catch(e){if(e instanceof Os&&e.status===409)return await this.loadTable({namespace:s.namespace,name:t.name});throw e}}},Ig=class{constructor(s){let t="v1";s.catalogName&&(t+=`/${s.catalogName}`);const e=s.baseUrl.endsWith("/")?s.baseUrl:`${s.baseUrl}/`;this.client=Pg({baseUrl:e,auth:s.auth,fetchImpl:s.fetch}),this.accessDelegation=s.accessDelegation?.join(","),this.namespaceOps=new Rg(this.client,t),this.tableOps=new Mg(this.client,t,this.accessDelegation)}async listNamespaces(s){return this.namespaceOps.listNamespaces(s)}async createNamespace(s,t){return this.namespaceOps.createNamespace(s,t)}async dropNamespace(s){await this.namespaceOps.dropNamespace(s)}async loadNamespaceMetadata(s){return this.namespaceOps.loadNamespaceMetadata(s)}async listTables(s){return this.tableOps.listTables(s)}async createTable(s,t){return this.tableOps.createTable(s,t)}async updateTable(s,t){return this.tableOps.updateTable(s,t)}async dropTable(s,t){await this.tableOps.dropTable(s,t)}async loadTable(s){return this.tableOps.loadTable(s)}async namespaceExists(s){return this.namespaceOps.namespaceExists(s)}async tableExists(s){return this.tableOps.tableExists(s)}async createNamespaceIfNotExists(s,t){return this.namespaceOps.createNamespaceIfNotExists(s,t)}async createTableIfNotExists(s,t){return this.tableOps.createTableIfNotExists(s,t)}},Lr=class extends Error{constructor(s,t="storage",e,r){super(s),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=e,this.statusCode=r}};function Br(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}var hr=class extends Lr{constructor(s,t,e,r="storage"){super(s,r,t,e),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=e}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ch=class extends Lr{constructor(s,t,e="storage"){super(s,e),this.name=e==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const Og=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),Lg=s=>{if(typeof s!="object"||s===null)return!1;const t=Object.getPrototypeOf(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},Qi=s=>{if(Array.isArray(s))return s.map(e=>Qi(e));if(typeof s=="function"||s!==Object(s))return s;const t={};return Object.entries(s).forEach(([e,r])=>{const i=e.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));t[i]=Qi(r)}),t},Bg=s=>!s||typeof s!="string"||s.length===0||s.length>100||s.trim()!==s||s.includes("/")||s.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(s);function Ls(s){"@babel/helpers - typeof";return Ls=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ls(s)}function Dg(s,t){if(Ls(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var r=e.call(s,t);if(Ls(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function $g(s){var t=Dg(s,"string");return Ls(t)=="symbol"?t:t+""}function Ug(s,t,e){return(t=$g(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function sa(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),e.push.apply(e,r)}return e}function L(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?sa(Object(e),!0).forEach(function(r){Ug(s,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):sa(Object(e)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(e,r))})}return s}const ra=s=>{var t;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(t=s.error)===null||t===void 0?void 0:t.message)||JSON.stringify(s)},Fg=async(s,t,e,r)=>{if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!e?.noResolveJson){const i=s,n=i.status||500;if(typeof i.json=="function")i.json().then(o=>{const a=o?.statusCode||o?.code||n+"";t(new hr(ra(o),n,a,r))}).catch(()=>{if(r==="vectors"){const o=n+"";t(new hr(i.statusText||`HTTP ${n} error`,n,o,r))}else{const o=n+"";t(new hr(i.statusText||`HTTP ${n} error`,n,o,r))}});else{const o=n+"";t(new hr(i.statusText||`HTTP ${n} error`,n,o,r))}}else t(new ch(ra(s),s,r))},jg=(s,t,e,r)=>{const i={method:s,headers:t?.headers||{}};return s==="GET"||s==="HEAD"||!r?L(L({},i),e):(Lg(r)?(i.headers=L({"Content-Type":"application/json"},t?.headers),i.body=JSON.stringify(r)):i.body=r,t?.duplex&&(i.duplex=t.duplex),L(L({},i),e))};async function fs(s,t,e,r,i,n,o){return new Promise((a,l)=>{s(e,jg(t,r,i,n)).then(h=>{if(!h.ok)throw h;if(r?.noResolveJson)return h;if(o==="vectors"){const c=h.headers.get("content-type");if(h.headers.get("content-length")==="0"||h.status===204)return{};if(!c||!c.includes("application/json"))return{}}return h.json()}).then(h=>a(h)).catch(h=>Fg(h,l,r,o))})}function uh(s="storage"){return{get:async(t,e,r,i)=>fs(t,"GET",e,r,i,void 0,s),post:async(t,e,r,i,n)=>fs(t,"POST",e,i,n,r,s),put:async(t,e,r,i,n)=>fs(t,"PUT",e,i,n,r,s),head:async(t,e,r,i)=>fs(t,"HEAD",e,L(L({},r),{},{noResolveJson:!0}),i,void 0,s),remove:async(t,e,r,i,n)=>fs(t,"DELETE",e,i,n,r,s)}}const Ng=uh("storage"),{get:Bs,post:Rt,put:tn,head:Gg,remove:kn}=Ng,St=uh("vectors");var is=class{constructor(s,t={},e,r="storage"){this.shouldThrowOnError=!1,this.url=s,this.headers=t,this.fetch=Og(e),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,t){return this.headers=L(L({},this.headers),{},{[s]:t}),this}async handleOperation(s){var t=this;try{return{data:await s(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Br(e))return{data:null,error:e};throw e}}},Wg=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t}then(s,t){return this.execute().then(s,t)}async execute(){var s=this;try{return{data:(await s.downloadFn()).body,error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(Br(t))return{data:null,error:t};throw t}}};let dh;dh=Symbol.toStringTag;var zg=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t,this[dh]="BlobDownloadBuilder",this.promise=null}asStream(){return new Wg(this.downloadFn,this.shouldThrowOnError)}then(s,t){return this.getPromise().then(s,t)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var s=this;try{return{data:await(await s.downloadFn()).blob(),error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(Br(t))return{data:null,error:t};throw t}}};const Hg={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ia={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Vg=class extends is{constructor(s,t={},e,r){super(s,t,r,"storage"),this.bucketId=e}async uploadOrUpdate(s,t,e,r){var i=this;return i.handleOperation(async()=>{let n;const o=L(L({},ia),r);let a=L(L({},i.headers),s==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&e instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),l&&n.append("metadata",i.encodeMetadata(l)),n.append("",e)):typeof FormData<"u"&&e instanceof FormData?(n=e,n.has("cacheControl")||n.append("cacheControl",o.cacheControl),l&&!n.has("metadata")&&n.append("metadata",i.encodeMetadata(l))):(n=e,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=i.toBase64(i.encodeMetadata(l))),(typeof ReadableStream<"u"&&n instanceof ReadableStream||n&&typeof n=="object"&&"pipe"in n&&typeof n.pipe=="function")&&!o.duplex&&(o.duplex="half")),r?.headers&&(a=L(L({},a),r.headers));const h=i._removeEmptyFolders(t),c=i._getFinalPath(h),u=await(s=="PUT"?tn:Rt)(i.fetch,`${i.url}/object/${c}`,n,L({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{path:h,id:u.Id,fullPath:u.Key}})}async upload(s,t,e){return this.uploadOrUpdate("POST",s,t,e)}async uploadToSignedUrl(s,t,e,r){var i=this;const n=i._removeEmptyFolders(s),o=i._getFinalPath(n),a=new URL(i.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",t),i.handleOperation(async()=>{let l;const h=L({upsert:ia.upsert},r),c=L(L({},i.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&e instanceof Blob?(l=new FormData,l.append("cacheControl",h.cacheControl),l.append("",e)):typeof FormData<"u"&&e instanceof FormData?(l=e,l.append("cacheControl",h.cacheControl)):(l=e,c["cache-control"]=`max-age=${h.cacheControl}`,c["content-type"]=h.contentType),{path:n,fullPath:(await tn(i.fetch,a.toString(),l,{headers:c})).Key}})}async createSignedUploadUrl(s,t){var e=this;return e.handleOperation(async()=>{let r=e._getFinalPath(s);const i=L({},e.headers);t?.upsert&&(i["x-upsert"]="true");const n=await Rt(e.fetch,`${e.url}/object/upload/sign/${r}`,{},{headers:i}),o=new URL(e.url+n.url),a=o.searchParams.get("token");if(!a)throw new Lr("No token returned by API");return{signedUrl:o.toString(),path:s,token:a}})}async update(s,t,e){return this.uploadOrUpdate("PUT",s,t,e)}async move(s,t,e){var r=this;return r.handleOperation(async()=>await Rt(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:s,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:r.headers}))}async copy(s,t,e){var r=this;return r.handleOperation(async()=>({path:(await Rt(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:s,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(s,t,e){var r=this;return r.handleOperation(async()=>{let i=r._getFinalPath(s),n=await Rt(r.fetch,`${r.url}/object/sign/${i}`,L({expiresIn:t},e?.transform?{transform:e.transform}:{}),{headers:r.headers});const o=e?.download?`&download=${e.download===!0?"":e.download}`:"";return{signedUrl:encodeURI(`${r.url}${n.signedURL}${o}`)}})}async createSignedUrls(s,t,e){var r=this;return r.handleOperation(async()=>{const i=await Rt(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:t,paths:s},{headers:r.headers}),n=e?.download?`&download=${e.download===!0?"":e.download}`:"";return i.map(o=>L(L({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${n}`):null}))})}download(s,t,e){const r=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),n=i?`?${i}`:"",o=this._getFinalPath(s),a=()=>Bs(this.fetch,`${this.url}/${r}/${o}${n}`,{headers:this.headers,noResolveJson:!0},e);return new zg(a,this.shouldThrowOnError)}async info(s){var t=this;const e=t._getFinalPath(s);return t.handleOperation(async()=>Qi(await Bs(t.fetch,`${t.url}/object/info/${e}`,{headers:t.headers})))}async exists(s){var t=this;const e=t._getFinalPath(s);try{return await Gg(t.fetch,`${t.url}/object/${e}`,{headers:t.headers}),{data:!0,error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Br(r)&&r instanceof ch){const i=r.originalError;if([400,404].includes(i?.status))return{data:!1,error:r}}throw r}}getPublicUrl(s,t){const e=this._getFinalPath(s),r=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const n=typeof t?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(t?.transform||{});o!==""&&r.push(o);let a=r.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${e}${a}`)}}}async remove(s){var t=this;return t.handleOperation(async()=>await kn(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:s},{headers:t.headers}))}async list(s,t,e){var r=this;return r.handleOperation(async()=>{const i=L(L(L({},Hg),t),{},{prefix:s||""});return await Rt(r.fetch,`${r.url}/object/list/${r.bucketId}`,i,{headers:r.headers},e)})}async listV2(s,t){var e=this;return e.handleOperation(async()=>{const r=L({},s);return await Rt(e.fetch,`${e.url}/object/list-v2/${e.bucketId}`,r,{headers:e.headers},t)})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const t=[];return s.width&&t.push(`width=${s.width}`),s.height&&t.push(`height=${s.height}`),s.resize&&t.push(`resize=${s.resize}`),s.format&&t.push(`format=${s.format}`),s.quality&&t.push(`quality=${s.quality}`),t.join("&")}};const qg="2.97.0",Ns={"X-Client-Info":`storage-js/${qg}`};var Yg=class extends is{constructor(s,t={},e,r){const i=new URL(s);r?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const n=i.href.replace(/\/$/,""),o=L(L({},Ns),t);super(n,o,e,"storage")}async listBuckets(s){var t=this;return t.handleOperation(async()=>{const e=t.listBucketOptionsToQueryString(s);return await Bs(t.fetch,`${t.url}/bucket${e}`,{headers:t.headers})})}async getBucket(s){var t=this;return t.handleOperation(async()=>await Bs(t.fetch,`${t.url}/bucket/${s}`,{headers:t.headers}))}async createBucket(s,t={public:!1}){var e=this;return e.handleOperation(async()=>await Rt(e.fetch,`${e.url}/bucket`,{id:s,name:s,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async updateBucket(s,t){var e=this;return e.handleOperation(async()=>await tn(e.fetch,`${e.url}/bucket/${s}`,{id:s,name:s,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async emptyBucket(s){var t=this;return t.handleOperation(async()=>await Rt(t.fetch,`${t.url}/bucket/${s}/empty`,{},{headers:t.headers}))}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await kn(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(s){const t={};return s&&("limit"in s&&(t.limit=String(s.limit)),"offset"in s&&(t.offset=String(s.offset)),s.search&&(t.search=s.search),s.sortColumn&&(t.sortColumn=s.sortColumn),s.sortOrder&&(t.sortOrder=s.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},Xg=class extends is{constructor(s,t={},e){const r=s.replace(/\/$/,""),i=L(L({},Ns),t);super(r,i,e,"storage")}async createBucket(s){var t=this;return t.handleOperation(async()=>await Rt(t.fetch,`${t.url}/bucket`,{name:s},{headers:t.headers}))}async listBuckets(s){var t=this;return t.handleOperation(async()=>{const e=new URLSearchParams;s?.limit!==void 0&&e.set("limit",s.limit.toString()),s?.offset!==void 0&&e.set("offset",s.offset.toString()),s?.sortColumn&&e.set("sortColumn",s.sortColumn),s?.sortOrder&&e.set("sortOrder",s.sortOrder),s?.search&&e.set("search",s.search);const r=e.toString(),i=r?`${t.url}/bucket?${r}`:`${t.url}/bucket`;return await Bs(t.fetch,i,{headers:t.headers})})}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await kn(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}))}from(s){var t=this;if(!Bg(s))throw new Lr("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const e=new Ig({baseUrl:this.url,catalogName:s,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(e,{get(i,n){const o=i[n];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(i,a),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}},Kg=class extends is{constructor(s,t={},e){const r=s.replace(/\/$/,""),i=L(L({},Ns),{},{"Content-Type":"application/json"},t);super(r,i,e,"vectors")}async createIndex(s){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/CreateIndex`,s,{headers:t.headers})||{})}async getIndex(s,t){var e=this;return e.handleOperation(async()=>await St.post(e.fetch,`${e.url}/GetIndex`,{vectorBucketName:s,indexName:t},{headers:e.headers}))}async listIndexes(s){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/ListIndexes`,s,{headers:t.headers}))}async deleteIndex(s,t){var e=this;return e.handleOperation(async()=>await St.post(e.fetch,`${e.url}/DeleteIndex`,{vectorBucketName:s,indexName:t},{headers:e.headers})||{})}},Jg=class extends is{constructor(s,t={},e){const r=s.replace(/\/$/,""),i=L(L({},Ns),{},{"Content-Type":"application/json"},t);super(r,i,e,"vectors")}async putVectors(s){var t=this;if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/PutVectors`,s,{headers:t.headers})||{})}async getVectors(s){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/GetVectors`,s,{headers:t.headers}))}async listVectors(s){var t=this;if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/ListVectors`,s,{headers:t.headers}))}async queryVectors(s){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/QueryVectors`,s,{headers:t.headers}))}async deleteVectors(s){var t=this;if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/DeleteVectors`,s,{headers:t.headers})||{})}},Zg=class extends is{constructor(s,t={},e){const r=s.replace(/\/$/,""),i=L(L({},Ns),{},{"Content-Type":"application/json"},t);super(r,i,e,"vectors")}async createBucket(s){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{})}async getBucket(s){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:s},{headers:t.headers}))}async listBuckets(s={}){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/ListVectorBuckets`,s,{headers:t.headers}))}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await St.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{})}},Qg=class extends Zg{constructor(s,t={}){super(s,t.headers||{},t.fetch)}from(s){return new tm(this.url,this.headers,s,this.fetch)}async createBucket(s){var t=()=>super.createBucket,e=this;return t().call(e,s)}async getBucket(s){var t=()=>super.getBucket,e=this;return t().call(e,s)}async listBuckets(s={}){var t=()=>super.listBuckets,e=this;return t().call(e,s)}async deleteBucket(s){var t=()=>super.deleteBucket,e=this;return t().call(e,s)}},tm=class extends Kg{constructor(s,t,e,r){super(s,t,r),this.vectorBucketName=e}async createIndex(s){var t=()=>super.createIndex,e=this;return t().call(e,L(L({},s),{},{vectorBucketName:e.vectorBucketName}))}async listIndexes(s={}){var t=()=>super.listIndexes,e=this;return t().call(e,L(L({},s),{},{vectorBucketName:e.vectorBucketName}))}async getIndex(s){var t=()=>super.getIndex,e=this;return t().call(e,e.vectorBucketName,s)}async deleteIndex(s){var t=()=>super.deleteIndex,e=this;return t().call(e,e.vectorBucketName,s)}index(s){return new em(this.url,this.headers,this.vectorBucketName,s,this.fetch)}},em=class extends Jg{constructor(s,t,e,r,i){super(s,t,i),this.vectorBucketName=e,this.indexName=r}async putVectors(s){var t=()=>super.putVectors,e=this;return t().call(e,L(L({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async getVectors(s){var t=()=>super.getVectors,e=this;return t().call(e,L(L({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async listVectors(s={}){var t=()=>super.listVectors,e=this;return t().call(e,L(L({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async queryVectors(s){var t=()=>super.queryVectors,e=this;return t().call(e,L(L({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async deleteVectors(s){var t=()=>super.deleteVectors,e=this;return t().call(e,L(L({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}},sm=class extends Yg{constructor(s,t={},e,r){super(s,t,e,r)}from(s){return new Vg(this.url,this.headers,s,this.fetch)}get vectors(){return new Qg(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Xg(this.url+"/iceberg",this.headers,this.fetch)}};const fh="2.97.0",Fe=30*1e3,en=3,yi=en*Fe,rm="http://localhost:9999",im="supabase.auth.token",nm={"X-Client-Info":`gotrue-js/${fh}`},sn="X-Supabase-Api-Version",ph={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},om=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,am=600*1e3;class Ds extends Error{constructor(t,e,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}}function O(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class lm extends Ds{constructor(t,e,r){super(t,e,r),this.name="AuthApiError",this.status=e,this.code=r}}function hm(s){return O(s)&&s.name==="AuthApiError"}class Se extends Ds{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Zt extends Ds{constructor(t,e,r,i){super(t,r,i),this.name=e,this.status=r}}class vt extends Zt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function _i(s){return O(s)&&s.name==="AuthSessionMissingError"}class Me extends Zt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class cr extends Zt{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class ur extends Zt{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function cm(s){return O(s)&&s.name==="AuthImplicitGrantRedirectError"}class na extends Zt{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class um extends Zt{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class rn extends Zt{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function bi(s){return O(s)&&s.name==="AuthRetryableFetchError"}class oa extends Zt{constructor(t,e,r){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}}class nn extends Zt{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),aa=` 	
\r=`.split(""),dm=(()=>{const s=new Array(128);for(let t=0;t<s.length;t+=1)s[t]=-1;for(let t=0;t<aa.length;t+=1)s[aa[t].charCodeAt(0)]=-2;for(let t=0;t<Ar.length;t+=1)s[Ar[t].charCodeAt(0)]=t;return s})();function la(s,t,e){if(s!==null)for(t.queue=t.queue<<8|s,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;e(Ar[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;e(Ar[r]),t.queuedBits-=6}}function gh(s,t,e){const r=dm[s];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function ha(s){const t=[],e=o=>{t.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=o=>{gm(o,r,e)};for(let o=0;o<s.length;o+=1)gh(s.charCodeAt(o),i,n);return t.join("")}function fm(s,t){if(s<=127){t(s);return}else if(s<=2047){t(192|s>>6),t(128|s&63);return}else if(s<=65535){t(224|s>>12),t(128|s>>6&63),t(128|s&63);return}else if(s<=1114111){t(240|s>>18),t(128|s>>12&63),t(128|s>>6&63),t(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function pm(s,t){for(let e=0;e<s.length;e+=1){let r=s.charCodeAt(e);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(s.charCodeAt(e+1)-56320&65535|i)+65536,e+=1}fm(r,t)}}function gm(s,t,e){if(t.utf8seq===0){if(s<=127){e(s);return}for(let r=1;r<6;r+=1)if((s>>7-r&1)===0){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=s&31;else if(t.utf8seq===3)t.codepoint=s&15;else if(t.utf8seq===4)t.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|s&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function qe(s){const t=[],e={queue:0,queuedBits:0},r=i=>{t.push(i)};for(let i=0;i<s.length;i+=1)gh(s.charCodeAt(i),e,r);return new Uint8Array(t)}function mm(s){const t=[];return pm(s,e=>t.push(e)),new Uint8Array(t)}function Te(s){const t=[],e={queue:0,queuedBits:0},r=i=>{t.push(i)};return s.forEach(i=>la(i,e,r)),la(null,e,r),t.join("")}function ym(s){return Math.round(Date.now()/1e3)+s}function _m(){return Symbol("auth-callback")}const pt=()=>typeof window<"u"&&typeof document<"u",de={tested:!1,writable:!1},mh=()=>{if(!pt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(de.tested)return de.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),de.tested=!0,de.writable=!0}catch{de.tested=!0,de.writable=!1}return de.writable};function bm(s){const t={},e=new URL(s);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((i,n)=>{t[n]=i})}catch{}return e.searchParams.forEach((r,i)=>{t[i]=r}),t}const yh=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),xm=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",je=async(s,t,e)=>{await s.setItem(t,JSON.stringify(e))},fe=async(s,t)=>{const e=await s.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}},ft=async(s,t)=>{await s.removeItem(t)};class Dr{constructor(){this.promise=new Dr.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}Dr.promiseConstructor=Promise;function dr(s){const t=s.split(".");if(t.length!==3)throw new nn("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!om.test(t[r]))throw new nn("JWT not in base64url format");return{header:JSON.parse(ha(t[0])),payload:JSON.parse(ha(t[1])),signature:qe(t[2]),raw:{header:t[0],payload:t[1]}}}async function wm(s){return await new Promise(t=>{setTimeout(()=>t(null),s)})}function vm(s,t){return new Promise((r,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await s(n);if(!t(n,null,o)){r(o);return}}catch(o){if(!t(n,o)){i(o);return}}})()})}function Sm(s){return("0"+s.toString(16)).substr(-2)}function Am(){const t=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length;let i="";for(let n=0;n<56;n++)i+=e.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(t),Array.from(t,Sm).join("")}async function Tm(s){const e=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",e),i=new Uint8Array(r);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function km(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const e=await Tm(s);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ie(s,t,e=!1){const r=Am();let i=r;e&&(i+="/PASSWORD_RECOVERY"),await je(s,`${t}-code-verifier`,i);const n=await km(r);return[n,r===n?"plain":"s256"]}const Cm=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Em(s){const t=s.headers.get(sn);if(!t||!t.match(Cm))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Pm(s){if(!s)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(s<=t)throw new Error("JWT has expired")}function Rm(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Mm=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Oe(s){if(!Mm.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function xi(){const s={};return new Proxy(s,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){const r=e.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Im(s,t){return new Proxy(s,{get:(e,r,i)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)"||n==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(e,r,i)}return!t.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,r,i)}})}function ca(s){return JSON.parse(JSON.stringify(s))}const we=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Om=[502,503,504];async function ua(s){var t;if(!xm(s))throw new rn(we(s),0);if(Om.includes(s.status))throw new rn(we(s),s.status);let e;try{e=await s.json()}catch(n){throw new Se(we(n),n)}let r;const i=Em(s);if(i&&i.getTime()>=ph["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new oa(we(e),s.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new vt}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new oa(we(e),s.status,e.weak_password.reasons);throw new lm(we(e),s.status||500,r)}const Lm=(s,t,e,r)=>{const i={method:s,headers:t?.headers||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),e))};async function B(s,t,e,r){var i;const n=Object.assign({},r?.headers);n[sn]||(n[sn]=ph["2024-01-01"].name),r?.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const o=(i=r?.query)!==null&&i!==void 0?i:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Bm(s,t,e+a,{headers:n,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function Bm(s,t,e,r,i,n){const o=Lm(t,r,i,n);let a;try{a=await s(e,Object.assign({},o))}catch(l){throw console.error(l),new rn(we(l),0)}if(a.ok||await ua(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await ua(l)}}function Pt(s){var t;let e=null;Um(s)&&(e=Object.assign({},s),s.expires_at||(e.expires_at=ym(s.expires_in)));const r=(t=s.user)!==null&&t!==void 0?t:s;return{data:{session:e,user:r},error:null}}function da(s){const t=Pt(s);return!t.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(t.data.weak_password=s.weak_password),t}function se(s){var t;return{data:{user:(t=s.user)!==null&&t!==void 0?t:s},error:null}}function Dm(s){return{data:s,error:null}}function $m(s){const{action_link:t,email_otp:e,hashed_token:r,redirect_to:i,verification_type:n}=s,o=Or(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:r,redirect_to:i,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function fa(s){return s}function Um(s){return s.access_token&&s.refresh_token&&s.expires_in}const wi=["global","local","others"];class Fm{constructor({url:t="",headers:e={},fetch:r}){this.url=t,this.headers=e,this.fetch=yh(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,e=wi[0]){if(wi.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${wi.join(", ")}`);try{return await B(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(O(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,e={}){try{return await B(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:se})}catch(r){if(O(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:e}=t,r=Or(t,["options"]),i=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(i.new_email=r?.newEmail,delete i.newEmail),await B(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:$m,redirectTo:e?.redirectTo})}catch(e){if(O(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await B(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:se})}catch(e){if(O(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,r,i,n,o,a,l;try{const h={nextPage:null,lastPage:0,total:0},c=await B(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(n=(i=t?.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:fa});if(c.error)throw c.error;const u=await c.json(),f=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,d=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return d.length>0&&(d.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(p.split(";")[1].split("=")[1]);h[`${g}Page`]=m}),h.total=parseInt(f)),{data:Object.assign(Object.assign({},u),h),error:null}}catch(h){if(O(h))return{data:{users:[]},error:h};throw h}}async getUserById(t){Oe(t);try{return await B(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:se})}catch(e){if(O(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){Oe(t);try{return await B(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:se})}catch(r){if(O(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,e=!1){Oe(t);try{return await B(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:se})}catch(r){if(O(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){Oe(t.userId);try{const{data:e,error:r}=await B(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:e,error:r}}catch(e){if(O(e))return{data:null,error:e};throw e}}async _deleteFactor(t){Oe(t.userId),Oe(t.id);try{return{data:await B(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(O(e))return{data:null,error:e};throw e}}async _listOAuthClients(t){var e,r,i,n,o,a,l;try{const h={nextPage:null,lastPage:0,total:0},c=await B(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(n=(i=t?.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:fa});if(c.error)throw c.error;const u=await c.json(),f=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,d=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return d.length>0&&(d.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(p.split(";")[1].split("=")[1]);h[`${g}Page`]=m}),h.total=parseInt(f)),{data:Object.assign(Object.assign({},u),h),error:null}}catch(h){if(O(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(t){try{return await B(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(O(e))return{data:null,error:e};throw e}}async _getOAuthClient(t){try{return await B(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(O(e))return{data:null,error:e};throw e}}async _updateOAuthClient(t,e){try{return await B(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(O(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await B(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(O(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(t){try{return await B(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(O(e))return{data:null,error:e};throw e}}}function pa(s={}){return{getItem:t=>s[t]||null,setItem:(t,e)=>{s[t]=e},removeItem:t=>{delete s[t]}}}const Le={debug:!!(globalThis&&mh()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class _h extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class ga extends _h{}async function jm(s,t,e){Le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,t);const r=new globalThis.AbortController;t>0&&setTimeout(()=>{r.abort(),Le.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},t),await Promise.resolve();try{return await globalThis.navigator.locks.request(s,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return await e()}finally{Le.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}}else{if(t===0)throw Le.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new ga(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Le.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}})}catch(i){throw i?.name==="AbortError"?new ga(`Acquiring an exclusive Navigator LockManager lock "${s}" timed out waiting ${t}ms`):i}}function Nm(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function bh(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function Gm(s){return parseInt(s,16)}function Wm(s){const t=new TextEncoder().encode(s);return"0x"+Array.from(t,r=>r.toString(16).padStart(2,"0")).join("")}function zm(s){var t;const{chainId:e,domain:r,expirationTime:i,issuedAt:n=new Date,nonce:o,notBefore:a,requestId:l,resources:h,scheme:c,uri:u,version:f}=s;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((t=s.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const d=bh(s.address),p=c?`${c}://${r}`:r,m=s.statement?`${s.statement}
`:"",g=`${p} wants you to sign in with your Ethereum account:
${d}

${m}`;let y=`URI: ${u}
Version: ${f}
Chain ID: ${e}${o?`
Nonce: ${o}`:""}
Issued At: ${n.toISOString()}`;if(i&&(y+=`
Expiration Time: ${i.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),l&&(y+=`
Request ID: ${l}`),h){let x=`
Resources:`;for(const b of h){if(!b||typeof b!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);x+=`
- ${b}`}y+=x}return`${g}
${y}`}class ot extends Error{constructor({message:t,code:e,cause:r,name:i}){var n;super(t,{cause:r}),this.__isWebAuthnError=!0,this.name=(n=i??(r instanceof Error?r.name:void 0))!==null&&n!==void 0?n:"Unknown Error",this.code=e}}class Tr extends ot{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function Hm({error:s,options:t}){var e,r,i;const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new ot({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((e=n.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new ot({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(t.mediation==="conditional"&&((r=n.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new ot({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((i=n.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new ot({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new ot({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new ot({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return n.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new ot({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new ot({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(xh(o)){if(n.rp.id!==o)return new ot({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new ot({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new ot({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new ot({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new ot({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function Vm({error:s,options:t}){const{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new ot({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new ot({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const r=window.location.hostname;if(xh(r)){if(e.rpId!==r)return new ot({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new ot({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new ot({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new ot({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class qm{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Ym=new qm;function Xm(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:t,user:e,excludeCredentials:r}=s,i=Or(s,["challenge","user","excludeCredentials"]),n=qe(t).buffer,o=Object.assign(Object.assign({},e),{id:qe(e.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:n,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const h=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},h),{id:qe(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return a}function Km(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:t,allowCredentials:e}=s,r=Or(s,["challenge","allowCredentials"]),i=qe(t).buffer,n=Object.assign(Object.assign({},r),{challenge:i});if(e&&e.length>0){n.allowCredentials=new Array(e.length);for(let o=0;o<e.length;o++){const a=e[o];n.allowCredentials[o]=Object.assign(Object.assign({},a),{id:qe(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return n}function Jm(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const e=s;return{id:s.id,rawId:s.id,response:{attestationObject:Te(new Uint8Array(s.response.attestationObject)),clientDataJSON:Te(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Zm(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const e=s,r=s.getClientExtensionResults(),i=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:Te(new Uint8Array(i.authenticatorData)),clientDataJSON:Te(new Uint8Array(i.clientDataJSON)),signature:Te(new Uint8Array(i.signature)),userHandle:i.userHandle?Te(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function xh(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function ma(){var s,t;return!!(pt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator?.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Qm(s){try{const t=await navigator.credentials.create(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Tr("Browser returned unexpected credential type",t)}:{data:null,error:new Tr("Empty credential response",t)}}catch(t){return{data:null,error:Hm({error:t,options:s})}}}async function ty(s){try{const t=await navigator.credentials.get(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Tr("Browser returned unexpected credential type",t)}:{data:null,error:new Tr("Empty credential response",t)}}catch(t){return{data:null,error:Vm({error:t,options:s})}}}const ey={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},sy={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function kr(...s){const t=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),e=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),r={};for(const i of s)if(i)for(const n in i){const o=i[n];if(o!==void 0)if(Array.isArray(o))r[n]=o;else if(e(o))r[n]=o;else if(t(o)){const a=r[n];t(a)?r[n]=kr(a,o):r[n]=kr(o)}else r[n]=o}return r}function ry(s,t){return kr(ey,s,t||{})}function iy(s,t){return kr(sy,s,t||{})}class ny{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:e,friendlyName:r,signal:i},n){var o;try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!a)return{data:null,error:l};const h=i??Ym.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:c}=a.webauthn.credential_options.publicKey;if(!c.name){const u=r;if(u)c.name=`${c.id}:${u}`;else{const d=(await this.client.getUser()).data.user,p=((o=d?.user_metadata)===null||o===void 0?void 0:o.name)||d?.email||d?.id||"User";c.name=`${c.id}:${p}`}}c.displayName||(c.displayName=c.name)}switch(a.webauthn.type){case"create":{const c=ry(a.webauthn.credential_options.publicKey,n?.create),{data:u,error:f}=await Qm({publicKey:c,signal:h});return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}case"request":{const c=iy(a.webauthn.credential_options.publicKey,n?.request),{data:u,error:f}=await ty(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:c,signal:h}));return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}}}catch(a){return O(a)?{data:null,error:a}:{data:null,error:new Se("Unexpected error in challenge",a)}}}async _verify({challengeId:t,factorId:e,webauthn:r}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:r})}async _authenticate({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!e)return{data:null,error:new Ds("rpId is required for WebAuthn authentication")};try{if(!ma())return{data:null,error:new Se("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:r},signal:i},{request:n});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:l.type,rpId:e,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return O(o)?{data:null,error:o}:{data:null,error:new Se("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!e)return{data:null,error:new Ds("rpId is required for WebAuthn registration")};try{if(!ma())return{data:null,error:new Se("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(c=>{var u;return(u=c.data)===null||u===void 0?void 0:u.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===t&&f.status!=="unverified")}).then(c=>c?this.client.mfa.unenroll({factorId:c?.id}):void 0),{data:null,error:a};const{data:l,error:h}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:e,rpOrigins:r},signal:i},{create:n});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:e,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:h}}catch(o){return O(o)?{data:null,error:o}:{data:null,error:new Se("Unexpected error in register",o)}}}}Nm();const oy={url:rm,storageKey:im,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:nm,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function ya(s,t,e){return await e()}const Be={};class $s{get jwks(){var t,e;return(e=(t=Be[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&e!==void 0?e:{keys:[]}}set jwks(t){Be[this.storageKey]=Object.assign(Object.assign({},Be[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return(e=(t=Be[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Be[this.storageKey]=Object.assign(Object.assign({},Be[this.storageKey]),{cachedAt:t})}constructor(t){var e,r,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const n=Object.assign(Object.assign({},oy),t);if(this.storageKey=n.storageKey,this.instanceID=(e=$s.nextInstanceID[this.storageKey])!==null&&e!==void 0?e:0,$s.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.instanceID>0&&pt()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Fm({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=yh(n.fetch),this.lock=n.lock||ya,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,this.lockAcquireTimeout=n.lockAcquireTimeout,n.lock?this.lock=n.lock:this.persistSession&&pt()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=jm:this.lock=ya,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ny(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:mh()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=pa(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=pa(this.memoryStorage)),pt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}n.skipAutoInitialize||this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${fh}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let e={},r="none";if(pt()&&(e=bm(window.location.href),this._isImplicitGrantCallback(e)?r="implicit":await this._isPKCECallback(e)&&(r="pkce")),pt()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:n}=await this._getSessionFromURL(e,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),cm(n)){const l=(t=n.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:n}}return{error:n}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return O(e)?this._returnResult({error:e}):this._returnResult({error:new Se("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,r,i;try{const n=await B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(e=t?.options)===null||e===void 0?void 0:e.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=t?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Pt}),{data:o,error:a}=n;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(n){if(O(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signUp(t){var e,r,i;try{let n;if("email"in t){const{email:c,password:u,options:f}=t;let d=null,p=null;this.flowType==="pkce"&&([d,p]=await Ie(this.storage,this.storageKey)),n=await B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:c,password:u,data:(e=f?.data)!==null&&e!==void 0?e:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:d,code_challenge_method:p},xform:Pt})}else if("phone"in t){const{phone:c,password:u,options:f}=t;n=await B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:u,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Pt})}else throw new cr("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return await ft(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(n){if(await ft(this.storage,`${this.storageKey}-code-verifier`),O(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithPassword(t){try{let e;if("email"in t){const{email:n,password:o,options:a}=t;e=await B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:da})}else if("phone"in t){const{phone:n,password:o,options:a}=t;e=await B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:da})}else throw new cr("You must provide either an email or phone number and a password");const{data:r,error:i}=e;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!r||!r.session||!r.user){const n=new Me;return this._returnResult({data:{user:null,session:null},error:n})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(e){if(O(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(t){var e,r,i,n;return await this._handleProviderSignIn(t.provider,{redirectTo:(e=t.options)===null||e===void 0?void 0:e.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=t.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=t.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,r,i,n,o,a,l,h,c,u,f;let d,p;if("message"in t)d=t.message,p=t.signature;else{const{chain:m,wallet:g,statement:y,options:x}=t;let b;if(pt())if(typeof g=="object")b=g;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")b=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!x?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=g}const _=new URL((e=x?.url)!==null&&e!==void 0?e:window.location.href),w=await b.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!w||w.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const v=bh(w[0]);let S=(r=x?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!S){const P=await b.request({method:"eth_chainId"});S=Gm(P)}const T={domain:_.host,address:v,statement:y,uri:_.href,version:"1",chainId:S,nonce:(i=x?.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(n=x?.signInWithEthereum)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=x?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=x?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(h=x?.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(c=x?.signInWithEthereum)===null||c===void 0?void 0:c.resources};d=zm(T),p=await b.request({method:"personal_sign",params:[Wm(d),v]})}try{const{data:m,error:g}=await B(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:p},!((u=t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Pt});if(g)throw g;if(!m||!m.session||!m.user){const y=new Me;return this._returnResult({data:{user:null,session:null},error:y})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:g})}catch(m){if(O(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async signInWithSolana(t){var e,r,i,n,o,a,l,h,c,u,f,d;let p,m;if("message"in t)p=t.message,m=t.signature;else{const{chain:g,wallet:y,statement:x,options:b}=t;let _;if(pt())if(typeof y=="object")_=y;else{const v=window;if("solana"in v&&typeof v.solana=="object"&&("signIn"in v.solana&&typeof v.solana.signIn=="function"||"signMessage"in v.solana&&typeof v.solana.signMessage=="function"))_=v.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=y}const w=new URL((e=b?.url)!==null&&e!==void 0?e:window.location.href);if("signIn"in _&&_.signIn){const v=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:w.host,uri:w.href}),x?{statement:x}:null));let S;if(Array.isArray(v)&&v[0]&&typeof v[0]=="object")S=v[0];else if(v&&typeof v=="object"&&"signedMessage"in v&&"signature"in v)S=v;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)p=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),m=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${w.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${w.href}`,`Issued At: ${(i=(r=b?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=b?.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((o=b?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((h=b?.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((u=(c=b?.signInWithSolana)===null||c===void 0?void 0:c.resources)===null||u===void 0)&&u.length?["Resources",...b.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const v=await _.signMessage(new TextEncoder().encode(p),"utf8");if(!v||!(v instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=v}}try{const{data:g,error:y}=await B(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Te(m)},!((f=t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(d=t.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:Pt});if(y)throw y;if(!g||!g.session||!g.user){const x=new Me;return this._returnResult({data:{user:null,session:null},error:x})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:y})}catch(g){if(O(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async _exchangeCodeForSession(t){const e=await fe(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(e??"").split("/");try{if(!r&&this.flowType==="pkce")throw new um;const{data:n,error:o}=await B(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:Pt});if(await ft(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!n||!n.session||!n.user){const a=new Me;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:o})}catch(n){if(await ft(this.storage,`${this.storageKey}-code-verifier`),O(n))return this._returnResult({data:{user:null,session:null,redirectType:null},error:n});throw n}}async signInWithIdToken(t){try{const{options:e,provider:r,token:i,access_token:n,nonce:o}=t,a=await B(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:e?.captchaToken}},xform:Pt}),{data:l,error:h}=a;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!l||!l.session||!l.user){const c=new Me;return this._returnResult({data:{user:null,session:null},error:c})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:h})}catch(e){if(O(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(t){var e,r,i,n,o;try{if("email"in t){const{email:a,options:l}=t;let h=null,c=null;this.flowType==="pkce"&&([h,c]=await Ie(this.storage,this.storageKey));const{error:u}=await B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(e=l?.data)!==null&&e!==void 0?e:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:h,code_challenge_method:c},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in t){const{phone:a,options:l}=t,{data:h,error:c}=await B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l?.data)!==null&&i!==void 0?i:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h?.message_id},error:c})}throw new cr("You must provide either an email or phone number.")}catch(a){if(await ft(this.storage,`${this.storageKey}-code-verifier`),O(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(t){var e,r;try{let i,n;"options"in t&&(i=(e=t.options)===null||e===void 0?void 0:e.redirectTo,n=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await B(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:Pt});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,h=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(i){if(O(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(t){var e,r,i,n,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Ie(this.storage,this.storageKey));const h=await B(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(e=t.options)===null||e===void 0?void 0:e.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=t?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:Dm});return!((n=h.data)===null||n===void 0)&&n.url&&pt()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(a){if(await ft(this.storage,`${this.storageKey}-code-verifier`),O(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:r}=t;if(r)throw r;if(!e)throw new vt;const{error:i}=await B(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(t){if(O(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:r,type:i,options:n}=t,{error:o}=await B(this.fetch,"POST",e,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},redirectTo:n?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:r,type:i,options:n}=t,{data:o,error:a}=await B(this.fetch,"POST",e,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new cr("You must provide either an email or phone number and a type")}catch(e){if(O(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await e()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=e();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const e=await fe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),e!==null&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<yi:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const o=await fe(this.userStorage,this.storageKey+"-user");o?.user?t.user=o.user:t.user=xi()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=Im(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:i,error:n}=await this._callRefreshToken(t.refresh_token);return n?this._returnResult({data:{session:null},error:n}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const e=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return e.data.user&&(this.suppressGetSessionWarning=!0),e}async _getUser(t){try{return t?await B(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:se}):await this._useSession(async e=>{var r,i,n;const{data:o,error:a}=e;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new vt}:await B(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:se})})}catch(e){if(O(e))return _i(e)&&(await this._removeSession(),await ft(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,e))}async _updateUser(t,e={}){try{return await this._useSession(async r=>{const{data:i,error:n}=r;if(n)throw n;if(!i.session)throw new vt;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&t.email!=null&&([a,l]=await Ie(this.storage,this.storageKey));const{data:h,error:c}=await B(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:e?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:se});if(c)throw c;return o.user=h.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await ft(this.storage,`${this.storageKey}-code-verifier`),O(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new vt;const e=Date.now()/1e3;let r=e,i=!0,n=null;const{payload:o}=dr(t.access_token);if(o.exp&&(r=o.exp,i=r<=e),i){const{data:a,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=await this._getUser(t.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});n={access_token:t.access_token,refresh_token:t.refresh_token,user:a.user,token_type:"bearer",expires_in:r-e,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(e){if(O(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var r;if(!t){const{data:o,error:a}=e;if(a)throw a;t=(r=o.session)!==null&&r!==void 0?r:void 0}if(!t?.refresh_token)throw new vt;const{data:i,error:n}=await this._callRefreshToken(t.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(O(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(t,e){try{if(!pt())throw new ur("No browser detected.");if(t.error||t.error_description||t.error_code)throw new ur(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if(this.flowType==="pkce")throw new na("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ur("Not a valid implicit grant flow url.");break;default:}if(e==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new na("No code detected.");const{data:x,error:b}=await this._exchangeCodeForSession(t.code);if(b)throw b;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:h}=t;if(!n||!a||!o||!h)throw new ur("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(a);let f=c+u;l&&(f=parseInt(l));const d=f-c;d*1e3<=Fe&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${u}s`);const p=f-u;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,c);const{data:m,error:g}=await this._getUser(n);if(g)throw g;const y={provider_token:r,provider_refresh_token:i,access_token:n,expires_in:u,expires_at:f,refresh_token:o,token_type:h,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:y,redirectType:t.type},error:null})}catch(r){if(O(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await fe(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async e=>{var r;const{data:i,error:n}=e;if(n&&!_i(n))return this._returnResult({error:n});const o=(r=i.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,t);if(a&&!(hm(a)&&(a.status===404||a.status===401||a.status===403)||_i(a)))return this._returnResult({error:a})}return t!=="others"&&(await this._removeSession(),await ft(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const e=_m(),r={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,r),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(e)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async e=>{var r,i;try{const{data:{session:n},error:o}=e;if(o)throw o;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",t,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",n),console.error(n)}})}async resetPasswordForEmail(t,e={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await Ie(this.storage,this.storageKey,!0));try{return await B(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(n){if(await ft(this.storage,`${this.storageKey}-code-verifier`),O(n))return this._returnResult({data:null,error:n});throw n}}async getUserIdentities(){var t;try{const{data:e,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(t=e.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:r,error:i}=await this._useSession(async n=>{var o,a,l,h,c;const{data:u,error:f}=n;if(f)throw f;const d=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await B(this.fetch,"GET",d,{headers:this.headers,jwt:(c=(h=u.session)===null||h===void 0?void 0:h.access_token)!==null&&c!==void 0?c:void 0})});if(i)throw i;return pt()&&!(!((e=t.options)===null||e===void 0)&&e.skipBrowserRedirect)&&window.location.assign(r?.url),this._returnResult({data:{provider:t.provider,url:r?.url},error:null})}catch(r){if(O(r))return this._returnResult({data:{provider:t.provider,url:null},error:r});throw r}}async linkIdentityIdToken(t){return await this._useSession(async e=>{var r;try{const{error:i,data:{session:n}}=e;if(i)throw i;const{options:o,provider:a,token:l,access_token:h,nonce:c}=t,u=await B(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=n?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:h,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Pt}),{data:f,error:d}=u;return d?this._returnResult({data:{user:null,session:null},error:d}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new Me}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:d}))}catch(i){if(await ft(this.storage,`${this.storageKey}-code-verifier`),O(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(t){try{return await this._useSession(async e=>{var r,i;const{data:n,error:o}=e;if(o)throw o;return await B(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(i=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const r=Date.now();return await vm(async i=>(i>0&&await wm(200*Math.pow(2,i-1)),this._debug(e,"refreshing attempt",i),await B(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Pt})),(i,n)=>{const o=200*Math.pow(2,i);return n&&bi(n)&&Date.now()+o-r<Fe})}catch(r){if(this._debug(e,"error",r),O(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(e,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",r),pt()&&!e.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,e;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await fe(this.storage,this.storageKey);if(i&&this.userStorage){let o=await fe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await je(this.userStorage,this.storageKey+"-user",o)),i.user=(t=o?.user)!==null&&t!==void 0?t:xi()}else if(i&&!i.user&&!i.user){const o=await fe(this.storage,this.storageKey+"-user");o&&o?.user?(i.user=o.user,await ft(this.storage,this.storageKey+"-user"),await je(this.storage,this.storageKey,i)):i.user=xi()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const n=((e=i.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<yi;if(this._debug(r,`session has${n?"":" not"} expired with margin of ${yi}s`),n){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),bi(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(i.access_token);!a&&o?.user?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var e,r;if(!t)throw new vt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Dr;const{data:n,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!n.session)throw new vt;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={data:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(i,"error",n),O(n)){const o={data:null,error:n};return bi(n)||await this._removeSession(),(e=this.refreshingDeferred)===null||e===void 0||e.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(t,e,r=!0){const i=`#_notifyAllSubscribers(${t})`;this._debug(i,"begin",e,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:e});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(t,e)}catch(l){n.push(l)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await ft(this.storage,`${this.storageKey}-code-verifier`);const e=Object.assign({},t),r=e.user&&e.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&e.user&&await je(this.userStorage,this.storageKey+"-user",{user:e.user});const i=Object.assign({},e);delete i.user;const n=ca(i);await je(this.storage,this.storageKey,n)}else{const i=ca(e);await je(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ft(this.storage,this.storageKey),await ft(this.storage,this.storageKey+"-code-verifier"),await ft(this.storage,this.storageKey+"-user"),this.userStorage&&await ft(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&pt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Fe);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const e=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const e=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,e&&clearTimeout(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-t)/Fe);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Fe}ms, refresh threshold is ${en} ticks`),i<=en&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof _h)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!pt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,r){const i=[`provider=${encodeURIComponent(e)}`];if(r?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,o]=await Ie(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(r?.queryParams){const n=new URLSearchParams(r.queryParams);i.push(n.toString())}return r?.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${i.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var r;const{data:i,error:n}=e;return n?this._returnResult({data:null,error:n}):await B(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token})})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(t){try{return await this._useSession(async e=>{var r,i;const{data:n,error:o}=e;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:h}=await B(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});return h?this._returnResult({data:null,error:h}):(t.factorType==="totp"&&l.type==="totp"&&(!((i=l?.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var r;const{data:i,error:n}=e;if(n)return this._returnResult({data:null,error:n});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Jm(t.webauthn.credential_response):Zm(t.webauthn.credential_response)})}:{code:t.code}),{data:a,error:l}=await B(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var r;const{data:i,error:n}=e;if(n)return this._returnResult({data:null,error:n});const o=await B(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Xm(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Km(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(t){const{data:e,error:r}=await this._challenge({factorId:t.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){var t;const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const n of(t=e?.factors)!==null&&t!==void 0?t:[])i.all.push(n),n.status==="verified"&&i[n.factor_type].push(n);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(t){var e,r,i,n;if(t)try{const{payload:d}=dr(t);let p=null;d.aal&&(p=d.aal);let m=p;const{data:{user:g},error:y}=await this.getUser(t);if(y)return this._returnResult({data:null,error:y});((r=(e=g?.factors)===null||e===void 0?void 0:e.filter(_=>_.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(m="aal2");const b=d.amr||[];return{data:{currentLevel:p,nextLevel:m,currentAuthenticationMethods:b},error:null}}catch(d){if(O(d))return this._returnResult({data:null,error:d});throw d}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=dr(o.access_token);let h=null;l.aal&&(h=l.aal);let c=h;((n=(i=o.user.factors)===null||i===void 0?void 0:i.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const f=l.amr||[];return{data:{currentLevel:h,nextLevel:c,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async e=>{const{data:{session:r},error:i}=e;return i?this._returnResult({data:null,error:i}):r?await B(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:r.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new vt})})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(t,e){try{return await this._useSession(async r=>{const{data:{session:i},error:n}=r;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new vt});const o=await B(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&pt()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(r){if(O(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(t,e){try{return await this._useSession(async r=>{const{data:{session:i},error:n}=r;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new vt});const o=await B(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&pt()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(r){if(O(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:e},error:r}=t;return r?this._returnResult({data:null,error:r}):e?await B(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:e.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new vt})})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async e=>{const{data:{session:r},error:i}=e;return i?this._returnResult({data:null,error:i}):r?(await B(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new vt})})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(t,e={keys:[]}){let r=e.keys.find(a=>a.kid===t);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(a=>a.kid===t),r&&this.jwks_cached_at+am>i)return r;const{data:n,error:o}=await B(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!n.keys||n.keys.length===0||(this.jwks=n,this.jwks_cached_at=i,r=n.keys.find(a=>a.kid===t),!r)?null:r}async getClaims(t,e={}){try{let r=t;if(!r){const{data:d,error:p}=await this.getSession();if(p||!d.session)return this._returnResult({data:null,error:p});r=d.session.access_token}const{header:i,payload:n,signature:o,raw:{header:a,payload:l}}=dr(r);e?.allowExpired||Pm(n.exp);const h=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,e?.keys?{keys:e.keys}:e?.jwks);if(!h){const{error:d}=await this.getUser(r);if(d)throw d;return{data:{claims:n,header:i,signature:o},error:null}}const c=Rm(i.alg),u=await crypto.subtle.importKey("jwk",h,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,o,mm(`${a}.${l}`)))throw new nn("Invalid JWT signature");return{data:{claims:n,header:i,signature:o},error:null}}catch(r){if(O(r))return this._returnResult({data:null,error:r});throw r}}}$s.nextInstanceID={};const ay=$s,ly="2.97.0";let _s="";typeof Deno<"u"?_s="deno":typeof document<"u"?_s="web":typeof navigator<"u"&&navigator.product==="ReactNative"?_s="react-native":_s="node";const hy={"X-Client-Info":`supabase-js-${_s}/${ly}`},cy={headers:hy},uy={schema:"public"},dy={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},fy={};function Us(s){"@babel/helpers - typeof";return Us=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Us(s)}function py(s,t){if(Us(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var r=e.call(s,t);if(Us(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function gy(s){var t=py(s,"string");return Us(t)=="symbol"?t:t+""}function my(s,t,e){return(t=gy(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function _a(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),e.push.apply(e,r)}return e}function st(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?_a(Object(e),!0).forEach(function(r){my(s,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):_a(Object(e)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(e,r))})}return s}const yy=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),_y=()=>Headers,by=(s,t,e)=>{const r=yy(e),i=_y();return async(n,o)=>{var a;const l=(a=await t())!==null&&a!==void 0?a:s;let h=new i(o?.headers);return h.has("apikey")||h.set("apikey",s),h.has("Authorization")||h.set("Authorization",`Bearer ${l}`),r(n,st(st({},o),{},{headers:h}))}};function xy(s){return s.endsWith("/")?s:s+"/"}function wy(s,t){var e,r;const{db:i,auth:n,realtime:o,global:a}=s,{db:l,auth:h,realtime:c,global:u}=t,f={db:st(st({},l),i),auth:st(st({},h),n),realtime:st(st({},c),o),storage:{},global:st(st(st({},u),a),{},{headers:st(st({},(e=u?.headers)!==null&&e!==void 0?e:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return s.accessToken?f.accessToken=s.accessToken:delete f.accessToken,f}function vy(s){const t=s?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(xy(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Sy=class extends ay{constructor(s){super(s)}},Ay=class{constructor(s,t,e){var r,i;this.supabaseUrl=s,this.supabaseKey=t;const n=vy(s);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);const o=`sb-${n.hostname.split(".")[0]}-auth-token`,a={db:uy,realtime:fy,auth:st(st({},dy),{},{storageKey:o}),global:cy},l=wy(e??{},a);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(c,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=l.auth)!==null&&h!==void 0?h:{},this.headers,l.global.fetch)}this.fetch=by(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(st({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(c=>this.realtime.setAuth(c)).catch(c=>console.warn("Failed to set initial Realtime auth token:",c)),this.rest=new hg(new URL("rest/v1",n).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new sm(this.storageUrl.href,this.headers,this.fetch,e?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new eg(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,t={},e={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,t,e)}channel(s,t={config:{}}){return this.realtime.channel(s,t)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s=this,t,e;if(s.accessToken)return await s.accessToken();const{data:r}=await s.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:s.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:t,detectSessionInUrl:e,storage:r,userStorage:i,storageKey:n,flowType:o,lock:a,debug:l,throwOnError:h},c,u){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Sy({url:this.authUrl.href,headers:st(st({},f),c),storageKey:n,autoRefreshToken:s,persistSession:t,detectSessionInUrl:e,storage:r,userStorage:i,flowType:o,lock:a,debug:l,throwOnError:h,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(d=>d.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new kg(this.realtimeUrl.href,st(st({},s),{},{params:st(st({},{apikey:this.supabaseKey}),s?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,t)=>{this._handleTokenChanged(s,"CLIENT",t?.access_token)})}_handleTokenChanged(s,t,e){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==e?(this.changedAccessToken=e,this.realtime.setAuth(e)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Ty=(s,t,e)=>new Ay(s,t,e);function ky(){if(typeof window<"u")return!1;const s=globalThis.process;if(!s)return!1;const t=s.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}ky()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Cy="https://girogqgaxozrcuqvzihx.supabase.co",Ey="sb_publishable_vB5Kce1_IkurO_WKE9LNAA_o2L0-TOL";let fr=null;function wh(){return fr||(fr=Ty(Cy,Ey),fr)}const vh="sling-survivor-leaderboard",ie=10,Sh="leaderboard";function Ye(){try{const s=localStorage.getItem(vh);if(!s)return[];const t=JSON.parse(s);return Array.isArray(t)?t:[]}catch{return[]}}function vi(s){localStorage.setItem(vh,JSON.stringify(s))}async function Ah(){const s=wh();if(s)try{console.log("[Leaderboard] Fetching from Supabase");const{data:r,error:i}=await s.from(Sh).select("initials, score").order("score",{ascending:!1}).limit(ie);if(i){console.warn("[Leaderboard] Supabase fetch failed:",i.message," using localStorage");const a=Ye().slice().sort((l,h)=>h.score-l.score).slice(0,ie);return console.log("[Leaderboard] Loaded",a.length,"entries from localStorage"),a}const n=(r??[]).map(o=>({initials:String(o.initials??"").slice(0,3)||"???",score:Number(o.score)??0}));return console.log("[Leaderboard] Loaded",n.length,"entries from Supabase (persisted in DB)"),n}catch(r){console.warn("[Leaderboard] Supabase error:",r," using localStorage");const n=Ye().slice().sort((o,a)=>a.score-o.score).slice(0,ie);return console.log("[Leaderboard] Loaded",n.length,"entries from localStorage"),n}const e=Ye().slice().sort((r,i)=>i.score-r.score).slice(0,ie);return console.log("[Leaderboard] Loaded",e.length,"entries from localStorage"),e}async function Py(s,t){const e={initials:String(s).toUpperCase().slice(0,3)||"???",score:t},r=wh();if(r)try{console.log("[Leaderboard] Submitting to Supabase",e);const{error:n}=await r.from(Sh).insert(e);if(n){console.warn("[Leaderboard] Supabase submit failed:",n.message," saving to localStorage");const o=Ye();o.push(e),o.sort((a,l)=>l.score-a.score),vi(o.slice(0,ie)),console.log("[Leaderboard] Score saved to localStorage");return}console.log("[Leaderboard] Score saved to Supabase (persisted in DB)");return}catch(n){console.warn("[Leaderboard] Supabase error on submit:",n," saving to localStorage");const o=Ye();o.push(e),o.sort((a,l)=>l.score-a.score),vi(o.slice(0,ie)),console.log("[Leaderboard] Score saved to localStorage");return}const i=Ye();i.push(e),i.sort((n,o)=>o.score-n.score),vi(i.slice(0,ie)),console.log("[Leaderboard] Score saved to localStorage")}async function Ry(s){const t=await Ah();return t.length<ie?!0:s>(t[t.length-1]?.score??-1)}class My{el=null;show(){this.el||(this.el=document.createElement("div"),this.el.className="leaderboard-overlay",this.el.innerHTML=this.markup(),document.body.appendChild(this.el),this.el.querySelector(".leaderboard-overlay-backdrop")?.addEventListener("click",()=>this.hide()),this.el.querySelector(".leaderboard-overlay-close")?.addEventListener("click",()=>this.hide()),this.el.querySelector(".leaderboard-panel")?.addEventListener("click",t=>t.stopPropagation())),this.el.style.display="flex",this.refresh()}hide(){this.el&&(this.el.style.display="none")}async refresh(){if(!this.el)return;const t=this.el.querySelector(".leaderboard-list");if(!t)return;const e=await Ah();t.innerHTML=e.length?e.map((r,i)=>`<div class="leaderboard-row"><span class="rank">${i+1}</span><span class="initials">${r.initials}</span><span class="score">${r.score}</span></div>`).join(""):'<div class="leaderboard-empty">No scores yet. Play to get on the board!</div>'}markup(){return`
<style>
  .leaderboard-overlay {
    position: fixed;
    inset: 0;
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.8);
  }
  .leaderboard-overlay-backdrop { position: absolute; inset: 0; cursor: pointer; }
  .leaderboard-panel {
    position: relative;
    width: 90%;
    max-width: 420px;
    background: #0a0a14;
    border: 3px solid #3a5a3a;
    border-radius: 8px;
    padding: 24px 28px 28px;
    box-shadow: 0 0 40px rgba(0,80,0,0.2), inset 0 0 60px rgba(0,0,0,0.5);
    font-family: "Courier New", monospace;
  }
  .leaderboard-title {
    text-align: center;
    color: #ffcc00;
    font-size: 22px;
    font-weight: bold;
    letter-spacing: 4px;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(255,204,0,0.5);
  }
  .leaderboard-head {
    display: flex;
    justify-content: space-between;
    color: #6a8a6a;
    font-size: 12px;
    letter-spacing: 2px;
    margin-bottom: 8px;
    padding: 0 8px;
  }
  .leaderboard-list { min-height: 200px; }
  .leaderboard-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    margin-bottom: 4px;
    background: rgba(0,40,0,0.3);
    border-radius: 4px;
    color: #aaffaa;
    font-size: 18px;
  }
  .leaderboard-row .rank { color: #ffcc00; width: 32px; }
  .leaderboard-row .initials { letter-spacing: 3px; flex: 1; text-align: center; }
  .leaderboard-row .score { color: #00ff88; min-width: 72px; text-align: right; }
  .leaderboard-empty {
    color: #668866;
    text-align: center;
    padding: 40px 20px;
    font-size: 14px;
  }
  .leaderboard-overlay-close {
    display: block;
    margin: 20px auto 0;
    padding: 10px 28px;
    background: #2a4a2a;
    color: #aaffaa;
    border: 2px solid #3a6a3a;
    border-radius: 8px;
    font: bold 14px "Courier New", monospace;
    cursor: pointer;
  }
  .leaderboard-overlay-close:hover { background: #3a5a3a; }
</style>
<div class="leaderboard-overlay-backdrop" aria-label="Close"></div>
<div class="leaderboard-panel">
  <div class="leaderboard-title"> HIGH SCORES </div>
  <div class="leaderboard-head"><span>RANK</span><span>INITIALS</span><span>SCORE</span></div>
  <div class="leaderboard-list">Loading</div>
  <button type="button" class="leaderboard-overlay-close">Close</button>
</div>
`}}function Iy(s,t){const e=document.createElement("div");e.className="initials-prompt-overlay",e.style.cssText="position:fixed;inset:0;z-index:10002;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);font-family:system-ui,sans-serif;",e.innerHTML=`
    <div style="background:#12122a;border:2px solid #4488aa;border-radius:12px;padding:28px;text-align:center;max-width:320px;">
      <p style="color:#fff;margin:0 0 8px 0;font-size:18px;">You made the top 10!</p>
      <p style="color:#88aacc;margin:0 0 16px 0;font-size:14px;">Score: ${s} m</p>
      <label style="display:block;color:#aaccdd;font-size:13px;margin-bottom:6px;">Enter your initials (3 letters)</label>
      <input type="text" maxlength="3" placeholder="ABC" style="width:120px;padding:10px;font-size:20px;letter-spacing:6px;text-align:center;border-radius:8px;border:2px solid #4488aa;background:#0a0a1a;color:#fff;">
      <div style="margin-top:16px;">
        <button type="button" class="initials-submit" style="padding:10px 24px;background:#4488aa;color:#fff;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">Submit</button>
      </div>
    </div>
  `,document.body.appendChild(e);const r=e.querySelector("input"),i=e.querySelector(".initials-submit");r?.focus();const n=()=>{e.remove()};i?.addEventListener("click",()=>{const o=(r?.value??"").trim().toUpperCase().slice(0,3)||"???";n(),t(o)}),r?.addEventListener("keydown",o=>{o.key==="Enter"&&i?.click()})}const ba=8;class Oy{scenes;root=new H;elapsed=0;btn;btnBaseY=0;bg=null;coin=null;helpOverlay=new Jp;leaderboardOverlay=new My;constructor(t){this.scenes=t}enter(){const t=this.scenes.getApp();t.stage.addChild(this.root);const e=t.renderer.width,r=t.renderer.height,i=e/2,n=r*.62,o=12,a=48,l=28;this.btn=this.buildLaunchButton(),this.btn.x=i,this.btn.y=n,this.btnBaseY=n,this.root.addChild(this.btn),this.btn.eventMode="static",this.btn.cursor="pointer",this.btn.on("pointerdown",()=>this.scenes.switchTo("run")),this.btn.on("pointerover",()=>this.btn.scale.set(1.06)),this.btn.on("pointerout",()=>{});const h=r-o-a/2,c=this.buildBevelButton("HOW TO PLAY",{blue:!0,small:!0});c.x=i,c.y=h-a-l,this.root.addChild(c),c.eventMode="static",c.cursor="pointer",c.on("pointerdown",()=>this.helpOverlay.show(e,r)),c.on("pointerover",()=>c.scale.set(1.04)),c.on("pointerout",()=>c.scale.set(1));const u=this.buildBevelButton("LEADERBOARDS",{blue:!0,small:!0});u.x=i,u.y=h,this.root.addChild(u),u.eventMode="static",u.cursor="pointer",u.on("pointerdown",()=>this.leaderboardOverlay.show()),u.on("pointerover",()=>u.scale.set(1.04)),u.on("pointerout",()=>u.scale.set(1)),Lt.load(Ce("/title_mockup.png")).then(f=>{this.bg=new Nt(f),this.coverFit(e,r),this.root.addChildAt(this.bg,0)}),Lt.load(Ce("/coin_flip_sheet.png")).then(f=>{const d=f.width/ba,p=f.height,m=[];for(let g=0;g<ba;g++)m.push(new j({source:f.source,frame:new Q(g*d,0,d,p)}));this.coin=new ts(m),this.coin.animationSpeed=.18,this.coin.width=128,this.coin.height=128,this.coin.x=20,this.coin.y=20,this.coin.play(),this.root.addChild(this.coin)})}exit(){this.helpOverlay.hide(),this.leaderboardOverlay.hide()}update(t){if(this.elapsed+=t,!this.btn)return;const e=Math.sin(this.elapsed*1.6)*10,r=Math.sin(this.elapsed*2.9)*3;this.btn.y=this.btnBaseY+e+r;const i=1+Math.sin(this.elapsed*2.2)*.018;this.btn.scale.set(i),this.btn.rotation=Math.sin(this.elapsed*1.1)*.02}coverFit(t,e){if(!this.bg)return;const r=this.bg.texture,i=Math.max(t/r.width,e/r.height);this.bg.scale.set(i),this.bg.x=(t-r.width*i)/2,this.bg.y=(e-r.height*i)/2}buildBevelButton(t,e={}){const r=e.small??!1,i=e.blue??!1,n=r?200:230,o=r?48:68,a=r?14:18,l=new H;if(!r&&!i){const T=new G;T.roundRect(-n/2-14,-o/2-14,n+28,o+28,a+12),T.fill({color:16760640,alpha:.18}),T.roundRect(-n/2-8,-o/2-8,n+16,o+16,a+6),T.fill({color:16760640,alpha:.12}),l.addChild(T)}const h=i?1718874:6044938,c=i?3170464:15771688,u=i?4227264:16767088,f=i?2113664:12286480,d=i?6328524:16771240,p=i?5279952:16774352,m=i?15267071:16777200,g=i?1056832:7029760,y=new G;y.roundRect(-n/2+2,-o/2+4,n,o,a),y.fill({color:h,alpha:i?.8:.7}),l.addChild(y);const x=new G;x.roundRect(-n/2,-o/2,n,o,a),x.fill({color:c}),l.addChild(x);const b=new G;b.roundRect(-n/2+4,-o/2+4,n-8,o*.4,a-4),b.fill({color:u,alpha:i?.5:.55}),l.addChild(b);const _=new G;_.roundRect(-n/2+4,o/2-o*.35,n-8,o*.3,a-4),_.fill({color:f,alpha:i?.4:.35}),l.addChild(_);const w=new G;w.roundRect(-n/2,-o/2,n,o,a),w.stroke({width:2.5,color:d,alpha:.85}),l.addChild(w);const v=new G;v.roundRect(-n/2+3,-o/2+3,n-6,o-6,a-2),v.stroke({width:1,color:p,alpha:.3}),l.addChild(v);const S=new at({text:t,style:{fill:m,fontSize:r?18:30,fontFamily:"system-ui, sans-serif",fontWeight:"bold",letterSpacing:r?2:3,dropShadow:{color:g,blur:2,distance:1,angle:Math.PI/3}}});return S.anchor.set(.5),S.y=-1,l.addChild(S),l}buildLaunchButton(){return this.buildBevelButton("LAUNCH",{blue:!1,small:!1})}}class Ly{world=new H;fx=new H;ui=new H;root=new H;constructor(){this.root.addChild(this.world,this.fx,this.ui)}}class By{constructor(t){this.world=t}targetX=0;targetY=0;follow(t,e){this.targetX=t,this.targetY=e}update(t){const e=1-Math.exp(-t*8);this.world.x+=(-this.targetX-this.world.x)*e,this.world.y+=(-this.targetY-this.world.y)*e}}class Dy{keys=new Set;constructor(t=window){t.addEventListener("keydown",e=>this.keys.add(e.key.toLowerCase())),t.addEventListener("keyup",e=>this.keys.delete(e.key.toLowerCase())),t.addEventListener("blur",()=>this.keys.clear())}isDown(t){return this.keys.has(t.toLowerCase())}getAxis(){const t=this.isDown("a")||this.isDown("arrowleft"),e=this.isDown("d")||this.isDown("arrowright"),r=this.isDown("w")||this.isDown("arrowup"),i=this.isDown("s")||this.isDown("arrowdown");return{x:(e?1:0)-(t?1:0),y:(i?1:0)-(r?1:0)}}}class $y{constructor(t){this.el=t,t.addEventListener("pointerdown",this.onDown),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onUp),t.addEventListener("pointercancel",this.onUp),t.addEventListener("lostpointercapture",this.onUp)}state={isDragging:!1,released:!1,startX:0,startY:0,x:0,y:0};onDown=t=>{this.el.setPointerCapture(t.pointerId),this.state.isDragging=!0,this.state.startX=t.clientX,this.state.startY=t.clientY,this.state.x=t.clientX,this.state.y=t.clientY};onMove=t=>{this.state.isDragging&&(this.state.x=t.clientX,this.state.y=t.clientY)};onUp=t=>{this.state.isDragging&&(this.state.released=!0),this.state.isDragging=!1}}const E={world:{gravity:900,airDrag:.02,groundFriction:.12,bounce:.15},player:{radius:18,hpMax:100,boostMax:100,boostDrainPerSec:14,boostRegenPerSec:8,boostAutoRegen:!0,thrustAccel:1400,stallSpeed:35,stallTime:1.5},launcher:{originX:120,originY:320,powerMin:400,powerMax:1600,powerScale:2,maxPullDist:400},enemy:{spawnEverySec:2,maxAlive:8,droneSpeed:220,contactSpeedRetain:.75,dragDebuffSec:.75},rounds:{startingRockets:3,baseToll:100,tollScale:1.7},xp:{baseToLevel:50,levelScale:1.35,perKm:50,perKill:25},scrap:{perKill:10},gold:{scrapToGoldRate:.5,rocketBonus:15},worldCoins:{goldPerPickup:5,spawnIntervalMin:800,spawnIntervalMax:1200,clusterMin:3,clusterMax:6,pickupRadius:32,coinSize:24},merchant:{upgradePriceCommon:40,upgradePriceRare:60,upgradePriceEpic:80},elite:{spawnEveryN:5,hp:60,speed:260,radius:20,contactDamage:4},ramp:{spawnIntervalDecay:5e-4,spawnIntervalMin:.8,maxAliveGrowth:.005,maxAliveCap:15},shooter:{preferDistMin:350,preferDistMax:550,speed:180,hp:15,radius:12,fireCooldown:1.5,bulletSpeed:350,bulletDamage:1,bulletSpeedRetain:.9,bulletDragDebuff:.3,bulletLifeT:2.5,bulletRadius:5,spawnRatio:.25,minDistanceM:200}};class Uy{groundYAt(t){return 420+Math.sin(t*.003)*30+Math.sin(t*.0012)*18}}class Fy{terrain=new Uy;stepPlayer(t,e){const r=E.world.gravity;t.vel.y+=r*e;const i=E.world.airDrag+(t.dragDebuffT>0?.08:0);t.vel.x*=1-i,t.vel.y*=1-i,t.pos.x+=t.vel.x*e,t.pos.y+=t.vel.y*e;const n=this.terrain.groundYAt(t.pos.x);t.pos.y+t.radius>n&&(t.pos.y=n-t.radius,t.vel.y>0&&(t.vel.y=-t.vel.y*E.world.bounce),t.vel.x*=1-E.world.groundFriction),t.dragDebuffT=Math.max(0,t.dragDebuffT-e)}}class jy{step(t,e,r,i){if(!t.launched)return;const n=e.getAxis(),o=n.x,a=n.y,l=o!==0||a!==0;l&&t.boost>0?(t.vel.x+=o*r.thrustAccel*i,t.vel.y+=a*r.thrustAccel*i,t.boost=Math.max(0,t.boost-r.boostDrainPerSec*i)):!l&&r.boostAutoRegen&&(t.boost=Math.min(r.boostMax,t.boost+r.boostRegenPerSec*i))}}const It={add:(s,t)=>({x:s.x+t.x,y:s.y+t.y}),sub:(s,t)=>({x:s.x-t.x,y:s.y-t.y}),mul:(s,t)=>({x:s.x*t,y:s.y*t}),len:s=>Math.hypot(s.x,s.y),norm:s=>{const t=Math.hypot(s.x,s.y);return t<=1e-8?{x:0,y:0}:{x:s.x/t,y:s.y/t}}};class Ny{applyLaunch(t,e,r,i){const n=e.state;if(t.launched||!n.released)return;const o=r-n.x,a=i-n.y,l=Math.hypot(o,a);if(n.released=!1,l<6)return;const h=Math.min(l,E.launcher.maxPullDist),c=Math.min(E.launcher.powerMax,Math.max(E.launcher.powerMin,h*E.launcher.powerScale)),u=It.norm({x:o,y:a});t.vel.x=u.x*c,t.vel.y=u.y*c,t.launched=!0}}class Gy{t=0;nextId=1;spawnCount=0;reset(){this.t=0,this.nextId=1,this.spawnCount=0}step(t,e,r,i,n,o){if(!t.launched)return;this.t+=o;const a=e.filter(c=>c.alive).length,l=Math.min(E.ramp.maxAliveCap,E.enemy.maxAlive+Math.floor(i*E.ramp.maxAliveGrowth));if(a>=l)return;const h=Math.max(E.ramp.spawnIntervalMin,E.enemy.spawnEverySec-i*E.ramp.spawnIntervalDecay);if(this.t>=h){this.t=0,this.spawnCount++;const c=E.shooter.spawnRatio+n.difficulty.shooterChanceAdd,u=i>=E.shooter.minDistanceM&&r.nextFloat()<c,f=this.spawnCount>0&&this.spawnCount%E.elite.spawnEveryN===0,d=r.nextFloat()<n.difficulty.eliteChanceAdd,p=!u&&(f||d),m=n.difficulty.enemyHpMult,g=n.difficulty.enemySpeedMult,y=t.pos.x+600+r.nextFloat()*400,x=t.pos.y-200-r.nextFloat()*250;let b,_;u?(b=E.shooter.hp,_=E.shooter.speed):p?(b=E.elite.hp,_=E.elite.speed):(b=20,_=E.enemy.droneSpeed),e.push({id:this.nextId++,pos:{x:y,y:x},vel:{x:0,y:0},radius:u?E.shooter.radius:p?E.elite.radius:14,hp:Math.round(b*m),speed:_*g,alive:!0,elite:p,droneType:u?"shooter":"chaser",shootTimer:u?E.shooter.fireCooldown:0,wobblePhase:r.nextFloat()*Math.PI*2})}}spawnShooterNear(t,e){e.push({id:this.nextId++,pos:{x:t.pos.x+400,y:t.pos.y-150},vel:{x:0,y:0},radius:E.shooter.radius,hp:E.shooter.hp,speed:E.shooter.speed,alive:!0,elite:!1,droneType:"shooter",shootTimer:E.shooter.fireCooldown,wobblePhase:Math.random()*Math.PI*2})}}class Wy{nextBulletId=1;reset(){this.nextBulletId=1}step(t,e,r,i){if(t.launched)for(const n of e)n.alive&&(n.droneType==="shooter"?this.stepShooter(n,t,r,i):this.stepChaser(n,t,i))}stepChaser(t,e,r){const i=It.sub(e.pos,t.pos),n=It.norm(i);t.vel.x=n.x*t.speed,t.vel.y=n.y*t.speed,t.pos.x+=t.vel.x*r,t.pos.y+=t.vel.y*r}stepShooter(t,e,r,i){const n=E.shooter,o=It.sub(e.pos,t.pos),a=It.len(o),l=It.norm(o);if(a>n.preferDistMax?(t.vel.x=l.x*t.speed,t.vel.y=l.y*t.speed):a<n.preferDistMin?(t.vel.x=-l.x*t.speed,t.vel.y=-l.y*t.speed):(t.vel.x=-l.y*t.speed*.35,t.vel.y=l.x*t.speed*.35),t.pos.x+=t.vel.x*i,t.pos.y+=t.vel.y*i,t.shootTimer-=i,t.shootTimer<=0&&a<n.preferDistMax*1.5){t.shootTimer=n.fireCooldown;const h=It.norm(o);r.push({id:this.nextBulletId++,pos:{x:t.pos.x,y:t.pos.y},vel:It.mul(h,n.bulletSpeed),radius:n.bulletRadius,damage:n.bulletDamage,speedRetain:n.bulletSpeedRetain,dragDebuff:n.bulletDragDebuff,alive:!0,lifeT:n.bulletLifeT})}}}class zy{cooldowns=new Map;nextId=1;reset(){this.cooldowns.clear(),this.nextId=1}step(t,e,r,i,n){if(t.launched)for(const o of i.weaponLoadout){const a=i.weaponStats.get(o);if(!a)continue;let l=this.cooldowns.get(o)??0;l=Math.max(0,l-n),this.cooldowns.set(o,l),!(l>0)&&(a.targetMode==="nearest"?this.fireNearest(t,e,r,a):a.targetMode==="rear"&&this.fireRear(t,r,a))}}fireNearest(t,e,r,i){let n=null,o=1/0;for(const l of e){if(!l.alive)continue;const h=Math.hypot(l.pos.x-t.pos.x,l.pos.y-t.pos.y);h<o&&h<=i.range&&(n=l,o=h)}if(!n)return;const a=It.norm({x:n.pos.x-t.pos.x,y:n.pos.y-t.pos.y});this.emitShots(t,r,i,a)}fireRear(t,e,r){if(Math.hypot(t.vel.x,t.vel.y)<20)return;const n={x:-t.vel.x,y:-t.vel.y},o=It.norm(n);o.x===0&&o.y===0&&(o.x=-1),this.emitShots(t,e,r,o)}emitShots(t,e,r,i){const n=1+r.extraShots,o=Math.atan2(i.y,i.x),a=.12;for(let l=0;l<n;l++){const h=n===1?0:(l-(n-1)/2)*a,c=o+h,u={x:Math.cos(c),y:Math.sin(c)};e.push({id:this.nextId++,pos:{x:t.pos.x,y:t.pos.y},vel:It.mul(u,r.projectileSpeed),radius:r.pierceCount>0?5:4,damage:r.damage,alive:!0,lifeT:r.projectileLifeT,piercing:r.pierceCount>0,pierceLeft:r.pierceCount,hitIds:[]})}this.cooldowns.set(r.id,r.fireCooldown)}}class Hy{step(t,e,r,i,n,o){for(const a of r)if(a.alive){if(a.lifeT-=o,a.lifeT<=0){a.alive=!1;continue}a.pos.x+=a.vel.x*o,a.pos.y+=a.vel.y*o;for(const l of e){if(!l.alive||a.hitIds.includes(l.id))continue;const h=l.pos.x-a.pos.x,c=l.pos.y-a.pos.y,u=l.radius+a.radius;if(h*h+c*c<=u*u)if(l.hp-=a.damage,l.hp<=0&&(l.alive=!1,t.kills+=1),a.piercing&&a.pierceLeft>0)a.hitIds.push(l.id),a.pierceLeft--;else{a.alive=!1;break}}}for(const a of e){if(!a.alive)continue;const l=a.pos.x-t.pos.x,h=a.pos.y-t.pos.y,c=a.radius+t.radius;if(l*l+h*h<=c*c){t.vel.x*=n.contactSpeedRetain,t.vel.y*=n.contactSpeedRetain,t.dragDebuffT=Math.max(t.dragDebuffT,n.dragDebuffSec);const u=a.elite?E.elite.contactDamage:2;t.hp=Math.max(0,t.hp-u),t.hits+=1,a.pos.x+=l*.2,a.pos.y+=h*.2}}for(const a of i){if(!a.alive)continue;if(a.lifeT-=o,a.lifeT<=0){a.alive=!1;continue}a.pos.x+=a.vel.x*o,a.pos.y+=a.vel.y*o;const l=t.pos.x-a.pos.x,h=t.pos.y-a.pos.y,c=t.radius+a.radius;l*l+h*h<=c*c&&(t.vel.x*=a.speedRetain,t.vel.y*=a.speedRetain,t.dragDebuffT=Math.max(t.dragDebuffT,a.dragDebuff),t.hp=Math.max(0,t.hp-a.damage),t.hits+=1,a.alive=!1)}for(let a=r.length-1;a>=0;a--)r[a].alive||r.splice(a,1);for(let a=e.length-1;a>=0;a--)e[a].alive||e.splice(a,1);for(let a=i.length-1;a>=0;a--)i[a].alive||i.splice(a,1)}}class Vy{step(t,e,r){return t.launched?(Math.hypot(t.vel.x,t.vel.y)<e.stallSpeed?t.stallT+=r:t.stallT=0,t.hp<=0||t.stallT>=e.stallTime):!1}}class qy{checkLevelUp(t){for(;t.currentXp>=t.xpToNextLevel;)t.currentXp-=t.xpToNextLevel,t.currentLevel++,t.pendingLevelUps++,t.xpToNextLevel=Math.round(t.xpToNextLevel*E.xp.levelScale)}applyChoice(t,e){t.applyUpgrade(e),t.paused=!1}}const Yy=[{id:"auto_to_rail",name:"Rail Cannon",description:"Auto-Cannon evolves into Rail Cannon with piercing shots.",sourceWeaponId:"auto_cannon",resultWeaponId:"rail_cannon",requiresUpgrades:{extra_shot:1,projectile_speed_up:1,cannon_damage_up:1},oneTime:!0}];class Xy{check(t){for(const e of Yy){if(e.oneTime&&t.appliedEvolutions.has(e.id)||!t.weaponLoadout.includes(e.sourceWeaponId))continue;let r=!0;for(const[n,o]of Object.entries(e.requiresUpgrades))if((t.appliedUpgrades.get(n)??0)<o){r=!1;break}if(!r)continue;const i=t.weaponLoadout.indexOf(e.sourceWeaponId);return i!==-1&&(t.weaponLoadout[i]=e.resultWeaponId),t.appliedEvolutions.add(e.id),t.recomputeStats(),{def:e}}return null}}const xa=[{id:"T0",name:"Low Orbit",startMeters:0,reward:{scrapMult:1,coinGoldMult:1},difficulty:{enemyHpMult:1,enemySpeedMult:1,shooterChanceAdd:0,eliteChanceAdd:0},visuals:{groundColor:1780282,groundStroke:2968158,accentColor:6719658},shortLabel:"T0"},{id:"T1",name:"Debris Field",startMeters:1e3,reward:{scrapMult:1.25,coinGoldMult:1.25},difficulty:{enemyHpMult:1.2,enemySpeedMult:1.05,shooterChanceAdd:.05,eliteChanceAdd:0},visuals:{groundColor:2042410,groundStroke:3364170,accentColor:5622920},shortLabel:"T1"},{id:"T2",name:"Asteroid Belt",startMeters:2e3,reward:{scrapMult:1.5,coinGoldMult:1.5},difficulty:{enemyHpMult:1.45,enemySpeedMult:1.1,shooterChanceAdd:.1,eliteChanceAdd:.02},visuals:{groundColor:2760490,groundStroke:5583701,accentColor:13395626},shortLabel:"T2"},{id:"T3",name:"Deep Space",startMeters:3e3,reward:{scrapMult:2,coinGoldMult:2},difficulty:{enemyHpMult:1.85,enemySpeedMult:1.15,shooterChanceAdd:.15,eliteChanceAdd:.05},visuals:{groundColor:2759194,groundStroke:5583667,accentColor:16737860},shortLabel:"T3"}];function Si(s){let t=xa[0];for(const e of xa)s>=e.startMeters&&(t=e);return t}class Ky{currentTier=Si(0);tierJustChanged=!1;update(t){const e=Si(t);this.tierJustChanged=e.id!==this.currentTier.id,this.currentTier=e}reset(){this.currentTier=Si(0),this.tierJustChanged=!1}}class Jy{state;constructor(t){this.state=t|0}nextFloat(){this.state=this.state+1831565813|0;let t=Math.imul(this.state^this.state>>>15,1|this.state);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}nextInt(t){return Math.floor(this.nextFloat()*t)}pick(t){return t[this.nextInt(t.length)]}shuffle(t){const e=t.slice();for(let r=e.length-1;r>0;r--){const i=this.nextInt(r+1);[e[r],e[i]]=[e[i],e[r]]}return e}}const br=[{id:"boost_regen_up",name:"Boost Regen +25%",description:"Boost regen rate +25% while not thrusting.",tags:["boost"],rarity:"common",stackable:!0,effect:{type:"stat_mult",stat:"boostRegenPerSec",multiplier:1.25}},{id:"thrust_power_up",name:"Thrust Power +15%",description:"Thrust acceleration increased by 15%.",tags:["boost","thrust"],rarity:"common",stackable:!0,effect:{type:"stat_mult",stat:"thrustAccel",multiplier:1.15}},{id:"drag_debuff_down",name:"Drag Resist",description:"Enemy drag debuff duration reduced by 20%.",tags:["defense"],rarity:"common",stackable:!0,effect:{type:"stat_mult",stat:"dragDebuffSec",multiplier:.8}},{id:"contact_loss_down",name:"Reinforced Hull",description:"Retain 10% more speed on enemy contact.",tags:["defense"],rarity:"rare",stackable:!0,effect:{type:"stat_mult",stat:"contactSpeedRetain",multiplier:1.1}},{id:"cannon_cooldown_down",name:"Rapid Fire",description:"Auto-cannon fires 12% faster.",tags:["weapon"],rarity:"common",stackable:!0,effect:{type:"weapon_mod",weaponTag:"auto",mods:{cooldownMult:.88}}},{id:"cannon_damage_up",name:"Armor Piercing",description:"Auto-cannon deals +2 damage per shot.",tags:["weapon"],rarity:"common",stackable:!0,effect:{type:"weapon_mod",weaponTag:"auto",mods:{damageAdd:2}}},{id:"extra_shot",name:"Double Tap",description:"Auto-cannon fires an extra projectile per volley.",tags:["weapon"],rarity:"epic",stackable:!0,maxStacks:2,effect:{type:"weapon_mod",weaponTag:"auto",mods:{extraShotsAdd:1}}},{id:"projectile_speed_up",name:"High Velocity",description:"All projectiles travel 20% faster.",tags:["weapon"],rarity:"common",stackable:!0,maxStacks:3,effect:{type:"weapon_mod",mods:{projectileSpeedMult:1.2}}},{id:"stall_grace_up",name:"Stall Grace",description:"Stall timer extended by 0.5 seconds.",tags:["survival"],rarity:"rare",stackable:!0,effect:{type:"stat_add",stat:"stallTime",amount:.5}},{id:"boost_max_up",name:"Fuel Tank",description:"Boost capacity increased by 20.",tags:["boost"],rarity:"common",stackable:!0,effect:{type:"stat_add",stat:"boostMax",amount:20}},{id:"hp_max_up",name:"Hull Plating",description:"Maximum HP increased by 20.",tags:["defense"],rarity:"common",stackable:!0,effect:{type:"stat_add",stat:"hpMax",amount:20}},{id:"rear_blaster_unlock",name:"Rear Blaster",description:"Unlock a rear-facing weapon that fires behind you.",tags:["weapon","unlock"],rarity:"epic",stackable:!1,effect:{type:"special",specialId:"unlock_rear_blaster"}}],Zy={auto_cannon:{id:"auto_cannon",name:"Auto-Cannon",tags:["ballistic","auto"],baseCooldown:.35,baseDamage:10,baseProjectileSpeed:900,baseRange:520,baseExtraShots:0,targetMode:"nearest",projectileLifeT:1.2,basePierceCount:0},rear_blaster:{id:"rear_blaster",name:"Rear Blaster",tags:["ballistic","rear"],baseCooldown:.6,baseDamage:8,baseProjectileSpeed:700,baseRange:400,baseExtraShots:0,targetMode:"rear",projectileLifeT:1,basePierceCount:0},rail_cannon:{id:"rail_cannon",name:"Rail Cannon",tags:["ballistic","auto","piercing","rail"],baseCooldown:.75,baseDamage:40,baseProjectileSpeed:1400,baseRange:700,baseExtraShots:0,targetMode:"nearest",projectileLifeT:1,basePierceCount:5}};class Qy{seed;rng;currentRound=1;rocketsRemaining;scrap=0;gold=0;roundToll;currentXp=0;xpToNextLevel;currentLevel=0;pendingLevelUps=0;totalKills=0;appliedUpgrades=new Map;appliedEvolutions=new Set;appliedArtifacts=new Set;weaponLoadout=["auto_cannon"];playerStats;weaponStats=new Map;paused=!1;constructor(t){this.seed=t??Date.now(),this.rng=new Jy(this.seed),this.rocketsRemaining=E.rounds.startingRockets,this.roundToll=E.rounds.baseToll,this.xpToNextLevel=E.xp.baseToLevel,this.recomputeStats()}applyUpgrade(t){const e=this.appliedUpgrades.get(t)??0;this.appliedUpgrades.set(t,e+1);const r=br.find(i=>i.id===t);r?.effect.type==="special"&&r.effect.specialId==="unlock_rear_blaster"&&(this.weaponLoadout.includes("rear_blaster")||this.weaponLoadout.push("rear_blaster")),this.recomputeStats()}recomputeStats(){this.playerStats=this.computePlayerStats(),this.weaponStats=this.computeWeaponStats(),this.applyArtifactBonuses()}applyArtifactBonuses(){this.appliedArtifacts.has("emergency_fuel")&&(this.playerStats.boostMax+=50)}computePlayerStats(){const t={},e={},r=[];for(const[n,o]of this.appliedUpgrades){const a=br.find(l=>l.id===n);if(a)for(let l=0;l<o;l++){const h=a.effect;h.type==="stat_add"?t[h.stat]=(t[h.stat]??0)+h.amount:h.type==="stat_mult"?e[h.stat]=(e[h.stat]??1)*h.multiplier:h.type==="special"&&r.push(h.specialId)}}const i=(n,o)=>(o+(t[n]??0))*(e[n]??1);return{hpMax:i("hpMax",E.player.hpMax),boostMax:i("boostMax",E.player.boostMax),boostDrainPerSec:i("boostDrainPerSec",E.player.boostDrainPerSec),boostRegenPerSec:i("boostRegenPerSec",E.player.boostRegenPerSec),boostAutoRegen:E.player.boostAutoRegen,thrustAccel:i("thrustAccel",E.player.thrustAccel),stallSpeed:i("stallSpeed",E.player.stallSpeed),stallTime:i("stallTime",E.player.stallTime),contactSpeedRetain:i("contactSpeedRetain",E.enemy.contactSpeedRetain),dragDebuffSec:i("dragDebuffSec",E.enemy.dragDebuffSec)}}computeWeaponStats(){const t=new Map,e=[];for(const[r,i]of this.appliedUpgrades){const n=br.find(a=>a.id===r);if(!n||n.effect.type!=="weapon_mod")continue;const o=n.effect;for(let a=0;a<i;a++)e.push({weaponTag:o.weaponTag,mods:o.mods})}for(const r of this.weaponLoadout){const i=Zy[r];if(!i)continue;let n=1,o=1,a=0,l=1,h=1,c=0;for(const u of e)u.weaponTag&&!i.tags.includes(u.weaponTag)||(n*=u.mods.cooldownMult??1,o*=u.mods.damageMult??1,a+=u.mods.damageAdd??0,l*=u.mods.projectileSpeedMult??1,h*=u.mods.rangeMult??1,c+=u.mods.extraShotsAdd??0);t.set(r,{id:r,fireCooldown:i.baseCooldown*n,range:i.baseRange*h,projectileSpeed:i.baseProjectileSpeed*l,damage:(i.baseDamage+a)*o,extraShots:i.baseExtraShots+c,targetMode:i.targetMode,projectileLifeT:i.projectileLifeT,pierceCount:i.basePierceCount})}return t}}const t_={common:100,rare:40,epic:10};function e_(s,t=["auto_cannon"]){return br.filter(e=>{const r=s.get(e.id)??0;if(!e.stackable&&r>0||e.maxStacks!=null&&r>=e.maxStacks)return!1;if(e.excludes){for(const i of e.excludes)if((s.get(i)??0)>0)return!1}if(e.requires){for(const i of e.requires)if(i.startsWith("upgrade:")){const n=i.slice(8);if((s.get(n)??0)<=0)return!1}else if(i.startsWith("weapon:")){const n=i.slice(7);if(!t.includes(n))return!1}}return!0})}function s_(s){return s.pickWeight??t_[s.rarity]}function Th(s,t,e=3,r=["auto_cannon"]){const i=e_(t,r).map(a=>({def:a,weight:s_(a)}));if(i.length===0)return[];const n=[],o=[...i];for(let a=0;a<e&&o.length>0;a++){const l=o.reduce((u,f)=>u+f.weight,0);let h=s.nextFloat()*l,c=o.length-1;for(let u=0;u<o.length;u++)if(h-=o[u].weight,h<=0){c=u;break}n.push({def:o[c].def,currentStacks:t.get(o[c].def.id)??0}),o.splice(c,1)}return n}class r_{root=new H;textLeft;tierBadge;tierInfo;hpBar=new G;boostBar=new G;xpBar=new G;xpLabel;constructor(){this.textLeft=new at({text:"",style:{fill:16777215,fontSize:13,fontFamily:"system-ui",lineHeight:17}}),this.textLeft.x=12,this.textLeft.y=10,this.tierBadge=new at({text:"",style:{fill:6719658,fontSize:14,fontFamily:"system-ui",fontWeight:"bold"}}),this.tierBadge.x=12,this.tierBadge.y=70,this.tierInfo=new at({text:"",style:{fill:8952234,fontSize:10,fontFamily:"system-ui",lineHeight:13}}),this.tierInfo.x=12,this.tierInfo.y=88,this.xpLabel=new at({text:"",style:{fill:4521864,fontSize:11,fontFamily:"system-ui"}}),this.root.addChild(this.textLeft,this.tierBadge,this.tierInfo,this.hpBar,this.boostBar,this.xpBar,this.xpLabel)}resize(t){this.hpBar.x=t-220,this.hpBar.y=12,this.boostBar.x=t-220,this.boostBar.y=34,this.xpBar.x=t-220,this.xpBar.y=56,this.xpLabel.x=t-220+205,this.xpLabel.y=54}update(t){const e=t.artifacts>0?`  Art: ${t.artifacts}`:"";this.textLeft.text=`Round ${t.round}  Rockets: ${t.rocketsLeft}  Gold: ${t.gold}${e}
Scrap: ${t.scrap}/${t.roundToll}  Dist: ${t.distanceM.toFixed(0)}m  Speed: ${t.speed.toFixed(1)}
Kills: ${t.kills}  Hits: ${t.hits}`,this.tierBadge.text=`${t.tierLabel}  ${t.tierName}`,this.tierBadge.style.fill=t.tierAccent,this.tierInfo.text=`Scrap x${t.tierScrapMult.toFixed(2)}  Coin x${t.tierCoinMult.toFixed(2)}  HP x${t.tierHpMult.toFixed(2)}  Spd x${t.tierSpeedMult.toFixed(2)}`;const r=Math.max(0,Math.min(1,t.hp/t.hpMax)),i=Math.max(0,Math.min(1,t.boost/t.boostMax)),n=Math.max(0,Math.min(1,t.xp/t.xpMax));this.hpBar.clear(),this.hpBar.roundRect(0,0,200,14,7).stroke({width:2,color:16777215,alpha:.4}),this.hpBar.roundRect(0,0,200*r,14,7).fill({color:16731469,alpha:.9}),this.boostBar.clear(),this.boostBar.roundRect(0,0,200,14,7).stroke({width:2,color:16777215,alpha:.4}),this.boostBar.roundRect(0,0,200*i,14,7).fill({color:5093631,alpha:.9}),this.xpBar.clear(),this.xpBar.roundRect(0,0,200,14,7).stroke({width:2,color:16777215,alpha:.4}),this.xpBar.roundRect(0,0,200*n,14,7).fill({color:4521864,alpha:.9}),this.xpLabel.text=`Lv${t.level}`}}class i_{root=new H;panel=new G;text=new at({text:"",style:{fill:16777215,fontSize:18,fontFamily:"system-ui",align:"center"}});constructor(){this.root.addChild(this.panel,this.text)}layout(t,e){this.panel.clear(),this.panel.roundRect(0,0,420,380,18).fill({color:0,alpha:.55}),this.panel.x=(t-420)/2,this.panel.y=(e-380)/2,this.text.anchor.set(.5),this.text.x=t/2,this.text.y=e/2}setText(t){this.text.text=t}}const n_={common:6719658,rare:4491519,epic:13387007},Qt=240,ps=160,wa=24;class o_{root=new H;backdrop=new G;panel=new H;choices=[];onPick=null;kbHandler=null;constructor(){this.root.visible=!1,this.root.addChild(this.backdrop,this.panel)}show(t,e,r,i){this.choices=t,this.onPick=i,this.root.visible=!0,this.build(e,r),this.kbHandler=n=>{const o=parseInt(n.key)-1;o>=0&&o<this.choices.length&&this.pick(o)},window.addEventListener("keydown",this.kbHandler)}hide(){this.root.visible=!1,this.panel.removeChildren(),this.kbHandler&&(window.removeEventListener("keydown",this.kbHandler),this.kbHandler=null),this.onPick=null}layout(t,e){this.root.visible&&this.choices.length>0&&this.build(t,e)}pick(t){const e=this.choices[t];if(!e)return;const r=this.onPick;this.hide(),r?.(e.def.id)}build(t,e){this.panel.removeChildren(),this.backdrop.clear(),this.backdrop.rect(0,0,t,e),this.backdrop.fill({color:0,alpha:.65}),this.backdrop.eventMode="static";const r=new at({text:"CHOOSE AN UPGRADE",style:{fill:16777215,fontSize:26,fontFamily:"system-ui, sans-serif",fontWeight:"bold",letterSpacing:2}});r.anchor.set(.5),r.x=t/2,r.y=e/2-ps/2-48,this.panel.addChild(r);const i=this.choices.length*Qt+(this.choices.length-1)*wa,n=(t-i)/2,o=e/2-ps/2+10;for(let a=0;a<this.choices.length;a++){const l=this.buildCard(this.choices[a],a);l.x=n+a*(Qt+wa),l.y=o,this.panel.addChild(l)}}buildCard(t,e){const r=new H,i=n_[t.def.rarity],n=new G;n.roundRect(0,0,Qt,ps,12),n.fill({color:1184298,alpha:.95}),n.roundRect(0,0,Qt,ps,12),n.stroke({width:2,color:i,alpha:.8}),r.addChild(n);const o=new G;o.roundRect(2,2,Qt-4,4,2),o.fill({color:i,alpha:.9}),r.addChild(o);const a=new at({text:`[${e+1}]`,style:{fill:16777215,fontSize:11,fontFamily:"system-ui"}});a.x=10,a.y=14,a.alpha=.4,r.addChild(a);const l=new at({text:t.def.name,style:{fill:16777215,fontSize:17,fontFamily:"system-ui, sans-serif",fontWeight:"bold",wordWrap:!0,wordWrapWidth:Qt-24}});l.x=12,l.y=32,r.addChild(l);const h=new at({text:t.def.description,style:{fill:10066363,fontSize:13,fontFamily:"system-ui, sans-serif",wordWrap:!0,wordWrapWidth:Qt-24}});if(h.x=12,h.y=62,r.addChild(h),t.currentStacks>0){const c=new at({text:`x${t.currentStacks+1}`,style:{fill:i,fontSize:14,fontFamily:"system-ui"}});c.anchor.set(1,1),c.x=Qt-10,c.y=ps-8,r.addChild(c)}return r.eventMode="static",r.cursor="pointer",r.on("pointerdown",()=>this.pick(e)),r.on("pointerover",()=>{n.tint=13421823}),r.on("pointerout",()=>{n.tint=16777215}),r}}class a_{root=new H;label;timer=0;duration=0;constructor(){this.label=new at({text:"",style:{fill:4521983,fontSize:22,fontFamily:"system-ui, sans-serif",fontWeight:"bold",letterSpacing:1,dropShadow:{alpha:.6,blur:4,distance:0,color:0}}}),this.label.anchor.set(.5),this.root.addChild(this.label),this.root.visible=!1}show(t,e=2.5){this.label.text=t,this.timer=0,this.duration=e,this.root.visible=!0,this.root.alpha=1}update(t){if(!this.root.visible)return;if(this.timer+=t,this.timer>=this.duration){this.root.visible=!1;return}const e=this.duration-.6;this.timer>e&&(this.root.alpha=1-(this.timer-e)/.6)}layout(t,e){this.label.x=t/2,this.label.y=80}}const Ai=8,pr=2e3,gr=1200,l_=140,va=.133,Sa=1.8,h_=100,c_=.04,u_=30;class d_{scenes;root=new H;layers=new Ly;cam;kb;drag;world=new Fy;thrust=new jy;launcher=new Ny;spawner=new Gy;droneAI=new Wy;weapon=new zy;collide=new Hy;stall=new Vy;upgradeSys=new qy;evolutionSys=new Xy;tierSys=new Ky;runState;upgradeOverlay=new o_;toast=new a_;player;drones=[];projectiles=[];enemyBullets=[];gfxWorld=new G;gfxThrustFlame=new G;gfxDebug=new G;rocketSprite=null;droneContainer=new H;droneSprites=new Map;hud=new r_;end=new i_;ended=!1;worldCoins=[];coinSprites=new Map;coinFrames=[];coinContainer=new H;nextCoinId=1;nextCoinClusterX=0;stars=[];resizeHandler=null;endClickHandler=null;debugKeyHandler=null;freshReset=!1;shakeT=0;shakeIntensity=0;lastDistanceM=0;coinAnimT=0;smokeTrail=[];lastTrailTime=0;constructor(t){this.scenes=t}async enter(){this.resetRun();const t=this.scenes.getApp();this.scenes.getDebug().gfx.clear(),t.stage.addChild(this.root),this.root.addChild(this.layers.root),this.layers.world.addChild(this.gfxWorld),this.layers.world.addChild(this.coinContainer),this.layers.world.addChild(this.droneContainer),this.layers.world.addChild(this.gfxDebug),this.layers.ui.addChild(this.hud.root),this.layers.ui.addChild(this.upgradeOverlay.root),this.layers.ui.addChild(this.toast.root),this.cam=new By(this.layers.world),this.kb=new Dy(window),this.drag=new $y(t.canvas),await Kp();const e=Yp();e&&(this.rocketSprite=new Nt(e),this.rocketSprite.anchor.set(.5),this.rocketSprite.scale.set(va),this.layers.world.addChild(this.rocketSprite)),this.layers.world.addChild(this.gfxThrustFlame),await this.loadCoinFrames(),this.initStars();const r=this.scenes.data.runState;r?(this.scenes.data.runState=void 0,this.runState=r,this.resetRocket()):this.resetRun(),this.resizeHandler=()=>{const n=t.renderer.width,o=t.renderer.height;this.hud.resize(n),this.end.layout(n,o),this.upgradeOverlay.layout(n,o),this.toast.layout(n,o)},window.addEventListener("resize",this.resizeHandler),this.resizeHandler();const i=n=>{this.ended||this.runState.paused||this.player.launched&&(n.key==="u"?(this.runState.pendingLevelUps++,this.toast.show(`+1 pending (${this.runState.pendingLevelUps} queued)`)):n.key==="e"?this.tryEvolve():n.key==="p"&&this.spawner.spawnShooterNear(this.player,this.drones))};window.addEventListener("keydown",i),this.debugKeyHandler=()=>window.removeEventListener("keydown",i)}exit(){this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.endClickHandler&&(this.scenes.getApp().canvas.removeEventListener("pointerdown",this.endClickHandler),this.endClickHandler=null),this.debugKeyHandler&&(this.debugKeyHandler(),this.debugKeyHandler=null)}initStars(){this.stars=[];for(let t=0;t<l_;t++)this.stars.push({x:Math.random()*pr,y:Math.random()*gr,a:.15+Math.random()*.85,r:.3+Math.random()*1.6,p:.01+Math.random()*.07})}async loadCoinFrames(){try{const t=await Lt.load(Ce("/coin_flip_sheet.png")),e=t.width/Ai,r=t.height;this.coinFrames=[];for(let i=0;i<Ai;i++)this.coinFrames.push(new j({source:t.source,frame:new Q(i*e,0,e,r)}))}catch{this.coinFrames=[]}}clearWorldCoins(){for(const t of this.coinSprites.values())this.coinContainer.removeChild(t),t.destroy();this.coinSprites.clear(),this.worldCoins=[],this.nextCoinId=1,this.nextCoinClusterX=E.launcher.originX+500}spawnCoinsAhead(){const t=this.player.pos.x+1200,e=E.worldCoins,r=this.runState.rng;for(;this.nextCoinClusterX<t;){const i=this.nextCoinClusterX,o=this.world.terrain.groundYAt(i)-120-r.nextFloat()*130,a=e.clusterMin+r.nextInt(e.clusterMax-e.clusterMin+1);for(let l=0;l<a;l++){const h=i+(l-a/2)*45,c=o+Math.sin(l*.8)*30,u={id:this.nextCoinId++,pos:{x:h,y:c},alive:!0,bobPhase:r.nextFloat()*Math.PI*2};if(this.worldCoins.push(u),this.coinFrames.length>0){const f=new ts(this.coinFrames);f.width=e.coinSize,f.height=e.coinSize,f.anchor.set(.5),f.animationSpeed=.15,f.gotoAndPlay(r.nextInt(Ai)),this.coinContainer.addChild(f),this.coinSprites.set(u.id,f)}}this.nextCoinClusterX+=e.spawnIntervalMin+r.nextInt(e.spawnIntervalMax-e.spawnIntervalMin)}}collectCoins(){const t=this.player.pos.x,e=this.player.pos.y,r=this.player.radius+E.worldCoins.pickupRadius;for(const i of this.worldCoins){if(!i.alive)continue;const n=i.pos.x-t,o=i.pos.y-e;if(n*n+o*o<=r*r){i.alive=!1;let a=E.worldCoins.goldPerPickup*this.tierSys.currentTier.reward.coinGoldMult;this.runState.appliedArtifacts.has("golden_thrusters")&&(a*=1.2),this.runState.gold+=Math.round(a);const l=this.coinSprites.get(i.id);l&&(this.coinContainer.removeChild(l),l.destroy(),this.coinSprites.delete(i.id))}}for(let i=this.worldCoins.length-1;i>=0;i--){const n=this.worldCoins[i];if(!n.alive||n.pos.x<this.player.pos.x-800){const o=this.coinSprites.get(n.id);o&&(this.coinContainer.removeChild(o),o.destroy(),this.coinSprites.delete(n.id)),this.worldCoins.splice(i,1)}}}clearDroneSprites(){for(const t of this.droneSprites.values())this.droneContainer.removeChild(t),t.destroy();this.droneSprites.clear()}resetRun(){this.ended=!1,this.drones=[],this.projectiles=[],this.enemyBullets=[],this.smokeTrail=[],this.lastTrailTime=0,this.clearWorldCoins(),this.clearDroneSprites(),this.spawner.reset(),this.weapon.reset(),this.droneAI.reset(),this.tierSys.reset(),this.upgradeOverlay.hide(),this.shakeT=0,this.lastDistanceM=0;const e=new URLSearchParams(window.location.search).get("seed"),r=e?parseInt(e,10):void 0;this.runState=new Qy(r),this.drag&&(this.drag.state.isDragging=!1,this.drag.state.released=!1),this.freshReset=!0;const i=this.runState.playerStats;this.player={pos:{x:E.launcher.originX,y:E.launcher.originY},vel:{x:0,y:0},radius:E.player.radius,hp:i.hpMax,boost:i.boostMax,dragDebuffT:0,launched:!1,stallT:0,kills:0,hits:0}}resetRocket(){this.ended=!1,this.drones=[],this.projectiles=[],this.enemyBullets=[],this.smokeTrail=[],this.lastTrailTime=0,this.clearWorldCoins(),this.clearDroneSprites(),this.spawner.reset(),this.weapon.reset(),this.droneAI.reset(),this.tierSys.reset(),this.upgradeOverlay.hide(),this.shakeT=0,this.lastDistanceM=0,this.drag&&(this.drag.state.isDragging=!1,this.drag.state.released=!1),this.freshReset=!0;const t=this.runState.playerStats;this.player={pos:{x:E.launcher.originX,y:E.launcher.originY},vel:{x:0,y:0},radius:E.player.radius,hp:t.hpMax,boost:t.boostMax,dragDebuffT:0,launched:!1,stallT:0,kills:0,hits:0}}fixedUpdate(t){if(this.ended||this.runState.paused)return;this.freshReset&&(this.freshReset=!1,this.drag.state.released=!1,this.drag.state.isDragging=!1);const e=E.launcher.originX+this.layers.world.x,r=E.launcher.originY+this.layers.world.y;if(this.launcher.applyLaunch(this.player,this.drag,e,r),!this.player.launched)return;const i=this.runState.playerStats;this.thrust.step(this.player,this.kb,i,t),this.world.stepPlayer(this.player,t);const n=Math.max(0,(this.player.pos.x-E.launcher.originX)/10),o=Math.max(0,n-this.lastDistanceM);if(o>0&&(this.runState.currentXp+=o*(E.xp.perKm/1e3)),this.lastDistanceM=n,this.tierSys.update(n),this.tierSys.tierJustChanged){const u=this.tierSys.currentTier;this.toast.show(`ENTERING ${u.shortLabel}  ${u.name}
Scrap x${u.reward.scrapMult}  Gold x${u.reward.coinGoldMult}`,2)}const a=this.tierSys.currentTier;this.spawner.step(this.player,this.drones,this.runState.rng,n,a,t),this.droneAI.step(this.player,this.drones,this.enemyBullets,t),this.weapon.step(this.player,this.drones,this.projectiles,this.runState,t);const l=this.player.kills;this.collide.step(this.player,this.drones,this.projectiles,this.enemyBullets,i,t);const h=this.player.kills-l;if(h>0){let u=h*E.scrap.perKill*a.reward.scrapMult;this.runState.appliedArtifacts.has("scrap_magnet")&&(u*=1.25),this.runState.scrap+=Math.round(u),this.runState.currentXp+=h*E.xp.perKill,this.runState.totalKills+=h}this.spawnCoinsAhead(),this.collectCoins();const c=this.runState.currentLevel;this.upgradeSys.checkLevelUp(this.runState),this.runState.currentLevel>c&&this.toast.show(`Level ${this.runState.currentLevel}!`),this.stall.step(this.player,i,t)&&this.endRocket()}drainPendingUpgrades(t){if(this.runState.pendingLevelUps<=0){t();return}this.runState.pendingLevelUps--;const e=Th(this.runState.rng,this.runState.appliedUpgrades,3,this.runState.weaponLoadout);if(e.length===0){this.runState.pendingLevelUps=0,t();return}const r=this.scenes.getApp();this.upgradeOverlay.show(e,r.renderer.width,r.renderer.height,i=>{this.upgradeSys.applyChoice(this.runState,i),this.tryEvolve(),this.drainPendingUpgrades(t)})}tryEvolve(){const t=this.evolutionSys.check(this.runState);if(t){const e=t.def;this.toast.show(`EVOLVED: ${e.sourceWeaponId}  ${e.name}`),this.shakeT=.3,this.shakeIntensity=8}}update(t){const e=this.scenes.getApp(),r=this.player.pos.x-e.renderer.width*.33,i=this.player.pos.y-e.renderer.height*.55;if(this.cam.follow(r,i),this.cam.update(t),this.shakeT>0){this.shakeT-=t;const h=this.shakeIntensity*Math.min(1,this.shakeT*4);this.layers.world.x+=(Math.random()-.5)*h,this.layers.world.y+=(Math.random()-.5)*h}this.toast.update(t),this.coinAnimT+=t;for(const h of this.worldCoins){if(!h.alive)continue;const c=this.coinSprites.get(h.id);c&&(c.x=h.pos.x,c.y=h.pos.y+Math.sin(this.coinAnimT*2+h.bobPhase)*6)}this.drawWorld(e.renderer.width,e.renderer.height);const n=this.runState.playerStats,o=Math.max(0,(this.player.pos.x-E.launcher.originX)/10),a=Math.hypot(this.player.vel.x,this.player.vel.y),l=this.tierSys.currentTier;this.hud.update({distanceM:o,speed:a,kills:this.player.kills,hits:this.player.hits,hp:this.player.hp,hpMax:n.hpMax,boost:this.player.boost,boostMax:n.boostMax,round:this.runState.currentRound,rocketsLeft:this.runState.rocketsRemaining,scrap:this.runState.scrap,roundToll:this.runState.roundToll,gold:this.runState.gold,xp:this.runState.currentXp,xpMax:this.runState.xpToNextLevel,level:this.runState.currentLevel,artifacts:this.runState.appliedArtifacts.size,tierLabel:l.shortLabel,tierName:l.name,tierAccent:l.visuals.accentColor,tierScrapMult:l.reward.scrapMult,tierCoinMult:l.reward.coinGoldMult,tierHpMult:l.difficulty.enemyHpMult,tierSpeedMult:l.difficulty.enemySpeedMult})}endRocket(){this.ended=!0;const t=Math.max(0,(this.player.pos.x-E.launcher.originX)/10);if(this.runState.scrap>=this.runState.roundToll){const e=this.runState.roundToll,r=this.runState.scrap-e,i=Math.floor(r*E.gold.scrapToGoldRate),n=this.runState.rocketsRemaining*E.gold.rocketBonus,o=i+n;this.runState.gold+=o,this.runState.scrap=0,this.runState.currentRound++;let a=E.rounds.startingRockets;this.runState.appliedArtifacts.has("extra_rocket")&&a++,this.runState.rocketsRemaining=a,this.runState.roundToll=Math.round(e*E.rounds.tollScale);const l=this.runState.pendingLevelUps,h=l>0?`
${l} upgrade${l>1?"s":""} pending!`:"";this.end.setText(`ROUND ${this.runState.currentRound-1} COMPLETE!

Toll paid: ${e} scrap
Gold earned: +${o}
Gold total: ${this.runState.gold}
Next toll: ${this.runState.roundToll}
Rockets: ${this.runState.rocketsRemaining}${h}

Click to continue`),this.showEndScreenOverlay(()=>this.drainPendingUpgrades(()=>{this.scenes.data.runState=this.runState,this.scenes.switchTo("merchant")}))}else if(this.runState.rocketsRemaining--,this.runState.rocketsRemaining>0){const e=this.runState.pendingLevelUps,r=e>0?`
${e} upgrade${e>1?"s":""} pending!`:"";this.end.setText(`ROCKET LOST

Dist: ${t.toFixed(0)}m  Kills: ${this.player.kills}
Rockets remaining: ${this.runState.rocketsRemaining}
Scrap: ${this.runState.scrap} / ${this.runState.roundToll}${r}

Click to relaunch`),this.showEndScreenOverlay(()=>this.drainPendingUpgrades(()=>this.resetRocket()))}else{const e=[...this.runState.appliedUpgrades.entries()].map(([o,a])=>`  ${o} x${a}`).join(`
`),r=[...this.runState.appliedEvolutions].map(o=>`  ${o}`).join(`
`),i=[...this.runState.appliedArtifacts].map(o=>`  ${o}`).join(`
`);this.end.setText(`GAME OVER

Round: ${this.runState.currentRound}
Total Kills: ${this.runState.totalKills}
Level: ${this.runState.currentLevel}
Gold: ${this.runState.gold}${e?`

Upgrades:
${e}`:""}${r?`

Evolutions:
${r}`:""}${i?`

Artifacts:
${i}`:""}

Click to continue`);const n=Math.round(t);this.showEndScreenOverlay(()=>this.trySubmitScoreAndThen(n,()=>this.scenes.switchTo("title")))}}trySubmitScoreAndThen(t,e){Ry(t).then(r=>{if(!r){e();return}Iy(t,i=>{Py(i,t).then(()=>e())})})}showEndScreenOverlay(t){const e=this.scenes.getApp();this.layers.ui.children.includes(this.end.root)||this.layers.ui.addChild(this.end.root),this.end.layout(e.renderer.width,e.renderer.height),this.endClickHandler&&e.canvas.removeEventListener("pointerdown",this.endClickHandler),this.endClickHandler=()=>{e.canvas.removeEventListener("pointerdown",this.endClickHandler),this.endClickHandler=null,this.layers.ui.removeChild(this.end.root),t()},e.canvas.addEventListener("pointerdown",this.endClickHandler)}drawWorld(t,e){const r=this.scenes.getDebug();this.gfxWorld.clear(),this.gfxDebug.clear(),this.drawStars(t,e);const i=this.world.terrain,n=this.player.pos.x-t,o=this.player.pos.x+t+600,a=this.tierSys.currentTier.visuals;this.gfxWorld.moveTo(n,2e3);for(let _=n;_<=o;_+=20)this.gfxWorld.lineTo(_,i.groundYAt(_));this.gfxWorld.lineTo(o,2e3),this.gfxWorld.closePath(),this.gfxWorld.fill({color:a.groundColor,alpha:1});const l=Math.floor(n/200)*200;for(let _=l;_<=o;_+=200){const w=i.groundYAt(_),v=_%1e3===0,S=v?16:8,T=v?.5:.2;this.gfxWorld.moveTo(_,w),this.gfxWorld.lineTo(_,w+S),this.gfxWorld.stroke({width:v?2:1,color:4491434,alpha:T}),v&&Math.round((_-E.launcher.originX)/10)>0&&this.gfxWorld.circle(_,w+22,1).fill({color:4491434,alpha:.4})}this.gfxWorld.moveTo(n,i.groundYAt(n));for(let _=n;_<=o;_+=20)this.gfxWorld.lineTo(_,i.groundYAt(_));this.gfxWorld.stroke({width:2,color:a.groundStroke,alpha:.7});const h=E.launcher.originX,c=E.launcher.originY;this.gfxWorld.circle(h,c,10).fill({color:16764006,alpha:.9}),this.updateAndDrawSmokeTrail(t,e);const u=this.player.launched?Math.atan2(this.player.vel.y,this.player.vel.x):this.getLaunchAimAngle();this.rocketSprite?(this.rocketSprite.x=this.player.pos.x,this.rocketSprite.y=this.player.pos.y,this.rocketSprite.rotation=u,this.rocketSprite.visible=!0):this.gfxWorld.circle(this.player.pos.x,this.player.pos.y,this.player.radius).fill({color:6728447,alpha:.95}),this.drawThrustFlame();const f=.06,d=2.5,p=.25,m=performance.now()*.001,g=Xp(),y=new Set;for(const _ of this.drones){if(!_.alive||(y.add(_.id),!g))continue;let w=this.droneSprites.get(_.id);w||(w=new Nt(g),w.anchor.set(.5),this.droneContainer.addChild(w),this.droneSprites.set(_.id,w)),w.x=_.pos.x,w.y=_.pos.y,w.rotation=Math.sin(m*d+_.wobblePhase)*f,_.elite?(w.tint=16742314,w.scale.set(p*1.27)):_.droneType==="shooter"?(w.tint=6750190,w.scale.set(p*1.05)):(w.tint=16777215,w.scale.set(p))}const x=[];for(const[_,w]of this.droneSprites)y.has(_)||x.push(_);for(const _ of x){const w=this.droneSprites.get(_);w&&(this.droneContainer.removeChild(w),w.destroy(),this.droneSprites.delete(_))}for(const _ of this.enemyBullets)_.alive&&this.gfxWorld.circle(_.pos.x,_.pos.y,_.radius).fill({color:16729122,alpha:.85});for(const _ of this.projectiles)_.alive&&(_.piercing?(this.gfxWorld.circle(_.pos.x,_.pos.y,_.radius+3).fill({color:4521983,alpha:.2}),this.gfxWorld.circle(_.pos.x,_.pos.y,_.radius).fill({color:4521983,alpha:.9})):this.gfxWorld.circle(_.pos.x,_.pos.y,_.radius).fill({color:16777215,alpha:.9}));const b=this.drag.state;if(!this.player.launched&&b.isDragging){const _=-this.layers.world.x,w=-this.layers.world.y,v=b.x+_,S=b.y+w;this.gfxDebug.moveTo(v,S),this.gfxDebug.lineTo(h,c),this.gfxDebug.stroke({width:3,color:16777215,alpha:.6});const T=h-v,P=c-S,k=Math.hypot(T,P);if(k>6){const A=T/k,D=P/k,$=Math.min(k,E.launcher.maxPullDist)*.5;this.gfxDebug.moveTo(h,c),this.gfxDebug.lineTo(h+A*$,c+D*$),this.gfxDebug.stroke({width:2,color:16764006,alpha:.5})}}if(r.enabled)for(let _=n;_<=o;_+=80)this.gfxDebug.circle(_,i.groundYAt(_),2).fill({color:16777215,alpha:.35})}drawStars(t,e){const r=-this.layers.world.x,i=-this.layers.world.y;for(const n of this.stars){const o=((n.x-r*n.p)%pr+pr)%pr,a=((n.y-i*n.p)%gr+gr)%gr;o<=t&&a<=e&&this.gfxWorld.circle(o+r,a+i,n.r).fill({color:16777215,alpha:n.a})}}getLaunchAimAngle(){const t=this.drag.state;if(!t.isDragging)return 0;const e=-this.layers.world.x,r=-this.layers.world.y,i=t.x+e,n=t.y+r,o=E.launcher.originX,a=E.launcher.originY;return Math.atan2(a-n,o-i)}getEnginePosition(){const t=this.player.launched?Math.atan2(this.player.vel.y,this.player.vel.x):this.getLaunchAimAngle(),e=Math.cos(t),r=Math.sin(t),i=this.rocketSprite?this.rocketSprite.width/2:32*va;return{x:this.player.pos.x-e*i,y:this.player.pos.y-r*i,dirX:-e,dirY:-r}}updateAndDrawSmokeTrail(t,e){const r=performance.now()*.001;if(this.player.launched){if(Math.hypot(this.player.vel.x,this.player.vel.y)>=u_&&r-this.lastTrailTime>=c_){const n=this.getEnginePosition();this.smokeTrail.push({x:n.x,y:n.y,t:r}),this.lastTrailTime=r}}else this.smokeTrail=[],this.lastTrailTime=0;for(;this.smokeTrail.length>h_;)this.smokeTrail.shift();for(;this.smokeTrail.length>0&&r-this.smokeTrail[0].t>Sa;)this.smokeTrail.shift();for(const i of this.smokeTrail){const o=1-(r-i.t)/Sa,a=o*o*.35,l=2+(1-o)*5;this.gfxWorld.circle(i.x,i.y,l).fill({color:13421789,alpha:a})}if(this.player.launched){const i=this.getEnginePosition();this.gfxWorld.circle(i.x,i.y,5).fill({color:16737792,alpha:.75}),this.gfxWorld.circle(i.x,i.y,3).fill({color:16755200,alpha:.85}),this.gfxWorld.circle(i.x,i.y,1.5).fill({color:16768324,alpha:.9})}}drawThrustFlame(){if(this.gfxThrustFlame.clear(),!this.player.launched)return;const t=this.kb.getAxis();if(!((t.x!==0||t.y!==0)&&this.player.boost>0))return;const r=this.getEnginePosition(),i=r.x,n=r.y,o=r.dirX,a=r.dirY,l=(Math.random()-.5)*4,h=(Math.random()-.5)*4,c=8,u=16,f=22;this.gfxThrustFlame.circle(i+o*c+l,n+a*c+h,5).fill({color:16737792,alpha:.85}),this.gfxThrustFlame.circle(i+o*u+l*1.5,n+a*u+h*1.5,3.5).fill({color:16755200,alpha:.65}),this.gfxThrustFlame.circle(i+o*f+l*2,n+a*f+h*2,2).fill({color:16768324,alpha:.45})}}const f_=[{id:"extra_rocket",name:"Extra Rocket",description:"+1 rocket per round.",goldCost:150},{id:"scrap_magnet",name:"Scrap Magnet",description:"+25% scrap earned per kill.",goldCost:120},{id:"golden_thrusters",name:"Golden Thrusters",description:"+20% gold from world coins.",goldCost:140},{id:"emergency_fuel",name:"Emergency Fuel",description:"+50 max boost capacity.",goldCost:160}],zt=220,pe=170,De=20,$e=3,Aa=8,p_={common:E.merchant.upgradePriceCommon,rare:E.merchant.upgradePriceRare,epic:E.merchant.upgradePriceEpic},g_={common:6719658,rare:4491519,epic:13387007};class m_{scenes;root=new H;bg=null;goldText;cards=[];cardBgs=[];items=[];runState;elapsed=0;continueBtn;continueBtnBaseY=0;viewW=0;viewH=0;constructor(t){this.scenes=t}async enter(){const t=this.scenes.getApp();t.stage.addChild(this.root),this.runState=this.scenes.data.runState,this.viewW=t.renderer.width,this.viewH=t.renderer.height;const e=this.viewW,r=this.viewH;try{const n=await Lt.load(Ce("/merchant_mockup.png"));this.bg=new Nt(n),this.coverFit(e,r),this.root.addChildAt(this.bg,0)}catch{const n=new G;n.rect(0,0,e,r),n.fill({color:657946}),this.root.addChildAt(n,0)}const i=new G;if(i.rect(0,0,e,r),i.fill({color:0,alpha:.45}),this.root.addChild(i),await this.buildGoldDisplay(e),this.runState.appliedArtifacts.size>0){const n=[...this.runState.appliedArtifacts].join(", "),o=new at({text:`Owned: ${n}`,style:{fill:11184844,fontSize:12,fontFamily:"system-ui"}});o.anchor.set(1,0),o.x=e-30,o.y=64,this.root.addChild(o)}this.generateShop(),this.buildCards(e,r),this.buildRerollButton(e,r),this.buildContinueButton(e,r)}exit(){}update(t){if(this.elapsed+=t,this.goldText&&(this.goldText.text=`${this.runState.gold} gold`),this.continueBtn){const e=Math.sin(this.elapsed*1.6)*8,r=Math.sin(this.elapsed*2.9)*2.5;this.continueBtn.y=this.continueBtnBaseY+e+r;const i=1+Math.sin(this.elapsed*2.2)*.015;this.continueBtn.scale.set(i),this.continueBtn.rotation=Math.sin(this.elapsed*1.1)*.015}}async buildGoldDisplay(t){const e=new H;try{const r=await Lt.load(Ce("/coin_flip_sheet.png")),i=r.width/Aa,n=r.height,o=[];for(let l=0;l<Aa;l++)o.push(new j({source:r.source,frame:new Q(l*i,0,i,n)}));const a=new ts(o);a.width=28,a.height=28,a.anchor.set(.5),a.animationSpeed=.18,a.play(),a.x=-18,a.y=0,e.addChild(a)}catch{}this.goldText=new at({text:`${this.runState.gold} gold`,style:{fill:16777215,fontSize:22,fontFamily:"system-ui, sans-serif",fontWeight:"bold"}}),this.goldText.anchor.set(0,.5),this.goldText.x=0,this.goldText.y=0,e.addChild(this.goldText),e.x=t-30-this.goldText.width,e.y=40,this.root.addChild(e)}generateShop(){this.items=[];const t=this.runState.rng,e=Th(t,this.runState.appliedUpgrades,3,this.runState.weaponLoadout);for(const n of e)this.items.push({type:"upgrade",upgradeChoice:n,price:p_[n.def.rarity],purchased:!1});const r=f_.filter(n=>!this.runState.appliedArtifacts.has(n.id)),i=t.shuffle([...r]);for(let n=0;n<Math.min(3,i.length);n++)this.items.push({type:"artifact",artifactDef:i[n],price:i[n].goldCost,purchased:!1})}buildCards(t,e){for(const a of this.cards)this.root.removeChild(a),a.destroy();this.cards=[],this.cardBgs=[];const r=$e*zt+($e-1)*De,i=2*pe+De,n=(t-r)/2,o=(e-i)/2-20;for(let a=0;a<this.items.length;a++){const l=Math.floor(a/$e),h=a%$e,c=this.buildCard(this.items[a],a);c.x=n+h*(zt+De),c.y=o+l*(pe+De),this.root.addChild(c),this.cards.push(c)}}buildCard(t,e){const r=new H,i=t.type==="artifact",n=i?16767088:this.rarityColor(t),o=this.runState.gold>=t.price,a=new G;a.roundRect(0,0,zt,pe,12),a.fill({color:1184298,alpha:.92}),a.roundRect(0,0,zt,pe,12),a.stroke({width:2,color:n,alpha:o?.8:.3}),r.addChild(a),this.cardBgs.push(a);const l=new G;l.roundRect(2,2,zt-4,4,2),l.fill({color:i?16767088:n,alpha:i?.7:.6}),r.addChild(l);const h=new at({text:i?"ARTIFACT":"UPGRADE",style:{fill:i?16767088:8956620,fontSize:10,fontFamily:"system-ui",fontWeight:"bold",letterSpacing:1}});h.x=10,h.y=12,r.addChild(h);const c=new at({text:i?t.artifactDef.name:t.upgradeChoice.def.name,style:{fill:16777215,fontSize:16,fontFamily:"system-ui, sans-serif",fontWeight:"bold",wordWrap:!0,wordWrapWidth:zt-24}});c.x=10,c.y=30,r.addChild(c);const u=new at({text:i?t.artifactDef.description:t.upgradeChoice.def.description,style:{fill:10066363,fontSize:12,fontFamily:"system-ui, sans-serif",wordWrap:!0,wordWrapWidth:zt-24}});u.x=10,u.y=60,r.addChild(u);const f=new at({text:`${t.price} gold`,style:{fill:o?16769126:16729156,fontSize:14,fontFamily:"system-ui",fontWeight:"bold"}});if(f.anchor.set(1,1),f.x=zt-10,f.y=pe-8,r.addChild(f),!i&&t.upgradeChoice.currentStacks>0){const d=new at({text:`x${t.upgradeChoice.currentStacks+1}`,style:{fill:n,fontSize:12,fontFamily:"system-ui"}});d.x=10,d.y=pe-22,r.addChild(d)}return r.eventMode="static",r.cursor=o?"pointer":"not-allowed",r.on("pointerdown",()=>this.purchaseItem(e)),r.on("pointerover",()=>{!this.items[e].purchased&&this.runState.gold>=t.price&&(a.tint=13421823)}),r.on("pointerout",()=>{a.tint=16777215}),o||(r.alpha=.5),r}purchaseItem(t){const e=this.items[t];if(!e||e.purchased)return;if(this.runState.gold<e.price){const i=this.cards[t];if(i){const n=i.x;let o=0;const a=()=>{o++,i.x=n+(o%2===0?4:-4),o<6?requestAnimationFrame(a):i.x=n};a()}return}this.runState.gold-=e.price,e.purchased=!0,e.type==="upgrade"&&e.upgradeChoice?this.runState.applyUpgrade(e.upgradeChoice.def.id):e.type==="artifact"&&e.artifactDef&&(this.runState.appliedArtifacts.add(e.artifactDef.id),e.artifactDef.id==="extra_rocket"&&this.runState.rocketsRemaining++,this.runState.recomputeStats());const r=this.cards[t];r&&(r.alpha=.3,r.eventMode="none"),this.updateCardAffordability()}rerollShop(){this.generateShop(),this.buildCards(this.viewW,this.viewH),this.updateCardAffordability()}updateCardAffordability(){for(let t=0;t<this.items.length;t++){const e=this.items[t],r=this.cards[t];if(!r||e.purchased)continue;const i=this.runState.gold>=e.price;r.alpha=i?1:.5,r.cursor=i?"pointer":"not-allowed"}}rarityColor(t){return t.type!=="upgrade"||!t.upgradeChoice?6719658:g_[t.upgradeChoice.def.rarity]}buildRerollButton(t,e){const r=new H,i=38,n=new G;n.roundRect(-i/2,-i/2,i,i,10),n.fill({color:1710650,alpha:.9}),n.roundRect(-i/2,-i/2,i,i,10),n.stroke({width:1.5,color:5596808,alpha:.6}),r.addChild(n);const o=new G,a=8,l=0,h=0,c=20,u=-Math.PI*.15,f=Math.PI*1.45;o.moveTo(l+Math.cos(u)*a,h+Math.sin(u)*a);for(let w=1;w<=c;w++){const v=u+(f-u)*w/c;o.lineTo(l+Math.cos(v)*a,h+Math.sin(v)*a)}o.stroke({width:2.5,color:8956620,alpha:.9});const d=f,p=l+Math.cos(d)*a,m=h+Math.sin(d)*a,g=5;o.moveTo(p,m),o.lineTo(p+Math.cos(d+.6)*g,m+Math.sin(d+.6)*g),o.moveTo(p,m),o.lineTo(p+Math.cos(d-1.2)*g,m+Math.sin(d-1.2)*g),o.stroke({width:2.5,color:8956620,alpha:.9}),r.addChild(o);const y=$e*zt+($e-1)*De,x=(t-y)/2,b=2*pe+De,_=(e-b)/2-20;r.x=x+y-i/2+4,r.y=_+b+14+i/2,r.eventMode="static",r.cursor="pointer",r.on("pointerdown",()=>this.rerollShop()),r.on("pointerover",()=>{n.tint=11193599}),r.on("pointerout",()=>{n.tint=16777215}),this.root.addChild(r)}buildContinueButton(t,e){const r=new H,i=230,n=68,o=18,a=new G;a.roundRect(-i/2-14,-n/2-14,i+28,n+28,o+12),a.fill({color:4227327,alpha:.18}),a.roundRect(-i/2-8,-n/2-8,i+16,n+16,o+6),a.fill({color:4227327,alpha:.12}),r.addChild(a);const l=new G;l.roundRect(-i/2+2,-n/2+4,i,n,o),l.fill({color:663114,alpha:.7}),r.addChild(l);const h=new G;h.roundRect(-i/2,-n/2,i,n,o),h.fill({color:2643376}),r.addChild(h);const c=new G;c.roundRect(-i/2+4,-n/2+4,i-8,n*.4,o-4),c.fill({color:5605597,alpha:.55}),r.addChild(c);const u=new G;u.roundRect(-i/2+4,n/2-n*.35,i-8,n*.3,o-4),u.fill({color:1718384,alpha:.35}),r.addChild(u);const f=new G;f.roundRect(-i/2,-n/2,i,n,o),f.stroke({width:2.5,color:8961023,alpha:.85}),r.addChild(f);const d=new G;d.roundRect(-i/2+3,-n/2+3,i-6,n-6,o-2),d.stroke({width:1,color:11587839,alpha:.3}),r.addChild(d);const p=new at({text:"CONTINUE",style:{fill:15791359,fontSize:30,fontFamily:"system-ui, sans-serif",fontWeight:"bold",letterSpacing:3,dropShadow:{color:661572,blur:3,distance:2,angle:Math.PI/3}}});p.anchor.set(.5),p.y=-1,r.addChild(p),r.x=t/2,r.y=e-70,this.continueBtnBaseY=r.y,r.eventMode="static",r.cursor="pointer",r.on("pointerdown",()=>{this.scenes.switchTo("run")}),this.continueBtn=r,this.root.addChild(r)}coverFit(t,e){if(!this.bg)return;const r=this.bg.texture,i=Math.min(t/r.width,e/r.height);this.bg.scale.set(i),this.bg.x=(t-r.width*i)/2,this.bg.y=0}}class y_{enabled=!1;gfx=new G}async function __(s){const t=new kl;await t.init({backgroundAlpha:0,resizeTo:s,antialias:!0}),s.appendChild(t.canvas);const e=new y_,r=new qp(t,e);r.register("title",()=>new Oy(r)),r.register("run",()=>new d_(r)),r.register("merchant",()=>new m_(r)),r.start("title"),window.addEventListener("keydown",i=>{i.key==="`"&&(e.enabled=!e.enabled)})}const b_=`0.6
`,x_=b_.trim(),kh=document.getElementById("app");if(!kh)throw new Error("Missing #app root");const Ta=document.getElementById("version-badge");Ta&&(Ta.textContent=`v${x_}`);__(kh);export{Dt as $,Ir as A,Rs as B,te as C,J as D,Gt as E,Kt as F,Pr as G,Ka as H,Ze as I,xl as J,Oi as K,K as L,N as M,jt as N,rc as O,yt as P,H as Q,Q as R,un as S,j as T,ks as U,id as V,js as W,ho as X,yr as Y,cn as Z,yl as _,dl as a,cl as a0,Bd as a1,$d as a2,zd as a3,Nd as a4,Wh as a5,qd as a6,xt as a7,Ua as a8,Ct as a9,Cr as aa,Hn as ab,Nt as ac,Gp as ad,xc as ae,qn as af,qr as ag,Yn as ah,vc as ai,Na as aj,gp as ak,wl as al,Fs as am,Su as an,_u as ao,yd as ap,cd as aq,Dd as ar,Ud as as,Hd as at,Wd as au,Vd as av,ol as b,Ke as c,W as d,Hi as e,Vi as f,ir as g,ht as h,Sr as i,dt as j,q as k,Sp as l,Wc as m,ad as n,bt as o,it as p,mr as q,ja as r,M as s,G as t,tu as u,rt as v,Z as w,cf as x,Mr as y,tf as z};
